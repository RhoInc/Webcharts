!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.webcharts=e(t.d3)}(this,function(t){"use strict";function e(e){var n=this,r=Object.keys(e[0]),a=[],i=[];this.config.x.column&&(a.push("this.config.x.column"),i.push(this.config.x.column)),this.config.y.column&&(a.push("this.config.y.column"),i.push(this.config.y.column)),this.config.color_by&&(a.push("this.config.color_by"),i.push(this.config.color_by)),this.config.marks.forEach(function(t,e){t.per&&t.per.length&&t.per.forEach(function(t,n){a.push("this.config.marks["+e+"].per["+n+"]"),i.push(t)}),t.split&&(a.push("this.config.marks["+e+"].split"),i.push(t.split))}),i.forEach(function(e,i){if(r.indexOf(e)<0){t.select(n.div).select(".loader").remove();var o='The value "'+e+'" for the '+a[i]+" setting does not match any column in the provided dataset.";throw n.wrap.append("div").style("color","red").html(o),new Error("Error in configuration object: "+o)}})}function n(t,e){function n(t){for(var e=[],n=0,r=-1,a=0,i=void 0,o=void 0;i=(o=t.charAt(n++)).charCodeAt(0);){var s=46==i||i>=48&&57>=i;s!==a&&(e[++r]="",a=s),e[r]+=o}return e}for(var r=n(String(t).toLowerCase()),a=n(String(e).toLowerCase()),i=0;r[i]&&a[i];i++)if(r[i]!==a[i]){var o=Number(r[i]),s=Number(a[i]);return o==r[i]&&s==a[i]?o-s:r[i]>a[i]?1:-1}return r.length-a.length}function r(e){var r=this,a=this.config,i=[],o=[],s=[];this.setDefaults(),a.marks.forEach(function(t,n){"bar"!==t.type&&(t.arrange=null,t.split=null);var a=t.per?r.transformData(e,t):{data:[],x_dom:[],y_dom:[]};i.push(a.data),o.push(a.x_dom),s.push(a.y_dom),r.marks[n]=Object.create(t),r.marks[n].data=a.data}),"ordinal"===a.x.type?a.x.order?this.x_dom=t.set(t.merge(o)).values().sort(function(e,n){return t.ascending(a.x.order.indexOf(e),a.x.order.indexOf(n))}):a.x.sort&&"alphabetical-ascending"===a.x.sort?this.x_dom=t.set(t.merge(o)).values().sort(n):"time"===a.y.type&&"earliest"===a.x.sort?this.x_dom=t.nest().key(function(t){return t[a.x.column]}).rollup(function(t){return t.map(function(t){return t[a.y.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,n){return t.min(n.values)-t.min(e.values)}).map(function(t){return t.key}):a.x.sort&&"alphabetical-descending"!==a.x.sort?this.x_dom=t.set(t.merge(o)).values():this.x_dom=t.set(t.merge(o)).values().sort(n):a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?this.x_dom=[0,1]:this.x_dom=t.extent(t.merge(o)),"ordinal"===a.y.type?a.y.order?this.y_dom=t.set(t.merge(s)).values().sort(function(e,n){return t.ascending(a.y.order.indexOf(e),a.y.order.indexOf(n))}):a.y.sort&&"alphabetical-ascending"===a.y.sort?this.y_dom=t.set(t.merge(s)).values().sort(n):"time"===a.x.type&&"earliest"===a.y.sort?this.y_dom=t.nest().key(function(t){return t[a.y.column]}).rollup(function(t){return t.map(function(t){return t[a.x.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,n){return t.min(n.values)-t.min(e.values)}).map(function(t){return t.key}):a.y.sort&&"alphabetical-descending"!==a.y.sort?this.y_dom=t.set(t.merge(s)).values():this.y_dom=t.set(t.merge(s)).values().sort(n).reverse():a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?this.y_dom=[0,1]:this.y_dom=t.extent(t.merge(s))}function a(){var e=this,n=arguments.length<=0||void 0===arguments[0]?this.raw_data:arguments[0],r=arguments[1],a=this,i=this.config,o=1/i.aspect;this.events.onPreprocess.call(this);var s=n||[],l=r||this.consolidateData(s);this.wrap.datum(l);var c=parseInt(this.wrap.style("width"),10);this.setColorScale();var u=i.max_width?i.max_width:c;this.raw_width="ordinal"===i.x.type&&+i.range_band?(+i.range_band+i.range_band*i.padding)*this.x_dom.length:i.resizable?u:i.width?i.width:c,this.raw_height="ordinal"===i.y.type&&+i.range_band?(+i.range_band+i.range_band*i.padding)*this.y_dom.length:i.resizable?u*o:i.height?i.height:c*o;var d=this.svg.select(".overlay").attr("width")?this.svg.select(".overlay").attr("width"):this.raw_width,h=this.svg.select(".overlay").attr("height")?this.svg.select(".overlay").attr("height"):this.raw_height;this.svg.select(".x.axis").select(".axis-title").text(function(){return"string"==typeof i.x.label?i.x.label:"function"==typeof i.x.label?i.x.label.call(e):null}),this.svg.select(".y.axis").select(".axis-title").text(function(){return"string"==typeof i.y.label?i.y.label:"function"==typeof i.y.label?i.y.label.call(e):null}),this.xScaleAxis(d),this.yScaleAxis(h);var p="resize."+a.element+"-"+a.id;i.resizable&&"undefined"!=typeof window?t.select(window).on(p,function(){return e.resize()}):"undefined"!=typeof window&&t.select(window).on(p,null),this.events.onDraw.call(this),this.resize()}function i(e){var n=this,r=this.raw_data,a=this.config,i=a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?t.format("0%"):t.format(a.x.format),o=a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?t.format("0%"):t.format(a.y.format),s=this.svg.selectAll(".bar-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});s.enter().append("g").attr("class","bar-supergroup"),s.exit().remove();var l=s.selectAll(".bar-group").data(function(t){return t.data},function(t){return t.key}),c=l.exit(),u=void 0,d=void 0,h=a.transitions?c.selectAll(".bar").transition():c.selectAll(".bar"),p=a.transitions?c.transition():c;if("ordinal"===a.x.type){h.attr("y",this.y(0)).attr("height",0),p.remove(),u=l.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),u.append("title"),d=l.selectAll("rect").data(function(t){return t.values instanceof Array?t.values.sort(function(t,e){return n.colorScale.domain().indexOf(e.key)-n.colorScale.domain().indexOf(t.key)}):[t]},function(t){return t.key});var f=a.transitions?d.exit().transition():d.exit();f.attr("y",this.y(0)).attr("height",0).remove(),d.enter().append("rect").attr("class",function(t){return"WebchartsDataMark WebchartsDataMark--Bar wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("y",this.y(0)).attr("height",0).append("title"),d.attr("shape-rendering","crispEdges").attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}),d.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.tooltip=n.tooltip,e.arrange=n.split?n.arrange:null,e.subcats=a.legend.order?a.legend.order.slice().reverse():n.values&&n.values[n.split]?n.values[n.split]:t.set(r.map(function(t){return t[n.split]})).values(),t.select(this).attr(n.attributes)}),d.select("title").text(function(t){var e=t.tooltip||"";return e.replace(/\$x/g,i(t.values.x)).replace(/\$y/g,o(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})});var g=a.transitions?d.transition():d;g.attr("x",function(t){var e=void 0,r=void 0;if(t.arrange&&"stacked"!==t.arrange)if("nested"===t.arrange){e=t.subcats.indexOf(t.key);var a=e?n.x.rangeBand()/(.75*t.subcats.length)/e:n.x.rangeBand();r=n.x(t.values.x)+(n.x.rangeBand()-a)/2}else e=t.subcats.indexOf(t.key),r=n.x(t.values.x)+n.x.rangeBand()/t.subcats.length*e;else r=n.x(t.values.x);return r}).attr("y",function(t){var e=void 0;return e="stacked"!==t.arrange?n.y(t.values.y):n.y(t.values.start)}).attr("width",function(t){var e=void 0;if(t.arrange&&"stacked"!==t.arrange)if("nested"===t.arrange){var r=t.subcats.indexOf(t.key);e=r?n.x.rangeBand()/(.75*t.subcats.length)/r:n.x.rangeBand()}else e=n.x.rangeBand()/t.subcats.length;else e=n.x.rangeBand();return e}).attr("height",function(t){return n.y(0)-n.y(t.values.y)})}else if("ordinal"===a.y.type){h.attr("x",this.x(0)).attr("width",0),p.remove(),u=l.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),u.append("title"),d=l.selectAll("rect").data(function(t){return t.values instanceof Array?t.values.sort(function(t,e){return n.colorScale.domain().indexOf(e.key)-n.colorScale.domain().indexOf(t.key)}):[t]},function(t){return t.key});var m=a.transitions?d.exit().transition():d.exit();m.attr("x",this.x(0)).attr("width",0).remove(),d.enter().append("rect").attr("class",function(t){return"WebchartsDataMark WebchartsDataMark--Bar wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("x",this.x(0)).attr("width",0).append("title"),d.attr("shape-rendering","crispEdges").attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}),d.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split&&n.arrange?n.arrange:n.split?"grouped":null,e.subcats=a.legend.order?a.legend.order.slice().reverse():n.values&&n.values[n.split]?n.values[n.split]:t.set(r.map(function(t){return t[n.split]})).values(),e.tooltip=n.tooltip}),d.select("title").text(function(t){var e=t.tooltip||"";return e.replace(/\$x/g,i(t.values.x)).replace(/\$y/g,o(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})});var v=a.transitions?d.transition():d;v.attr("x",function(t){var e=void 0;return e="stacked"!==t.arrange&&t.arrange?n.x(0):void 0!==t.values.start?n.x(t.values.start):n.x(0)}).attr("y",function(t){var e=void 0,r=void 0;if("nested"===t.arrange){r=t.subcats.indexOf(t.key);var a=r?n.y.rangeBand()/(.75*t.subcats.length)/r:n.y.rangeBand();e=n.y(t.values.y)+(n.y.rangeBand()-a)/2}else{if("grouped"!==t.arrange)return n.y(t.values.y);r=t.subcats.indexOf(t.key),e=n.y(t.values.y)+n.y.rangeBand()/t.subcats.length*r}return e}).attr("width",function(t){return n.x(t.values.x)-n.x(0)}).attr("height",function(t){var e=void 0;if("quantile"===a.y.type)e=20;else if("nested"===t.arrange){var r=t.subcats.indexOf(t.key);e=r?n.y.rangeBand()/(.75*t.subcats.length)/r:n.y.rangeBand()}else e="grouped"===t.arrange?n.y.rangeBand()/t.subcats.length:n.y.rangeBand();return e})}else if("linear"===a.x.type&&a.x.bin){h.attr("y",this.y(0)).attr("height",0),p.remove(),u=l.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),u.append("title"),d=l.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key});var y=a.transitions?d.exit().transition():d.exit();y.attr("y",this.y(0)).attr("height",0).remove(),d.enter().append("rect").attr("class",function(t){return"WebchartsDataMark WebchartsDataMark--Bar wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("y",this.y(0)).attr("height",0).append("title"),d.attr("shape-rendering","crispEdges").attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}),d.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=a.legend.order?a.legend.order.slice().reverse():n.values&&n.values[n.split]?n.values[n.split]:t.set(r.map(function(t){return t[n.split]})).values(),t.select(this).attr(n.attributes);var i=t.select(this.parentNode).datum(),o=i.key.split(",").map(function(t){return+t});e.rangeLow=t.min(o),e.rangeHigh=t.max(o),e.tooltip=n.tooltip}),d.select("title").text(function(t){var e=t.tooltip||"";return e.replace(/\$x/g,i(t.values.x)).replace(/\$y/g,o(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})});var x=a.transitions?d.transition():d;x.attr("x",function(t){return n.x(t.rangeLow)}).attr("y",function(t){var e=void 0;return e="stacked"!==t.arrange?n.y(t.values.y):n.y(t.values.start)}).attr("width",function(t){return n.x(t.rangeHigh)-n.x(t.rangeLow)}).attr("height",function(t){return n.y(0)-n.y(t.values.y)})}else if("linear"===a.y.type&&a.y.bin){h.attr("x",this.x(0)).attr("width",0),p.remove(),u=l.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),u.append("title"),d=l.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key});var b=a.transitions?d.exit().transition():d.exit();b.attr("x",this.x(0)).attr("width",0).remove(),d.enter().append("rect").attr("class",function(t){return"WebchartsDataMark WebchartsDataMark--Bar wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("x",this.x(0)).attr("width",0).append("title"),d.attr("shape-rendering","crispEdges").attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}),d.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=a.legend.order?a.legend.order.slice().reverse():n.values&&n.values[n.split]?n.values[n.split]:t.set(r.map(function(t){return t[n.split]})).values();var i=t.select(this.parentNode).datum(),o=i.key.split(",").map(function(t){return+t});e.rangeLow=t.min(o),e.rangeHigh=t.max(o),e.tooltip=n.tooltip}),d.select("title").text(function(t){var e=t.tooltip||"";return e.replace(/\$x/g,i(t.values.x)).replace(/\$y/g,o(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})});var k=a.transitions?d.transition():d;k.attr("x",function(t){var e=void 0;return e="stacked"===t.arrange?n.x(t.values.start):n.x(0)}).attr("y",function(t){return n.y(t.rangeHigh)}).attr("width",function(t){return n.x(t.values.x)}).attr("height",function(t){return n.y(t.rangeLow)-n.y(t.rangeHigh)})}else h.attr("y",this.y(0)).attr("height",0),p.remove(),s.remove()}function o(){this.wrap.classed("gridlines",this.config.gridlines),this.config.gridlines?(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0),"y"!==this.config.gridlines&&"xy"!==this.config.gridlines||this.svg.select(".y.axis").selectAll(".tick line").attr("x1",this.plot_width),"x"!==this.config.gridlines&&"xy"!==this.config.gridlines||this.svg.select(".x.axis").selectAll(".tick line").attr("y1",-this.plot_height)):(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0))}function s(e){var n=this,r=this.config,a=t.svg.line().interpolate(r.interpolate).x(function(t){return"linear"===r.x.type?n.x(+t.values.x):"time"===r.x.type?n.x(new Date(t.values.x)):n.x(t.values.x)+n.x.rangeBand()/2}).y(function(t){return"linear"===r.y.type?n.y(+t.values.y):"time"===r.y.type?n.y(new Date(t.values.y)):n.y(t.values.y)+n.y.rangeBand()/2}),i="percent"===r.x.summary?t.format("0%"):t.format(r.x.format),o="percent"===r.y.summary?t.format("0%"):t.format(r.y.format),s=this.svg.selectAll(".line-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});s.enter().append("g").attr("class","line-supergroup"),s.exit().remove();var l=s.selectAll(".line").data(function(t){return t.data},function(t){return t.key});l.exit().remove();var c=l.enter().append("g").attr("class",function(t){return t.key+" line"});c.append("path"),c.append("title");var u=l.select("path").attr("class","WebchartsDataMark WebchartsDataMark--Line wc-data-mark").datum(function(t){return t.values}).attr("stroke",function(t){return n.colorScale(t[0].values.raw[0][r.color_by])}).attr("stroke-width",r.stroke_width?r.stroke_width:r.flex_stroke_width).attr("stroke-linecap","round").attr("fill","none"),d=r.transitions?u.transition():u;return d.attr("d",a),l.each(function(e){var n=t.select(this.parentNode).datum();e.tooltip=n.tooltip,t.select(this).select("path").attr(n.attributes)}),l.select("title").text(function(t){var e=t.tooltip||"";return e.replace(/\$x/g,i(t.values.x)).replace(/\$y/g,o(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values[0].values.raw[0][n]})}),l}function l(e){var n=this,r=this.config,a="percent"===r.x.summary?t.format("0%"):"time"===r.x.type?t.time.format(r.x.format):t.format(r.x.format),i="percent"===r.y.summary?t.format("0%"):"time"===r.y.type?t.time.format(r.y.format):t.format(r.y.format),o=this.svg.selectAll(".point-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});o.enter().append("g").attr("class","point-supergroup"),o.exit().remove();var s=o.selectAll(".point").data(function(t){return t.data},function(t){return t.key}),l=s.exit(),c=r.transitions?l.selectAll("circle").transition():l.selectAll("circle");c.attr("r",0);var u=r.transitions?l.transition():l;u.remove();var d=s.enter().append("g").attr("class",function(t){return t.key+" point"});d.append("circle").attr("class","WebchartsDataMark WebchartsDataMark--Circle wc-data-mark").attr("r",0),d.append("title"),s.select("circle").attr("fill-opacity",r.fill_opacity||0===r.fill_opacity?r.fill_opacity:.6).attr("fill",function(t){return n.colorScale(t.values.raw[0][r.color_by])}).attr("stroke",function(t){return n.colorScale(t.values.raw[0][r.color_by])}),s.each(function(e){var n=t.select(this.parentNode).datum();e.mark=n,t.select(this).select("circle").attr(n.attributes)});var h=r.transitions?s.select("circle").transition():s.select("circle");return h.attr("r",function(t){return t.mark.radius||r.flex_point_size}).attr("cx",function(t){var e=n.x(t.values.x)||0;return"ordinal"===r.x.type?e+n.x.rangeBand()/2:e}).attr("cy",function(t){var e=n.y(t.values.y)||0;return"ordinal"===r.y.type?e+n.y.rangeBand()/2:e}),s.select("title").text(function(t){var e=t.mark.tooltip||"";return e.replace(/\$x/g,a("time"===r.x.type?new Date(t.values.x):t.values.x)).replace(/\$y/g,i("time"===r.y.type?new Date(t.values.y):t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})}),s}function c(e){function n(e){e.mark=t.select(this.parentNode).datum(),t.select(this).select("text").attr(e.mark.attributes)}var r=this,a=this.config,i=this.svg.selectAll(".text-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});i.enter().append("g").attr("class","text-supergroup"),i.exit().remove();var o=i.selectAll(".text").data(function(t){return t.data},function(t){return t.key}),s=o.exit(),l=a.transitions?s.transition():s;l.remove();var c=o.enter().append("g").attr("class",function(t){return t.key+" text"});c.append("text").attr("class","wc-data-mark"),o.each(n),o.select("text").text(function(e){var n=e.mark.text||"",r="percent"===a.x.summary?t.format("0%"):"time"===a.x.type?t.time.format(a.x.format):t.format(a.x.format),i="percent"===a.y.summary?t.format("0%"):"time"===a.y.type?t.time.format(a.y.format):t.format(a.y.format);return n.replace(/\$x/g,r("time"===a.x.type?new Date(e.values.x):e.values.x)).replace(/\$y/g,i("time"===a.y.type?new Date(e.values.y):e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values.raw[0][n]})});var u=a.transitions?o.select("text").transition():o.select("text");return u.attr("x",function(t){var e=r.x(t.values.x)||0;return"ordinal"===a.x.type?e+r.x.rangeBand()/2:e}).attr("y",function(t){var e=r.y(t.values.y)||0;return"ordinal"===a.y.type?e+r.y.rangeBand()/2:e}),o}function u(e){var n=this;t.select(this.div).select(".loader").empty()&&t.select(this.div).insert("div",":first-child").attr("class","loader").selectAll(".blockG").data(t.range(8)).enter().append("div").attr("class",function(t){return"blockG rotate"+(t+1)}),this.wrap.attr("class","WebchartsWrap"),this.setDefaults(),this.raw_data=e,this.events.onInit.call(this),this.raw_data.length&&this.checkRequired(this.raw_data),this.controls&&(this.controls.targets.push(this),this.controls.ready?this.controls.layout():this.controls.init(this.raw_data));var r=t.select(this.div).property("offsetWidth")>0;return r?(this.layout(),this.wrap.datum(this),this.draw()):!function(){console.warn("The chart cannot be initialized inside an element with 0 width.\n     The chart will be initialized as soon as the container element is given a width > 0.");var e=setInterval(function(){var r=t.select(n.div).property("offsetWidth")>0;r&&(n.layout(),n.wrap.datum(n),n.draw(),clearInterval(e))},500)}(),this}function d(){this.svg=this.wrap.append("svg").attr({class:"WebchartsChartSVG wc-svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink"}).append("g").style("display","inline-block");var e=this.svg.append("defs");e.append("pattern").attr({id:"diagonal-stripes",x:0,y:0,width:3,height:8,patternUnits:"userSpaceOnUse",patternTransform:"rotate(30)"}).append("rect").attr({x:"0",y:"0",width:"2",height:"8",style:"stroke:none; fill:black"}),e.append("clipPath").attr("id",this.id).append("rect").attr("class","WebchartsChartSVG__PlottingArea plotting-area"),this.svg.append("g").attr("class","WebchartsAxis WebchartsAxis--Y y axis").append("text").attr("class","WebchartsAxis__Title axis-title").attr("transform","rotate(-90)").attr("dy",".75em").attr("text-anchor","middle"),this.svg.append("g").attr("class","WebchartsAxis WebchartsAxis--X x axis").append("text").attr("class","WebchartsAxis__Title axis-title").attr("dy","-.35em").attr("text-anchor","middle"),this.svg.append("rect").attr("class","WebchartsChartSVG__Overlay overlay").attr("opacity",0).attr("fill","none").style("pointer-events","all");var n=this.wrap.append("ul");n.attr("class","WebchartsLegend legend").style("vertical-align","top").append("span").attr("class","WebchartsLegend__Title legend-title"),t.select(this.div).select(".loader").remove(),this.events.onLayout.call(this)}function h(){var e=arguments.length<=0||void 0===arguments[0]?this.colorScale:arguments[0],n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=this.config;a.legend.mark=a.legend.mark?a.legend.mark:a.marks.length&&"bar"===a.marks[0].type?"square":a.marks.length?a.marks[0].type:"square";var i=Boolean(n)?n:"string"==typeof a.legend.label?a.legend.label:"",o=this.legend||this.wrap.select(".legend"),s=o;s.classed("WebchartsLegend--top",!1).classed("WebchartsLegend--bottom",!1).classed("WebchartsLegend--left",!1).classed("WebchartsLegend--right",!1).classed("WebchartsLegend--"+a.legend.location,!0),"top"===this.config.legend.location||"left"===this.config.legend.location?this.wrap.node().insertBefore(o.node(),this.svg.node().parentNode):this.wrap.node().appendChild(o.node()),s.style("padding",0);var l=r||e.domain().slice(0).filter(function(t){return void 0!==t&&null!==t}).map(function(t){return{label:t,mark:a.legend.mark}});s.select(".legend-title").text(i).style("display",i?"inline":"none").style("margin-right","1em");var c=s.selectAll(".legend-item").data(l,function(t){return t.label+t.mark});c.exit().remove();var u="bottom"===this.config.legend.location||"top"===this.config.legend.location?"inline-block":"block",d=c.enter().append("li").attr("class","WebchartsLegend__Item LegendItem legend-item").style({"list-style-type":"none","margin-right":"1em"});if(d.append("span").attr("class","LegendItem__MarkText legend-mark-text").style("color",function(t){return e(t.label)}),d.append("svg").attr("class","LegendItem__MarkCanvas MarkCanvas legend-color-block").attr("width","1.1em").attr("height","1.1em").style({position:"relative",top:"0.2em"}),c.style("display",u),a.legend.order&&c.sort(function(e,n){return t.ascending(a.legend.order.indexOf(e.label),a.legend.order.indexOf(n.label))}),c.selectAll(".legend-color-block").select(".legend-mark").remove(),c.selectAll(".legend-color-block").each(function(e){var n=t.select(this);"circle"===e.mark?n.append("circle").attr({cx:".5em",cy:".45em",r:".45em",class:"MarkCanvas__Mark legend-mark"}):"line"===e.mark?n.append("line").attr({x1:0,y1:".5em",x2:"1em",y2:".5em","stroke-width":2,"shape-rendering":"crispEdges",class:"MarkCanvas__Mark legend-mark"}):"square"===e.mark&&n.append("rect").attr({height:"1em",width:"1em",class:"MarkCanvas__Mark legend-mark","shape-rendering":"crispEdges"})}),c.selectAll(".legend-color-block").select(".legend-mark").attr("fill",function(t){return t.color||e(t.label)}).attr("stroke",function(t){return t.color||e(t.label)}).each(function(e){t.select(this).attr(e.attributes)}),d.append("span").attr("class","LegendItem__Label legend-label").style("margin-left","0.25em").text(function(t){return t.label}),e.domain().length>0){var h="bottom"===this.config.legend.location||"top"===this.config.legend.location?"block":"inline-block";s.style("display",h)}else s.style("display","none");this.legend=s}function p(){var e=this.config,n=1/e.aspect,r=parseInt(this.wrap.style("width"),10),a=e.max_width?e.max_width:r,i=e.resizable?!a||a>r?r:this.raw_width:e.width;this.textSize(i),this.margin=this.setMargins();var o="ordinal"===e.x.type&&+e.range_band?this.raw_width+this.margin.left+this.margin.right:e.resizable&&(!e.max_width||r<e.max_width)?r:this.raw_width;this.plot_width=o-this.margin.left-this.margin.right;var s="ordinal"===e.y.type&&+e.range_band?this.raw_height+this.margin.top+this.margin.bottom:!e.resizable&&e.height?e.height:e.resizable?this.plot_width*n:o*n;this.plot_height=s-this.margin.top-this.margin.bottom,t.select(this.svg.node().parentNode).attr("width",o).attr("height",s).select("g").attr("transform","translate("+this.margin.left+", "+this.margin.top+")"),this.svg.select(".overlay").attr("width",this.plot_width).attr("height",this.plot_height).classed("zoomable",e.zoomable),this.svg.select(".plotting-area").attr("width",this.plot_width).attr("height",this.plot_height+1).attr("transform","translate(0, -1)"),this.xScaleAxis(),this.yScaleAxis();var l=this.svg.select(".x.axis"),c=this.svg.select(".y.axis"),u=l.select(".axis-title"),d=c.select(".axis-title");"top"!==e.x_location&&l.attr("transform","translate(0, "+this.plot_height+")");var h=e.transitions?l.transition():l;h.call(this.xAxis);var p=e.transitions?c.transition():c;p.call(this.yAxis),u.attr("transform","translate("+this.plot_width/2+", "+(this.margin.bottom-2)+")"),d.attr("x",-1*this.plot_height/2).attr("y",-1*this.margin.left),this.svg.selectAll(".axis .domain").attr({fill:"none",stroke:"#ccc","stroke-width":1,"shape-rendering":"crispEdges"}),this.svg.selectAll(".axis .tick line").attr({stroke:"#eee","stroke-width":1,"shape-rendering":"crispEdges"}),this.drawGridlines(),this.makeLegend(),this.updateDataMarks(),this.events.onResize.call(this)}function f(){var e=this.config,r="flex"===e.legend.behavior?this.filtered_data:this.raw_data,a=e.color_dom||t.set(r.map(function(t){return t[e.color_by]})).values().filter(function(t){return t&&"undefined"!==t});a=e.legend.order?a.sort(function(n,r){return t.ascending(e.legend.order.indexOf(n),e.legend.order.indexOf(r))}):a.sort(n),this.colorScale=t.scale.ordinal().domain(a).range(e.colors)}function g(){this.config.x=this.config.x||{},this.config.y=this.config.y||{},this.config.x.label=void 0!==this.config.x.label?this.config.x.label:this.config.x.column,this.config.y.label=void 0!==this.config.y.label?this.config.y.label:this.config.y.column,this.config.x.sort=this.config.x.sort||"alphabetical-ascending",this.config.y.sort=this.config.y.sort||"alphabetical-descending",this.config.x.type=this.config.x.type||"linear",this.config.y.type=this.config.y.type||"linear",this.config.x.padding=void 0!==this.config.x.padding?this.config.x.padding:.3,this.config.x.outer_pad=void 0!==this.config.x.outer_pad?this.config.x.outer_pad:.1,this.config.y.padding=void 0!==this.config.y.padding?this.config.y.padding:.3,this.config.y.outer_pad=void 0!==this.config.y.outer_pad?this.config.y.outer_pad:.1,this.config.margin=this.config.margin||{},this.config.legend=this.config.legend||{},this.config.legend.label=void 0!==this.config.legend.label?this.config.legend.label:this.config.color_by,this.config.legend.location=void 0!==this.config.legend.location?this.config.legend.location:"bottom",this.config.marks=this.config.marks&&this.config.marks.length?this.config.marks:[{}],this.config.date_format=this.config.date_format||"%x",this.config.resizable=void 0!==this.config.resizable?this.config.resizable:!0,this.config.aspect=this.config.aspect||1.33,this.config.colors=this.config.colors||["rgb(102,194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],this.config.scale_text=void 0===this.config.scale_text?!0:this.config.scale_text,this.config.transitions=void 0===this.config.transitions?!0:this.config.transitions}function m(){var t=this,e=this.yAxis.tickFormat()?this.y.domain().map(function(e){return t.yAxis.tickFormat()(e)}):this.y.domain(),n=new RegExp(/[A-Z]/g),r=Math.max.apply(null,e.map(function(t){var e=String(t).match(n)?String(t).match(n).length:0;return String(t).length-e+1.5*e}));this.config.y.format&&this.config.y.format.indexOf("%")>-1&&(r+=1),r=Math.max(2,r);var a=this.config.x.label?1.5:0,i=this.config.y.label?1.5:.25,o=parseInt(this.wrap.style("font-size"),10),s=r*o*.5+o*i*1.5||o,l=o+o/1.5+o*a||o;return s+=6,l+=3,{top:this.config.margin&&this.config.margin.top?this.config.margin.top:o,right:this.config.margin&&this.config.margin.right?this.config.margin.right:o,bottom:this.config.margin&&this.config.margin.bottom?this.config.margin.bottom:l,left:this.config.margin&&this.config.margin.left?this.config.margin.left:s}}function v(t){var e="14px",n=4,r=2;this.config.scale_text?t>=600?(e="14px",n=4,r=2):t>450&&600>t?(e="12px",n=3,r=2):t>300&&450>t?(e="10px",n=2,r=2):300>=t&&(e="10px",n=2,r=1):(e=this.config.fontSize,n=this.config.pointSize||4,r=this.config.strokeWidth||2),this.wrap.style("font-size",e),this.config.flex_point_size=n,this.config.flex_stroke_width=r}function y(t){var e=arguments.length<=1||void 0===arguments[1]?"mean":arguments[1],n=t.filter(function(t){return parseFloat(t)||0===parseFloat(t)}).map(function(t){return parseFloat(t)});if("cumulative"===e)return null;var r="count"===e?t.length:"percent"===e?t.length:F[e](n);return r}function x(e,r){function a(e){var n="ordinal"===s.x.type||"linear"===s.x.type&&s.x.bin?"y":"x";e.total=t.sum(e.values.map(function(t){return+t.values[n]}));var a=0;e.values.forEach(function(t,n){"ordinal"===s.x.type||"linear"===s.x.type&&s.x.bin?(t.values.y="percent"===r.summarizeY?t.values.y/e.total:t.values.y||0,a+=+t.values.y,t.values.start=e.values[n-1]?a:t.values.y):(t.values.x="percent"===r.summarizeX?t.values.x/e.total:t.values.x||0,t.values.start=a,a+=+t.values.x)})}function i(e,i){var o=[],l=[],c=t.nest();"linear"===s.x.type&&s.x.bin||"linear"===s.y.type&&s.y.bin?!function(){var n="linear"===s.x.type&&s.x.bin?"x":"y",r=t.scale.quantile().domain(t.extent(e.map(function(t){return+t[s[n].column]}))).range(t.range(+s[n].bin));e.forEach(function(t){t.wc_bin=r(t[s[n].column])}),c.key(function(t){return r.invertExtent(t.wc_bin)})}():c.key(function(t){return r.per.map(function(e){return t[e]}).join(" ")}),i&&(c.key(function(t){return t[i]}),c.sortKeys(function(e,r){return"time"===s.x.type?t.ascending(new Date(e),new Date(r)):s.x.domain?t.ascending(s.x.domain.indexOf(e),s.x.domain.indexOf(r)):i===s.color_by&&s.legend.order?t.ascending(s.legend.order.indexOf(e),s.legend.order.indexOf(r)):"ordinal"===s.x.type||"ordinal"===s.y.type?n(e,r):t.ascending(+e,+r)})),c.rollup(function(n){var a={raw:n},i=n.map(function(t){return t[s.y.column]}).sort(t.ascending),c=n.map(function(t){return t[s.x.column]}).sort(t.ascending);if(a.x="ordinal"===s.x.type?n[0][s.x.column]:y(c,r.summarizeX),a.y="ordinal"===s.y.type?n[0][s.y.column]:y(i,r.summarizeY),a.x_q25=s.error_bars&&"ordinal"===s.y.type?t.quantile(c,.25):a.x,a.x_q75=s.error_bars&&"ordinal"===s.y.type?t.quantile(c,.75):a.x,a.y_q25=s.error_bars?t.quantile(i,.25):a.y,a.y_q75=s.error_bars?t.quantile(i,.75):a.y,o.push([a.x_q25,a.x_q75,a.x]),l.push([a.y_q25,a.y_q75,a.y]),"cumulative"===r.summarizeY){var u=e.filter(function(t){return"time"===s.x.type?new Date(t[s.x.column])<=new Date(n[0][s.x.column]):+t[s.x.column]<=+n[0][s.x.column]});r.per.length&&(u=u.filter(function(t){return t[r.per[0]]===n[0][r.per[0]]}));var d="time"===s.x.type?u.length:t.sum(u.map(function(t){return+t[s.y.column]||0===+t[s.y.column]?+t[s.y.column]:1}));l.push([d]),a.y=d}if("cumulative"===r.summarizeX){var h=e.filter(function(t){return"time"===s.y.type?new Date(t[s.y.column])<=new Date(n[0][s.y.column]):+t[s.y.column]<=+n[0][s.y.column]});r.per.length&&(h=h.filter(function(t){return t[r.per[0]]===n[0][r.per[0]];
})),o.push([h.length]),a.x=h.length}return a});var u=c.entries(e),d=t.extent(t.merge(o)),p=t.extent(t.merge(l));return i&&"bar"===r.type&&"stacked"===r.arrange?(u.forEach(a),("ordinal"===s.x.type||"linear"===s.x.type&&s.x.bin)&&(p=t.extent(u.map(function(t){return t.total}))),("ordinal"===s.y.type||"linear"===s.y.type&&s.y.bin)&&(d=t.extent(u.map(function(t){return t.total})))):i&&"bar"===r.type&&r.split?u.forEach(a):!function(){var t="ordinal"===s.x.type||"linear"===s.x.type&&s.x.bin?"y":"x";u.forEach(function(e){e.total=e.values[t]})}(),"total-ascending"===s.x.sort&&"ordinal"===s.x.type||"total-descending"===s.y.sort&&"ordinal"===s.y.type?h=u.sort(function(e,n){return t.ascending(e.total,n.total)}).map(function(t){return t.key}):("total-descending"===s.x.sort&&"ordinal"===s.x.type||"total-ascending"===s.y.sort&&"ordinal"===s.y.type)&&(h=u.sort(function(e,n){return t.descending(+e.total,+n.total)}).map(function(t){return t.key})),{nested:u,dom_x:d,dom_y:p}}var o=this,s=this.config,l=s.x.behavior||"raw",c=s.y.behavior||"raw",u="line"===r.type?s.x.column:"bar"===r.type&&r.split?r.split:null,d=t.time.format(s.date_format),h=void 0,p=e;p=r.per&&r.per.length?p.filter(function(t){return t[r.per[0]]}):p,s.x.column&&(p=p.filter(function(t){return void 0!==t[s.x.column]})),s.y.column&&(p=p.filter(function(t){return void 0!==t[s.y.column]})),"time"===s.x.type&&(p=p.filter(function(t){return t[s.x.column]instanceof Date?t[s.x.column]:d.parse(t[s.x.column])}),p.forEach(function(t){t[s.x.column]=t[s.x.column]instanceof Date?t[s.x.column]:d.parse(t[s.x.column])})),"time"===s.y.type&&(p=p.filter(function(t){return t[s.y.column]instanceof Date?t[s.y.column]:d.parse(t[s.y.column])}),p.forEach(function(t){t[s.y.column]=t[s.y.column]instanceof Date?t[s.y.column]:d.parse(t[s.y.column])})),"linear"!==s.x.type&&"log"!==s.x.type||!s.x.column||(p=p.filter(function(t){return"count"!==r.summarizeX&&"percent"!==r.summarizeX?+t[s.x.column]||0===+t[s.x.column]:t})),"linear"!==s.y.type&&"log"!==s.y.type||!s.y.column||(p=p.filter(function(t){return"count"!==r.summarizeY&&"percent"!==r.summarizeY?+t[s.y.column]||0===+t[s.y.column]:t}));var f=void 0;"bar"===r.type?f="stacked"!==r.arrange?i(p,u):i(p):"count"!==r.summarizeX&&"count"!==r.summarizeY||(f=i(p));var g="cumulative"===r.summarizeX?[0,p.length]:"ordinal"===s.x.type?t.set(p.map(function(t){return t[s.x.column]})).values().filter(function(t){return t}):r.split&&"stacked"!==r.arrange?t.extent(t.merge(f.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})}))):"count"===r.summarizeX?t.extent(f.nested.map(function(t){return t.values.raw.length})):t.extent(p.map(function(t){return+t[s.x.column]}).filter(function(t){return+t||0===+t})),m="cumulative"===r.summarizeY?[0,p.length]:"ordinal"===s.y.type?t.set(p.map(function(t){return t[s.y.column]})).values().filter(function(t){return t}):r.split&&"stacked"!==r.arrange?t.extent(t.merge(f.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})}))):"count"===r.summarizeY?t.extent(f.nested.map(function(t){return t.values.raw.length})):t.extent(p.map(function(t){return+t[s.y.column]}).filter(function(t){return+t||0===+t})),v=p,x=[],b=[];if(this.filters.length&&(this.filters.forEach(function(t){v=v.filter(function(e){return"All"===t.val?e:t.val instanceof Array?t.val.indexOf(e[t.col])>-1:e[t.col]===t.val})}),"firstfilter"!==s.x.behavior&&"firstfilter"!==s.y.behavior||this.filters[0].choices.filter(function(t){return"All"!==t}).forEach(function(t){var e=p.filter(function(e){return e[o.filters[0].col]===t}),n=i(e,u);x.push(n.domX),b.push(n.domY)})),r.values){var k=function(t){Object.hasOwnProperty.call(r.values,t)&&(v=v.filter(function(e){return r.values[t].indexOf(e[t])>-1}))};for(var w in r.values)k(w)}var _=t.extent(t.merge(x)),A=t.extent(t.merge(b));this.filtered_data=v;var O=i(v,u),C=O.dom_x,z=O.dom_y;"bar"===r.type&&("ordinal"===s.y.type&&"count"===r.summarizeX?s.x.domain=s.x.domain?[0,s.x.domain[1]]:[0,null]:"ordinal"===s.x.type&&"count"===r.summarizeY&&(s.y.domain=s.y.domain?[0,s.y.domain[1]]:[0,null]));var W=Boolean(this.filters.length&&"All"!==this.filters[0].val&&this.filters.slice(1).filter(function(t){return"All"===t.val}).length===this.filters.length-1),D=this.filters.length?"raw"===l?g:W&&"firstfilter"===l?_:C:C,B=this.filters.length?"raw"===c?m:W&&"firstfilter"===c?A:z:z,S="ordinal"===s.x.type&&"flex"===s.x.behavior?t.set(v.map(function(t){return t[s.x.column]})).values():"ordinal"===s.x.type?t.set(p.map(function(t){return t[s.x.column]})).values():D,E="ordinal"===s.y.type&&"flex"===s.y.behavior?t.set(v.map(function(t){return t[s.y.column]})).values():"ordinal"===s.y.type?t.set(p.map(function(t){return t[s.y.column]})).values():B;return s.x.domain&&(s.x.domain[0]||0===s.x.domain[0])&&(S[0]=s.x.domain[0]),s.x.domain&&(s.x.domain[1]||0===s.x.domain[1])&&(S[1]=s.x.domain[1]),s.y.domain&&(s.y.domain[0]||0===s.y.domain[0])&&(E[0]=s.y.domain[0]),s.y.domain&&(s.y.domain[1]||0===s.y.domain[1])&&(E[1]=s.y.domain[1]),"ordinal"!==s.x.type||s.x.order||(s.x.order=h),"ordinal"!==s.y.type||s.y.order||(s.y.order=h),this.current_data=O.nested,this.events.onDatatransform.call(this),{data:O.nested,x_dom:S,y_dom:E}}function b(){this.drawBars(this.marks.filter(function(t){return"bar"===t.type})),this.drawLines(this.marks.filter(function(t){return"line"===t.type})),this.drawPoints(this.marks.filter(function(t){return"circle"===t.type})),this.drawText(this.marks.filter(function(t){return"text"===t.type}))}function k(){var e=arguments.length<=0||void 0===arguments[0]?this.plot_width:arguments[0],n=arguments.length<=1||void 0===arguments[1]?this.x_dom:arguments[1],r=arguments.length<=2||void 0===arguments[2]?this.config.x.type:arguments[2],a=this.config,i=void 0;i="log"===r?t.scale.log():"ordinal"===r?t.scale.ordinal():"time"===r?t.time.scale():t.scale.linear(),i.domain(n),"ordinal"===r?i.rangeBands([0,+e],a.x.padding,a.x.outer_pad):i.range([0,+e]).clamp(Boolean(a.x.clamp));var o=a.x.format?a.x.format:a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?"0%":"time"===r?"%x":".0f",s=Math.max(2,Math.min(e/80,8)),l=t.svg.axis().scale(i).orient(a.x.location).ticks(s).tickFormat("ordinal"===r?null:"time"===r?t.time.format(o):t.format(o)).tickValues(a.x.ticks?a.x.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.x.axis").attr("class","x axis "+r),this.x=i,this.xAxis=l}function w(){var e=arguments.length<=0||void 0===arguments[0]?this.plot_height:arguments[0],n=arguments.length<=1||void 0===arguments[1]?this.y_dom:arguments[1],r=arguments.length<=2||void 0===arguments[2]?this.config.y.type:arguments[2],a=this.config,i=void 0;i="log"===r?t.scale.log():"ordinal"===r?t.scale.ordinal():"time"===r?t.time.scale():t.scale.linear(),i.domain(n),"ordinal"===r?i.rangeBands([+e,0],a.y.padding,a.y.outer_pad):i.range([+e,0]).clamp(Boolean(a.y.clamp));var o=a.y.format?a.y.format:a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?"0%":".0f",s=Math.max(2,Math.min(e/80,8)),l=t.svg.axis().scale(i).orient("left").ticks(s).tickFormat("ordinal"===r?null:"time"===r?t.time.format(o):t.format(o)).tickValues(a.y.ticks?a.y.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.y.axis").attr("class","y axis "+r),this.y=i,this.yAxis=l}function _(){function e(t,e){var n=["init","layout","preprocess","datatransform","draw","resize"];n.indexOf(t)<0||e&&(i.events["on"+(t.charAt(0).toUpperCase()+t.slice(1))]=e)}var n=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],i=Object.create(U);return i.div=n,i.config=Object.create(r),i.controls=a,i.raw_data=[],i.filters=[],i.marks=[],i.wrap=t.select(i.div).append("div"),i.events={onInit:function(){},onLayout:function(){},onPreprocess:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},i.on=e,V++,i.id=V,i}function A(t,e,n){var r=e.replace(/\[(\w+)\]/g,".$1");r=r.replace(/^\./,"");for(var a=r.split("."),i=Object.create(t),o=0,s=a.length;s>o;++o){var l=a[o];if(!(l in i))break;o===s-1&&void 0!==n&&(i[l]=n),i=i[l]}return i}function O(t,e,n){this.targets.forEach(function(r){t instanceof Array?t.forEach(function(t){return A(r.config,t,e)}):A(r.config,t,e),n&&n(),r.draw()})}function C(t){if(t[0]&&this.config.inputs){var e=Object.keys(t[0]);this.config.inputs.forEach(function(t){if("subsetter"===t.type&&-1===e.indexOf(t.value_col))throw new Error('Error in settings object: the value "'+t.value_col+'" does not match any column in the provided dataset.')})}}function z(){var t=this;this.config.inputs&&this.config.inputs.length&&this.config.inputs[0]&&this.config.inputs.forEach(function(e){return t.makeControlItem(e)})}function W(t){this.data=t,this.wrap.attr("class","WebchartsWrap"),this.checkRequired(this.data),this.layout()}function D(){this.wrap.selectAll("*").remove(),this.ready=!0,this.controlUpdate()}function B(t){var e=this.wrap.append("div").attr("class","WebchartsControlGroup WebchartsControlGroup--"+t.type).classed("WebchartsControlGroup--inline",t.inline).datum(t);if(e.append("span").attr("class","WebchartsControlGroup__Title").text(t.label),e.append("span").attr("class","WebchartsControlGroup__Description").text(t.description),"text"===t.type)this.makeTextControl(t,e);else if("number"===t.type)this.makeNumberControl(t,e);else if("list"===t.type)this.makeListControl(t,e);else if("dropdown"===t.type)this.makeDropdownControl(t,e);else if("btngroup"===t.type)this.makeBtnGroupControl(t,e);else if("checkbox"===t.type)this.makeCheckboxControl(t,e);else if("radio"===t.type)this.makeRadioControl(t,e);else{if("subsetter"!==t.type)throw new Error('Each control must have a type! Choose from: "text", "number",\n     "list", "dropdown", "btngroup", "checkbox", "radio", "subsetter"');this.makeSubsetterControl(t,e)}}function S(e,n){var r=this,a=e.values?e.values:t.keys(this.data[0]),i=n.append("div").attr("class","WebchartsControlGroup__ButtonGroup WebchartsButtonGroup btn-group"),o=i.selectAll("button").data(a).enter().append("button").attr("class","WebchartsButtonGroup__Button").text(function(t){return t}).classed("WebchartsButtonGroup__Button--active",function(t){return A(r.targets[0].config,e.option)===t});o.on("click",function(n){o.each(function(e){t.select(this).classed("WebchartsButtonGroup__Button--active",e===n)}),e.options?r.changeOption(e.options,n,e.callback):r.changeOption(e.option,n,e.callback)})}function E(t,e){var n=this,r=e.append("input").attr("type","checkbox").attr("class","WebchartsControlGroup__Control").datum(t).property("checked",function(){return A(n.targets[0].config,t.option)});r.on("change",function(e){var a=r.property("checked");e.options?n.changeOption(e.options,a,t.callback):n.changeOption(e.option,a,t.callback)})}function L(e,n){var r=this,a=e.option||e.options[0],i=n.append("select").attr("class","WebchartsControlGroup__Control").attr("multiple",e.multiple?!0:null).datum(e),o=e.values&&e.values instanceof Array?e.values:e.values?t.set(this.data.map(function(t){return t[r.targets[0].config[e.values]]})).values():t.keys(this.data[0]);e.require&&!e.none||o.unshift("None");var s=i.selectAll("option").data(o).enter().append("option").text(function(t){return t}).property("selected",function(t){return A(r.targets[0].config,a)===t});return i.on("change",function(){var n="None"===i.property("value")?null:i.property("value");e.multiple&&(n=s.filter(function(){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("value")}).filter(function(t){return"None"!==t})),e.options?r.changeOption(e.options,n,e.callback):r.changeOption(e.option,n,e.callback)}),i}function M(t,e){var n=this,r=e.append("input").attr("type","text").attr("class","WebchartsControlGroup__Control").datum(t).property("value",function(){return A(n.targets[0].config,t.option)});r.on("change",function(){var e=r.property("value")?r.property("value").split(",").map(function(t){return t.trim()}):null;t.options?n.changeOption(t.options,e,t.callback):n.changeOption(t.option,e,t.callback)})}function G(t,e){var n=this,r=e.append("input").attr("type","number").attr("min",void 0!==t.min?t.min:0).attr("max",t.max).attr("step",t.step||1).attr("class","WebchartsControlGroup__Control").datum(t).property("value",function(){return A(n.targets[0].config,t.option)});r.on("change",function(){var e=+r.property("value");t.options?n.changeOption(t.options,e,t.callback):n.changeOption(t.option,e,t.callback)})}function q(e,n){var r=this,a=n.selectAll("label").data(e.values||t.keys(this.data[0])).enter().append("label").attr("class","WebchartsControlGroup__Label WebchartsControlGroup__Label--radio").text(function(t,n){return e.relabels?e.relabels[n]:t}).append("input").attr("type","radio").attr("class","WebchartsControlGroup__Control").attr("name",e.option.replace(".","-")+"-"+this.targets[0].id).property("value",function(t){return t}).property("checked",function(t){return A(r.targets[0].config,e.option)===t});a.on("change",function(){var n=null;a.each(function(e){t.select(this).property("checked")&&(n="none"===t.select(this).property("value")?null:e)}),e.options?r.changeOption(e.options,n,e.callback):r.changeOption(e.option,n,e.callback)})}function j(e,r){function a(t,e){var n=-1;t.filters.forEach(function(t,r){t.col===e.col&&(n=r)}),n>-1&&(t.filters[n]=e)}var i=this.targets,o=r.append("select").attr("class","WebchartsControlGroup__Control").attr("multiple",e.multiple?!0:null).datum(e),s=e.values?e.values:t.set(this.data.map(function(t){return t[e.value_col]}).filter(function(t){return t})).values();s.sort(n),e.start=e.start?e.start:e.loose?s[0]:null,e.multiple||e.start||s.unshift("All"),e.loose=!e.loose&&e.start?!0:e.loose;var l=o.selectAll("option").data(s).enter().append("option").text(function(t){return t}).property("selected",function(t){return t===e.start});i.forEach(function(t){var n=t.filters.slice().map(function(t){return t.col===e.value_col}).indexOf(!0);n>-1?t.filters[n]={col:e.value_col,val:e.start?e.start:"All",choices:s,loose:e.loose}:t.filters.push({col:e.value_col,val:e.start?e.start:"All",choices:s,loose:e.loose})}),o.on("change",function(){var n=this;e.multiple?!function(){var n=l.filter(function(){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("text")}),r={col:e.value_col,val:n,choices:s,loose:e.loose};i.forEach(function(t){a(t,r),e.callback&&e.callback(),t.draw()})}():!function(){var r=t.select(n).select("option:checked").property("text"),o={col:e.value_col,val:r,choices:s,loose:e.loose};i.forEach(function(t){a(t,o),e.callback&&e.callback(),t.draw()})}()})}function N(t,e){var n=this,r=e.append("input").attr("type","text").attr("class","WebchartsControlGroup__Control").datum(t).property("value",function(){return A(n.targets[0].config,t.option)});r.on("change",function(){var e=r.property("value");t.options?n.changeOption(t.options,e,t.callback):n.changeOption(t.option,e,t.callback)})}function T(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=Object.create(K);return r.div=e,r.config=Object.create(n),r.config.inputs=r.config.inputs||[],r.targets=[],"bottom"===n.location?r.wrap=t.select(e).append("div"):r.wrap=t.select(e).insert("div",":first-child"),r}function I(){t.select(this.div).select(".loader").remove();var e=this.wrap.append("table").attr("class","WebchartsTable");e.append("thead").append("tr").attr("class","WebchartsTable__HeaderRow headers"),this.table=e,this.events.onLayout.call(this)}function $(e){if(!e)return!1;var n=this.config,r=n.cols||t.keys(e[0]);n.keep&&n.keep.forEach(function(t){-1===r.indexOf(t)&&r.unshift(t)}),this.config.cols=r;var a=e;this.filters.length&&this.filters.forEach(function(t){var e=t.val instanceof Array;a=a.filter(function(n){var r=void 0;return r=e?-1!==t.val.indexOf(n[t.col]):"All"!==t.val?n[t.col]===t.val:n})});var i=t.nest().key(function(t){var e=void 0;return e=n.row_per?n.row_per.map(function(e){return t[e]}).join(" "):t}).rollup(function(t){var e=t.map(function(t){var e=[];for(var r in t)Object.hasOwnProperty.call(t,r)&&e.push({col:r,text:t[r]});return e.sort(function(t,e){return n.cols.indexOf(t.col)-n.cols.indexOf(e.col)}),{cells:e,raw:t}});return e}).entries(a);return this.current_data=i,this.events.onDatatransform.call(this),this.current_data}function X(){var e=arguments.length<=0||void 0===arguments[0]?this.raw_data:arguments[0],n=arguments[1],r=this.config,a=this.table,i=n||this.transformData(e);this.wrap.datum(i);var o=r.cols.length?r.cols:i.length?t.keys(i[0].values[0].raw):[],s=i.length?r.headers&&r.headers.length?r.headers:o:[],l=a.select("thead").select("tr.headers"),c=l.selectAll("th").data(s);c.exit().remove(),c.enter().append("th"),c.text(function(t){return t});var u=a.selectAll("tbody").data(i,function(t){return t.key});if(u.exit().remove(),u.enter().append("tbody"),r.row_per){var d=r.row_per.slice(0).reverse();d.forEach(function(t){u.sort(function(e,n){return e.values[0].raw[t]-n.values[0].raw[t]})})}var h=u.selectAll("tr").data(function(t){return t.values});h.exit().remove(),h.enter().append("tr"),r.sort_rows&&!function(){var t=r.sort_rows.slice(0);t.unshift("0"),h.sort(function(e,n){for(var r=0;r<t.length&&e.raw[t[r]]===n.raw[t[r]];)r++;return e.raw[t[r]]<n.raw[t[r]]?-1:e.raw[t[r]]>n.raw[t[r]]?1:0})}();var p=h.selectAll("td").data(function(t){return t.cells.filter(function(t){return o.indexOf(t.col)>-1})});p.exit().remove(),p.enter().append("td"),p.attr("class",function(t){return t.col}),r.as_html?p.html(function(t){return t.text}):p.text(function(t){return t.text}),r.row_per&&h.filter(function(t,e){return e>0}).selectAll("td").filter(function(t){return r.row_per.indexOf(t.col)>-1}).text(""),this.events.onDraw.call(this)}function Y(){function e(t,e){var n=["init","layout","datatransform","draw","resize"];n.indexOf(t)<0||e&&(i.events["on"+(t.charAt(0).toUpperCase()+t.slice(1))]=e)}var n=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments.length<=2||void 0===arguments[2]?null:arguments[2],i=Object.create(Z);return i.div=n,i.config=Object.create(r),i.controls=a,i.filters=[],i.required_cols=[],i.marks=[],i.wrap=t.select(i.div).append("div"),i.events={onInit:function(){},onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},i.on=e,i}function R(e,n,r,a){function i(n){var i=t.set(n.map(function(t){return t[r]})).values().filter(function(t){return t});a&&(i=i.sort(function(e,n){return t.ascending(a.indexOf(e),a.indexOf(n))})),i.forEach(function(t){var a=_(e.wrap.node(),o,e.controls);a.events=e.events,a.legend=l,a.filters.unshift({col:r,val:t,choices:i}),a.wrap.insert("span","svg").attr("class","wc-chart-title").text(t),a.init(n)})}var o=e.config,s=e.wrap.classed("wc-layout wc-small-multiples",!0).classed("wc-chart",!1),l=s.append("ul").attr("class","legend");i(n)}var P="2.0.0-rc.1",F={min:t.min,max:t.max,mean:t.mean,median:t.median,sum:t.sum},H={raw_data:[],config:{}},U=Object.create(H,{checkRequired:{value:e},consolidateData:{value:r},draw:{value:a},drawBars:{value:i},drawGridlines:{value:o},drawLines:{value:s},drawPoints:{value:l},drawText:{value:c},init:{value:u},layout:{value:d},makeLegend:{value:h},resize:{value:p},setColorScale:{value:f},setDefaults:{value:g},setMargins:{value:m},textSize:{value:v},transformData:{value:x},updateDataMarks:{value:b},xScaleAxis:{value:k},yScaleAxis:{value:w}}),V=0,K={changeOption:O,checkRequired:C,controlUpdate:z,init:W,layout:D,makeControlItem:B,makeBtnGroupControl:S,makeCheckboxControl:E,makeDropdownControl:L,makeListControl:M,makeNumberControl:G,makeRadioControl:q,makeSubsetterControl:j,makeTextControl:N},Z=Object.create(U,{layout:{value:I},transformData:{value:$},draw:{value:X}}),J={version:P,createChart:_,createControls:T,createTable:Y,multiply:R};return J});
