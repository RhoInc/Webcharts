!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof module&&module.exports?module.exports=e(require("d3")):t.webCharts=e(t.d3)}(this,function(t){function e(e,r){var n=t.set(e.map(function(t){return t[r]})).values(),a=n.filter(function(t){return+t||0==t});return n.length===a.length&&n.length>4?"continuous":"categorical"}function r(t,e){var r=[];return t.forEach(function(t){e.forEach(function(e){var n=Object.create(t);n.wc_category=e,n.wc_value=t[e],r.push(n)})}),r}function n(t,e){function r(t){for(var e=[],r=0,n=-1,a=0,i=void 0,o=void 0;i=(o=t.charAt(r++)).charCodeAt(0);){var s=46==i||i>=48&&57>=i;s!==a&&(e[++n]="",a=s),e[n]+=o}return e}for(var n=r(t.toLowerCase()),a=r(e.toLowerCase()),i=0;n[i]&&a[i];i++)if(n[i]!==a[i]){var o=Number(n[i]),s=Number(a[i]);return o==n[i]&&s==a[i]?o-s:n[i]>a[i]?1:-1}return n.length-a.length}function a(e,r){var n=e.filter(function(t){return+t||0===+t}).map(function(t){return+t});if("cumulative"===r)return null;var a=r||"mean",i="count"===a?e.length:"percent"===a?e.length:t[a](n);return i}function i(e){var r=this,n=t.keys(e[0]),a=[],i=[];this.config.x.column&&(a.push("this.config.x.column"),i.push(this.config.x.column)),this.config.y.column&&(a.push("this.config.y.column"),i.push(this.config.y.column)),this.config.color_by&&(a.push("this.config.color_by"),i.push(this.config.color_by)),this.config.marks.forEach(function(t,e){t.per&&t.per.length&&t.per.forEach(function(t,r){a.push("this.config.marks["+e+"].per["+r+"]"),i.push(t)}),t.split&&(a.push("this.config.marks["+e+"].split"),i.push(t.split))}),i.forEach(function(e,i){if(n.indexOf(e)<0)throw t.select(r.div).select(".loader").remove(),r.wrap.append("div").style("color","red").html('The value "'+e+'" for the <code>'+a[i]+"</code> setting does not match any column in the provided dataset."),new Error('Error in settings object: The value "'+e+'" for the '+a[i]+" setting does not match any column in the provided dataset.")})}function o(e){var r=this,n=this.config,a=[],i=[],o=[];this.setDefaults(),n.marks.forEach(function(t,n){"bar"!==t.type&&(t.arrange=null,t.split=null);var s=t.per?r.transformData(e,t):{data:[],x_dom:[],y_dom:[]};a.push(s.data),i.push(s.x_dom),o.push(s.y_dom),r.marks[n]=Object.create(t),r.marks[n].data=s.data}),"ordinal"===n.x.type?n.x.sort&&"alphabetical-descending"===n.x.sort?this.x_dom=t.set(t.merge(i)).values().sort(G.dataOps.naturalSorter).reverse():"time"===n.y.type&&"earliest"===n.x.sort?this.x_dom=t.nest().key(function(t){return t[n.x.column]}).rollup(function(t){return t.map(function(t){return t[n.y.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,r){return t.min(r.values)-t.min(e.values)}).map(function(t){return t.key}):n.x.order?this.x_dom=t.set(t.merge(i)).values().sort(function(e,r){return t.ascending(n.x.order.indexOf(e),n.x.order.indexOf(r))}):n.x.sort&&"alphabetical-descending"!==n.x.sort?this.x_dom=t.set(t.merge(i)).values():this.x_dom=t.set(t.merge(i)).values().sort(G.dataOps.naturalSorter):n.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?this.x_dom=[0,1]:this.x_dom=t.extent(t.merge(i)),"ordinal"===n.y.type?n.y.sort&&"alphabetical-ascending"===n.y.sort?this.y_dom=t.set(t.merge(o)).values().sort(G.dataOps.naturalSorter):"time"===n.x.type&&"earliest"===n.y.sort?this.y_dom=t.nest().key(function(t){return t[n.y.column]}).rollup(function(t){return t.map(function(t){return t[n.x.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,r){return t.min(r.values)-t.min(e.values)}).map(function(t){return t.key}):n.y.order?this.y_dom=t.set(t.merge(o)).values().sort(function(e,r){return t.ascending(n.y.order.indexOf(e),n.y.order.indexOf(r))}):n.y.sort&&"alphabetical-descending"!==n.y.sort?this.y_dom=t.set(t.merge(o)).values():this.y_dom=t.set(t.merge(o)).values().sort(G.dataOps.naturalSorter).reverse():n.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?this.y_dom=[0,1]:this.y_dom=t.extent(t.merge(o))}function s(e,r){var n=this,a=this,i=e?e:this.raw_data?this.raw_data:[],o=this.config,s=1/o.aspect,l=r||this.consolidateData(i);this.wrap.datum(l);var c=parseInt(this.wrap.style("width"));this.setColorScale();var u=o.max_width?o.max_width:c;this.raw_width="ordinal"===o.x.type&&+o.range_band?(+o.range_band+o.range_band*o.padding)*this.x_dom.length:o.resizable?u:o.width?o.width:c,this.raw_height="ordinal"===o.y.type&&+o.range_band?(+o.range_band+o.range_band*o.padding)*this.y_dom.length:o.resizable?u*s:o.height?o.height:c*s;var f=this.svg.select(".overlay").attr("width")?this.svg.select(".overlay").attr("width"):this.raw_width,d=this.svg.select(".overlay").attr("height")?this.svg.select(".overlay").attr("height"):this.raw_height;this.svg.select(".x.axis").select(".axis-title").text(function(t){return"string"==typeof o.x.label?o.x.label:"function"==typeof o.x.label?o.x.label.call(n):null}),this.svg.select(".y.axis").select(".axis-title").text(function(t){return"string"==typeof o.y.label?o.y.label:"function"==typeof o.y.label?o.y.label.call(n):null}),this.xScaleAxis(f),this.yScaleAxis(d),o.resizable?t.select(window).on("resize."+a.element+a.id,function(){a.resize()}):t.select(window).on("resize."+a.element+a.id,null),this.events.onDraw.call(this),this.resize()}function l(t,e,r,n,a){void 0===n&&(n="chart-area");var i=this,o=arguments.length<=5||void 0===arguments[5]?function(t){return t}:arguments[5],s=this.svg.selectAll("."+n).data(e,a);return s.exit().remove(),s.enter().append("g").attr("class",function(t){return n+" "+t.key}).append("path"),s.select("path").datum(r).attr("fill",function(t){var e=o(t);return e?i.colorScale(e[i.config.color_by]):null}).attr("fill-opacity",this.config.fill_opacity||0===this.config.fill_opacity?this.config.fill_opacity:.3).transition().attr("d",t),s}function c(e){var r=this,n=this.raw_data,a=this.config,i=this.svg.selectAll(".bar-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});i.enter().append("g").attr("class","bar-supergroup"),i.exit().remove();var o=i.selectAll(".bar-group").data(function(t){return t.data},function(t){return t.key}),s=o.exit(),l=void 0,c=void 0;"ordinal"===a.x.type?!function(){s.selectAll(".bar").transition().attr("y",r.y(0)).attr("height",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("y",r.y(0)).attr("height",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+r.id+")").attr("y",r.y(0)).attr("height",0).append("title"),c.attr("stroke",function(t){return r.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return r.colorScale(t.values.raw[0][a.color_by])}),c.each(function(e){var r=t.select(this.parentNode.parentNode).datum();e.tooltip=r.tooltip,e.arrange=r.split?r.arrange:null,e.subcats=t.set(n.map(function(t){return t[r.split]})).values(),t.select(this).attr(r.attributes)});var e=a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?t.format("0%"):t.format(a.x.format),i=a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?t.format("0%"):t.format(a.y.format);c.select("title").text(function(t){var r=t.tooltip||"";return r.replace(/\$x/g,e(t.values.x)).replace(/\$y/g,i(t.values.y)).replace(/\[(.+?)\]/g,function(e,r){return t.values.raw[0][r]})}),c.transition().attr("x",function(t){var e=void 0;if(t.arrange&&"stacked"!==t.arrange){if("nested"===t.arrange){e=t.subcats.indexOf(t.key);var n=e?r.x.rangeBand()/(t.subcats.length*e*.5)/2:r.x.rangeBand()/2;return r.x(t.values.x)+r.x.rangeBand()/2-n}return e=t.subcats.indexOf(t.key),r.x(t.values.x)+r.x.rangeBand()/t.subcats.length*e}return r.x(t.values.x)}).attr("y",function(t){return"stacked"!==t.arrange?r.y(t.values.y):r.y(t.values.start)}).attr("width",function(t){if("stacked"===t.arrange)return r.x.rangeBand();if("nested"===t.arrange){var e=t.subcats.indexOf(t.key);return e?r.x.rangeBand()/(t.subcats.length*e*.5):r.x.rangeBand()}return r.x.rangeBand()/t.subcats.length}).attr("height",function(t){return r.y(0)-r.y(t.values.y)})}():"ordinal"===a.y.type?!function(){s.selectAll(".bar").transition().attr("x",r.x(0)).attr("width",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("x",r.x(0)).attr("width",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+r.id+")").attr("x",r.x(0)).attr("width",0).append("title"),c.attr("stroke",function(t){return r.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return r.colorScale(t.values.raw[0][a.color_by])}),c.each(function(e){var r=t.select(this.parentNode.parentNode).datum();e.arrange=r.split&&r.arrange?r.arrange:r.split?"grouped":null,e.subcats=t.set(n.map(function(t){return t[r.split]})).values(),e.tooltip=r.tooltip});var e=a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?t.format("0%"):t.format(a.x.format),i=a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?t.format("0%"):t.format(a.y.format);c.select("title").text(function(t){var r=t.tooltip||"";return r.replace(/\$x/g,e(t.values.x)).replace(/\$y/g,i(t.values.y)).replace(/\[(.+?)\]/g,function(e,r){return t.values.raw[0][r]})}),c.transition().attr("x",function(t){return"stacked"!==t.arrange&&t.arrange?r.x(0):void 0!==t.values.start?r.x(t.values.start):r.x(0)}).attr("y",function(t){if("nested"===t.arrange){var e=t.subcats.indexOf(t.key),n=e?r.y.rangeBand()/(.75*t.subcats.length)/e:r.y.rangeBand();return r.y(t.values.y)+(r.y.rangeBand()-n)/2}if("grouped"===t.arrange){var e=t.subcats.indexOf(t.key);return r.y(t.values.y)+r.y.rangeBand()/t.subcats.length*e}return r.y(t.values.y)}).attr("width",function(t){return r.x(t.values.x)-r.x(0)}).attr("height",function(t){if("quantile"===a.y.type)return 20;if("nested"===t.arrange){var e=t.subcats.indexOf(t.key);return e?r.y.rangeBand()/(.75*t.subcats.length)/e:r.y.rangeBand()}return"grouped"===t.arrange?r.y.rangeBand()/t.subcats.length:r.y.rangeBand()})}():"linear"===a.x.type&&a.x.bin?!function(){s.selectAll(".bar").transition().attr("y",r.y(0)).attr("height",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("y",r.y(0)).attr("height",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+r.id+")").attr("y",r.y(0)).attr("height",0).append("title"),c.attr("stroke",function(t){return r.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return r.colorScale(t.values.raw[0][a.color_by])}),c.each(function(e){var r=t.select(this.parentNode.parentNode).datum();e.arrange=r.split?r.arrange:null,e.subcats=t.set(n.map(function(t){return t[r.split]})).values(),t.select(this).attr(r.attributes);var a=t.select(this.parentNode).datum(),i=a.key.split(",").map(function(t){return+t});e.rangeLow=t.min(i),e.rangeHigh=t.max(i),e.tooltip=r.tooltip});var e=a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?t.format("0%"):t.format(a.x.format),i=a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?t.format("0%"):t.format(a.y.format);c.select("title").text(function(t){var r=t.tooltip||"";return r.replace(/\$x/g,e(t.values.x)).replace(/\$y/g,i(t.values.y)).replace(/\[(.+?)\]/g,function(e,r){return t.values.raw[0][r]})}),c.transition().attr("x",function(t){return r.x(t.rangeLow)}).attr("y",function(t){return"stacked"!==t.arrange?r.y(t.values.y):r.y(t.values.start)}).attr("width",function(t){return r.x(t.rangeHigh)-r.x(t.rangeLow)}).attr("height",function(t){return r.y(0)-r.y(t.values.y)})}():"linear"===a.y.type&&a.y.bin?!function(){s.selectAll(".bar").transition().attr("x",r.x(0)).attr("width",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("x",r.x(0)).attr("width",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+r.id+")").attr("x",r.x(0)).attr("width",0).append("title"),c.attr("stroke",function(t){return r.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return r.colorScale(t.values.raw[0][a.color_by])}),c.each(function(e){var r=t.select(this.parentNode.parentNode).datum();e.arrange=r.split?r.arrange:null,e.subcats=t.set(n.map(function(t){return t[r.split]})).values();var a=t.select(this.parentNode).datum(),i=a.key.split(",").map(function(t){return+t});e.rangeLow=t.min(i),e.rangeHigh=t.max(i),e.tooltip=r.tooltip});var e=a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?t.format("0%"):t.format(a.x.format),i=a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?t.format("0%"):t.format(a.y.format);c.select("title").text(function(t){var r=t.tooltip||"";return r.replace(/\$x/g,e(t.values.x)).replace(/\$y/g,i(t.values.y)).replace(/\[(.+?)\]/g,function(e,r){return t.values.raw[0][r]})}),c.transition().attr("x",function(t){return"stacked"===t.arrange?r.x(t.values.start):r.x(0)}).attr("y",function(t){return r.y(t.rangeHigh)}).attr("width",function(t){return r.x(t.values.x)}).attr("height",function(t){return r.y(t.rangeLow)-r.y(t.rangeHigh)})}():(s.selectAll(".bar").transition().attr("y",this.y(0)).attr("height",0),s.transition().remove(),i.remove())}function u(){this.wrap.classed("gridlines",this.config.gridlines),this.config.gridlines?(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0),("y"===this.config.gridlines||"xy"===this.config.gridlines)&&this.svg.select(".y.axis").selectAll(".tick line").attr("x1",this.plot_width),("x"===this.config.gridlines||"xy"===this.config.gridlines)&&this.svg.select(".x.axis").selectAll(".tick line").attr("y1",-this.plot_height)):(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0))}function f(e){var r=this,n=this.config,a=t.svg.line().interpolate(n.interpolate).x(function(t){return"linear"===n.x.type?r.x(+t.values.x):"time"===n.x.type?r.x(new Date(t.values.x)):r.x(t.values.x)+r.x.rangeBand()/2}).y(function(t){return"linear"===n.y.type?r.y(+t.values.y):"time"===n.y.type?r.y(new Date(t.values.y)):r.y(t.values.y)+r.y.rangeBand()/2}),i=this.svg.selectAll(".line-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});i.enter().append("g").attr("class","line-supergroup"),i.exit().remove();var o=i.selectAll(".line").data(function(t){return t.data},function(t){return t.key});o.exit().remove();var s=o.enter().append("g").attr("class",function(t){return t.key+" line"});return s.append("path"),s.append("title"),o.select("path").attr("class","wc-data-mark").datum(function(t){return t.values}).attr("stroke",function(t){return r.colorScale(t[0].values.raw[0][n.color_by])}).attr("stroke-width",n.stroke_width?n.stroke_width:n.flex_stroke_width).attr("stroke-linecap","round").attr("fill","none").transition().attr("d",a),o.each(function(e){var r=t.select(this.parentNode).datum();e.tooltip=r.tooltip,t.select(this).select("path").attr(r.attributes)}),o.select("title").text(function(e){var r=e.tooltip||"",a="percent"===n.x.summary?t.format("0%"):t.format(n.x.format),i="percent"===n.y.summary?t.format("0%"):t.format(n.y.format);return r.replace(/\$x/g,a(e.values.x)).replace(/\$y/g,i(e.values.y)).replace(/\[(.+?)\]/g,function(t,r){return e.values[0].values.raw[0][r]})}),o}function d(e){var r=this,n=this.config,a=this.svg.selectAll(".point-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});a.enter().append("g").attr("class","point-supergroup"),a.exit().remove();var i=a.selectAll(".point").data(function(t){return t.data},function(t){return t.key}),o=i.exit();o.selectAll("circle").transition().attr("r",0),o.transition().remove();var s=i.enter().append("g").attr("class",function(t){return t.key+" point"});return s.append("circle").attr("class","wc-data-mark").attr("r",0),s.append("title"),i.select("circle").attr("fill-opacity",n.fill_opacity||0===n.fill_opacity?n.fill_opacity:.6).attr("fill",function(t){return r.colorScale(t.values.raw[0][n.color_by])}).attr("stroke",function(t){return r.colorScale(t.values.raw[0][n.color_by])}),i.each(function(e){var r=t.select(this.parentNode).datum();e.mark=r,t.select(this).select("circle").attr(r.attributes)}),i.select("circle").transition().attr("r",function(t){return t.mark.radius||n.flex_point_size}).attr("cx",function(t){var e=r.x(t.values.x)||0;return"ordinal"===n.x.type?e+r.x.rangeBand()/2:e}).attr("cy",function(t){var e=r.y(t.values.y)||0;return"ordinal"===n.y.type?e+r.y.rangeBand()/2:e}),i.select("title").text(function(e){var r=e.mark.tooltip||"",a="percent"===n.x.summary?t.format("0%"):"time"===n.x.type?t.time.format(n.x.format):t.format(n.x.format),i="percent"===n.y.summary?t.format("0%"):"time"===n.y.type?t.time.format(n.y.format):t.format(n.y.format);return r.replace(/\$x/g,a("time"===n.x.type?new Date(e.values.x):e.values.x)).replace(/\$y/g,i("time"===n.y.type?new Date(e.values.y):e.values.y)).replace(/\[(.+?)\]/g,function(t,r){return e.values.raw[0][r]})}),i}function p(e){var r=this;t.select(this.div).select(".loader").empty()&&t.select(this.div).insert("div",":first-child").attr("class","loader").selectAll(".blockG").data(t.range(8)).enter().append("div").attr("class",function(t){return"blockG rotate"+(t+1)}),this.wrap.attr("class","wc-chart"),this.setDefaults();var n=function(e){r.controls&&(r.controls.targets.push(r),r.controls.ready?r.controls.layout():r.controls.init(e)),r.raw_data=e;var n=t.select(r.div).property("offsetWidth")>0&&t.select(r.div).property("offsetHeight")>0;if(n)r.layout(),r.wrap.datum(r),r.draw();else var a=setInterval(function(e){var n=t.select(r.div).property("offsetWidth")>0&&t.select(r.div).property("offsetHeight")>0;n&&(r.layout(),r.wrap.datum(r),r.draw(),clearInterval(a))},500)};return this.checkRequired(e),n(e),this}function h(){this.svg=this.wrap.append("svg").attr({"class":"wc-svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink"}).append("g");var e=this.svg.append("defs");e.append("pattern").attr({id:"diagonal-stripes",x:0,y:0,width:3,height:8,patternUnits:"userSpaceOnUse",patternTransform:"rotate(30)"}).append("rect").attr({x:"0",y:"0",width:"2",height:"8",style:"stroke:none; fill:black"}),e.append("clipPath").attr("id",this.id).append("rect").attr("class","plotting-area"),this.svg.append("g").attr("class","y axis").append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("dy",".75em").attr("text-anchor","middle"),this.svg.append("g").attr("class","x axis").append("text").attr("class","axis-title").attr("dy","-.35em").attr("text-anchor","middle"),this.svg.append("rect").attr("class","overlay").attr("opacity",0).attr("fill","none").style("pointer-events","all"),this.wrap.append("ul").attr("class","legend").append("span").attr("class","legend-title"),t.select(this.div).select(".loader").remove(),this.events.onLayout.call(this)}function m(){var e=arguments.length<=0||void 0===arguments[0]?this.colorScale:arguments[0],r=arguments.length<=1||void 0===arguments[1]?"":arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=this.config;a.legend.mark=a.legend.mark?a.legend.mark:a.marks.length&&"bar"===a.marks[0].type?"square":a.marks.length?a.marks[0].type:"square";var i=r?r:"string"==typeof a.legend.label?a.legend.label:"",o=this.legend||this.wrap.select(".legend"),s=n||e.domain().slice(0).filter(function(t){return void 0!==t&&null!==t}).map(function(t){return{label:t,mark:a.legend.mark}});o.select(".legend-title").text(i).style("display",i?"inline":"none");var l=o.selectAll(".legend-item").data(s,function(t){return t.label+t.mark});l.exit().remove();var c=l.enter().append("li").attr("class","legend-item");c.append("span").attr("class","legend-mark-text").style("color",function(t){return e(t.label)}),c.append("svg").attr("class","legend-color-block").attr("width","1.1em").attr("height","1.1em"),a.legend.order&&l.sort(function(e,r){return t.ascending(a.legend.order.indexOf(e.label),a.legend.order.indexOf(r.label))}),l.selectAll(".legend-color-block").select(".legend-mark").remove(),l.selectAll(".legend-color-block").each(function(e){var r=t.select(this);"circle"===e.mark?r.append("circle").attr({cx:".5em",cy:".45em",r:".45em","class":"legend-mark"}):"line"===e.mark?r.append("line").attr({x1:0,y1:".5em",x2:"1em",y2:".5em","stroke-width":2,"shape-rendering":"crispEdges","class":"legend-mark"}):"square"===e.mark&&r.append("rect").attr({height:"1em",width:"1em","class":"legend-mark"})}),l.selectAll(".legend-color-block").select(".legend-mark").attr("fill",function(t){return t.color||e(t.label)}).attr("stroke",function(t){return t.color||e(t.label)}).each(function(e){t.select(this).attr(e.attributes)}),c.append("span").attr("class","legend-label").text(function(t){return t.label}),e.domain().length>1?o.style("display","block"):o.style("display","none"),this.legend=o}function g(){var e=this.config,r=1/e.aspect,n=parseInt(this.wrap.style("width")),a=e.max_width?e.max_width:n,i=e.resizable?!a||a>n?n:this.raw_width:e.width;this.textSize(i),this.margin=this.setMargins();var o="ordinal"===e.x.type&&+e.range_band?this.raw_width+this.margin.left+this.margin.right:e.resizable&&(!e.max_width||n<e.max_width)?n:this.raw_width;this.plot_width=o-this.margin.left-this.margin.right;var s="ordinal"===e.y.type&&+e.range_band?this.raw_height+this.margin.top+this.margin.bottom:!e.resizable&&e.height?e.height:e.resizable?this.plot_width*r:o*r;this.plot_height=s-this.margin.top-this.margin.bottom,t.select(this.svg.node().parentNode).attr("width",o).attr("height",s).select("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.select(".overlay").attr("width",this.plot_width).attr("height",this.plot_height).classed("zoomable",e.zoomable),this.svg.select(".plotting-area").attr("width",this.plot_width).attr("height",this.plot_height+1).attr("transform","translate(0, -1)"),this.xScaleAxis(),this.yScaleAxis();var l=this.svg.select(".x.axis"),c=this.svg.select(".y.axis"),u=l.select(".axis-title"),f=c.select(".axis-title");"top"!==e.x_location&&l.attr("transform","translate(0,"+this.plot_height+")"),l.transition().call(this.xAxis),c.transition().call(this.yAxis),u.attr("transform","translate("+this.plot_width/2+","+(this.margin.bottom-2)+")"),f.attr("x",-1*this.plot_height/2).attr("y",-1*this.margin.left),this.drawGridlines(),this.makeLegend(),this.updateDataMarks(),this.events.onResize.call(this)}function y(){var e=this.config,r="flex"===e.legend.behavior?this.filtered_data:this.raw_data,n=e.color_dom||t.set(r.map(function(t){return t[e.color_by]})).values().filter(function(t){return t&&"undefined"!==t});n=e.legend.order?n.sort(function(r,n){return t.ascending(e.legend.order.indexOf(r),e.legend.order.indexOf(n))}):n.sort(G.dataOps.naturalSorter),this.colorScale=t.scale.ordinal().domain(n).range(e.colors)}function v(){this.config.x=this.config.x||{},this.config.y=this.config.y||{},this.config.x.label=void 0!==this.config.x.label?this.config.x.label:this.config.x.column,this.config.y.label=void 0!==this.config.y.label?this.config.y.label:this.config.y.column,this.config.x.sort=this.config.x.sort||"alphabetical-ascending",this.config.y.sort=this.config.y.sort||"alphabetical-descending",this.config.x.type=this.config.x.type||"linear",this.config.y.type=this.config.y.type||"linear",this.config.margin=this.config.margin||{},this.config.legend=this.config.legend||{},this.config.legend.label=void 0!==this.config.legend.label?this.config.legend.label:this.config.color_by,this.config.marks=this.config.marks&&this.config.marks.length?this.config.marks:[{}],this.config.date_format=this.config.date_format||"%x",this.config.padding=void 0!==this.config.padding?this.config.padding:.3,this.config.outer_pad=void 0!==this.config.outer_pad?this.config.outer_pad:.1,this.config.resizable=void 0!==this.config.resizable?this.config.resizable:!0,this.config.aspect=this.config.aspect||1.33,this.config.colors=this.config.colors||["rgb(102,194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],this.config.scale_text=void 0===this.config.scale_text?!0:this.config.scale_text}function x(){var e=this,r=this.yAxis.tickFormat()?this.y.domain().map(function(t){return e.yAxis.tickFormat()(t)}):this.y.domain(),n=t.max(r.map(function(t){return String(t).length}));this.config.y_format&&this.config.y_format.indexOf("%")>-1&&(n+=1),n=Math.max(2,n);var a=this.config.x.label?1.5:0,i=this.config.y.label?1.5:.25,o=parseInt(this.wrap.style("font-size")),s=this.config.x2_interval?1:0,l=n*o*.5+o*i*1.5||8,c=o+o/1.5+o*a+o*s||8;return l+=6,c+=3,{top:this.config.margin&&this.config.margin.top?this.config.margin.top:8,right:this.config.margin&&this.config.margin.right?this.config.margin.right:16,bottom:this.config.margin&&this.config.margin.bottom?this.config.margin.bottom:c,left:this.config.margin&&this.config.margin.left?this.config.margin.left:l}}function b(t){var e="14px",r=4,n=2;this.config.scale_text?t>=600?(e="14px",r=4,n=2):t>450&&600>t?(e="12px",r=3,n=2):t>300&&450>t?(e="10px",r=2,n=2):300>=t&&(e="10px",r=2,n=1):(e=this.config.font_size,r=this.config.point_size||4,n=this.config.stroke_width||2),this.wrap.style("font-size",e),this.config.flex_point_size=r,this.config.flex_stroke_width=n}function w(e,r){function n(e){var n="ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin?"y":"x";e.total=t.sum(e.values.map(function(t){return+t.values[n]}));var a=0;e.values.forEach(function(t,n){"ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin?(t.values.y="percent"===r.summarizeY?t.values.y/e.total:t.values.y||0,a+=+t.values.y,t.values.start=e.values[n-1]?a:t.values.y):(t.values.x="percent"===r.summarizeX?t.values.x/e.total:t.values.x||0,t.values.start=a,a+=+t.values.x)})}function a(e,a){var i=[],s=[],l=t.nest();"linear"===o.x.type&&o.x.bin||"linear"===o.y.type&&o.y.bin?!function(){var r="linear"===o.x.type&&o.x.bin?"x":"y",n=t.scale.quantile().domain(t.extent(e.map(function(t){return+t[o[r].column]}))).range(t.range(+o[r].bin));e.forEach(function(t){return t.wc_bin=n(t[o[r].column])}),l.key(function(t){return n.invertExtent(t.wc_bin)})}():l.key(function(t){return r.per.map(function(e){return t[e]}).join(" ")}),a&&(l.key(function(t){return t[a]}),l.sortKeys(function(e,r){return"time"===o.x.type?t.ascending(new Date(e),new Date(r)):o.x_dom?t.ascending(o.x_dom.indexOf(e),o.x_dom.indexOf(r)):a===o.color_by&&o.legend.order?t.ascending(o.legend.order.indexOf(e),o.legend.order.indexOf(r)):"ordinal"===o.x.type||"ordinal"===o.y.type?G.dataOps.naturalSorter(e,r):t.ascending(+e,+r)})),l.rollup(function(n){var a={raw:n},l=n.map(function(t){return t[o.y.column]}).sort(t.ascending),c=n.map(function(t){return t[o.x.column]}).sort(t.ascending);if(a.x="ordinal"===o.x.type?n[0][o.x.column]:G.dataOps.summarize(c,r.summarizeX),a.y="ordinal"===o.y.type?n[0][o.y.column]:G.dataOps.summarize(l,r.summarizeY),a.x_q25=o.error_bars&&"ordinal"===o.y.type?t.quantile(c,.25):a.x,a.x_q75=o.error_bars&&"ordinal"===o.y.type?t.quantile(c,.75):a.x,a.y_q25=o.error_bars?t.quantile(l,.25):a.y,a.y_q75=o.error_bars?t.quantile(l,.75):a.y,i.push([a.x_q25,a.x_q75,a.x]),s.push([a.y_q25,a.y_q75,a.y]),"cumulative"===r.summarizeY){var u=e.filter(function(t){return"time"===o.x.type?new Date(t[o.x.column])<=new Date(n[0][o.x.column]):+t[o.x.column]<=+n[0][o.x.column]});r.per.length&&(u=u.filter(function(t){return t[r.per[0]]===n[0][r.per[0]]}));var f="time"===o.x.type?u.length:t.sum(u.map(function(t){return+t[o.y.column]||0===+t[o.y.column]?+t[o.y.column]:1}));s.push([f]),a.y=f}if("cumulative"===r.summarizeX){var u=e.filter(function(t){return"time"===o.y.type?new Date(t[o.y.column])<=new Date(n[0][o.y.column]):+t[o.y.column]<=+n[0][o.y.column]});r.per.length&&(u=u.filter(function(t){return t[r.per[0]]===n[0][r.per[0]]})),i.push([u.length]),a.x=u.length}return a});var c=l.entries(e),u=t.extent(t.merge(i)),d=t.extent(t.merge(s));return a&&"bar"===r.type&&"stacked"===r.arrange?(c.forEach(n),("ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin)&&(d=t.extent(c.map(function(t){return t.total}))),("ordinal"===o.y.type||"linear"===o.y.type&&o.y.bin)&&(u=t.extent(c.map(function(t){return t.total})))):a&&"bar"===r.type&&r.split?c.forEach(n):!function(){var t="ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin?"y":"x";c.forEach(function(e){return e.total=e.values[t]})}(),"total-ascending"===o.x.sort&&"ordinal"==o.x.type||"total-descending"===o.y.sort&&"ordinal"==o.y.type?f=c.sort(function(e,r){return t.ascending(e.total,r.total)}).map(function(t){return t.key}):("total-descending"===o.x.sort&&"ordinal"==o.x.type||"total-ascending"===o.y.sort&&"ordinal"==o.y.type)&&(f=c.sort(function(e,r){return t.descending(+e.total,+r.total)}).map(function(t){return t.key})),{nested:c,dom_x:u,dom_y:d}}var i=this,o=this.config,s=o.x.behavior||"raw",l=o.y.behavior||"raw",c="line"===r.type?o.x.column:"bar"===r.type&&r.split?r.split:null,u=t.time.format(o.date_format),f=void 0;e=r.per&&r.per.length?e.filter(function(t){return t[r.per[0]]}):e,o.initial_filter&&(e=e.filter(function(t){return-1!==o.initial_filter.vals.indexOf(t[o.initial_filter.col])})),o.x.column&&(e=e.filter(function(t){return t[o.x.column]})),o.y.column&&(e=e.filter(function(t){return t[o.y.column]})),"time"===o.x.type&&(e=e.filter(function(t){return t[o.x.column]instanceof Date?t[o.x.column]:u.parse(t[o.x.column])}),e.forEach(function(t){return t[o.x.column]=t[o.x.column]instanceof Date?t[o.x.column]:u.parse(t[o.x.column])})),"time"===o.y.type&&(e=e.filter(function(t){return t[o.y.column]instanceof Date?t[o.y.column]:u.parse(t[o.y.column])}),e.forEach(function(t){return t[o.y.column]=t[o.y.column]instanceof Date?t[o.y.column]:u.parse(t[o.y.column])})),"linear"!==o.x.type&&"log"!==o.x.type||!o.x.column||(e=e.filter(function(t){return"count"!==r.summarizeX&&"percent"!==r.summarizeX?+t[o.x.column]||0===+t[o.x.column]:t})),"linear"!==o.y.type&&"log"!==o.y.type||!o.y.column||(e=e.filter(function(t){return"count"!==r.summarizeY&&"percent"!==r.summarizeY?+t[o.y.column]||0===+t[o.y.column]:t}));var d=void 0;"bar"===r.type?d="stacked"!==r.arrange?a(e,c):a(e):("count"===r.summarizeX||"count"===r.summarizeY)&&(d=a(e));var p="cumulative"===r.summarizeX?[0,e.length]:"ordinal"===o.x.type?t.set(e.map(function(t){return t[o.x.column]})).values().filter(function(t){return t}):r.split&&"stacked"!==r.arrange?t.extent(t.merge(d.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})}))):"count"===r.summarizeX?t.extent(d.nested.map(function(t){return t.values.raw.length})):t.extent(e.map(function(t){return+t[o.x.column]}).filter(function(t){return+t||0===+t})),h="cumulative"===r.summarizeY?[0,e.length]:"ordinal"===o.y.type?t.set(e.map(function(t){return t[o.y.column]})).values().filter(function(t){return t}):r.split&&"stacked"!==r.arrange?t.extent(t.merge(d.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})}))):"count"===r.summarizeY?t.extent(d.nested.map(function(t){return t.values.raw.length})):t.extent(e.map(function(t){return+t[o.y.column]}).filter(function(t){return+t||0===+t})),m=e,g=[],y=[];this.filters.length&&(this.filters.forEach(function(t){
m=m.filter(function(e){return"All"===t.val?e:t.val instanceof Array?t.val.indexOf(e[t.col])>-1:e[t.col]===t.val})}),("firstfilter"===o.x.behavior||"firstfilter"===o.y.behavior)&&this.filters[0].choices.filter(function(t){return"All"!==t}).forEach(function(t){var r=e.filter(function(e){return e[i.filters[0].col]===t}),n=a(r,c);g.push(n.dom_x),y.push(n.dom_y)}));var v=t.extent(t.merge(g)),x=t.extent(t.merge(y));this.filtered_data=m;var b=a(m,c),w=b.dom_x,k=b.dom_y;"bar"===r.type&&("ordinal"===o.y.type&&"count"===r.summarizeX?o.x.domain=o.x.domain?[0,o.x.domain[1]]:[0,null]:"ordinal"===o.x.type&&"count"===r.summarizeY&&(o.y.domain=o.y.domain?[0,o.y.domain[1]]:[0,null]));var _=Boolean(this.filters.length&&"All"!==this.filters[0].val&&this.filters.slice(1).filter(function(t){return"All"===t.val}).length===this.filters.length-1),A=this.filters.length?"raw"===s?p:_&&"firstfilter"===s?v:w:w,O=this.filters.length?"raw"===l?h:_&&"firstfilter"===l?x:k:k,z=o.x_dom?o.x_dom:"ordinal"===o.x.type&&"flex"===o.x.behavior?t.set(m.map(function(t){return t[o.x.column]})).values():"ordinal"===o.x.type?t.set(e.map(function(t){return t[o.x.column]})).values():o.x_from0?[0,t.max(A)]:A,S=o.y_dom?o.y_dom:"ordinal"===o.y.type&&"flex"===o.y.behavior?t.set(m.map(function(t){return t[o.y.column]})).values():"ordinal"===o.y.type?t.set(e.map(function(t){return t[o.y.column]})).values():o.y_from0?[0,t.max(O)]:O;return o.x.domain&&(o.x.domain[0]||0===o.x.domain[0])&&(z[0]=o.x.domain[0]),o.x.domain&&(o.x.domain[1]||0===o.x.domain[1])&&(z[1]=o.x.domain[1]),o.y.domain&&(o.y.domain[0]||0===o.y.domain[0])&&(S[0]=o.y.domain[0]),o.y.domain&&(o.y.domain[1]||0===o.y.domain[1])&&(S[1]=o.y.domain[1]),"ordinal"===o.x.type&&(o.x.order=f),"ordinal"===o.y.type&&(o.y.order=f),this.current_data=b.nested,this.events.onDatatransform.call(this),{data:b.nested,x_dom:z,y_dom:S}}function k(){this.drawBars(this.marks.filter(function(t){return"bar"===t.type})),this.drawLines(this.marks.filter(function(t){return"line"===t.type})),this.drawPoints(this.marks.filter(function(t){return"circle"===t.type}))}function _(e,r,n){void 0===e&&(e=this.plot_width),void 0===r&&(r=this.x_dom),void 0===n&&(n=this.config.x.type);var a=this.config,i=void 0;i="log"===n?t.scale.log():"ordinal"===n?t.scale.ordinal():"time"===n?t.time.scale():t.scale.linear(),i.domain(r),"ordinal"===n?i.rangeBands([0,+e],a.padding,a.outer_pad):i.range([0,+e]).clamp(Boolean(a.x.clamp));var o=a.x.format?a.x.format:a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?"0%":"time"===n?"%x":".0f",s=Math.max(2,Math.min(e/80,8)),l=t.svg.axis().scale(i).orient(a.x.location).ticks(s).tickFormat("ordinal"===n?null:"time"===n?t.time.format(o):t.format(o)).tickValues(a.x.ticks?a.x.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.x.axis").attr("class","x axis "+n),this.x=i,this.xAxis=l}function A(e,r,n){void 0===e&&(e=this.plot_height),void 0===r&&(r=this.y_dom),void 0===n&&(n=this.config.y.type);var a=this.config,i=void 0;i="log"===n?t.scale.log():"ordinal"===n?t.scale.ordinal():"time"===n?t.time.scale():t.scale.linear(),i.domain(r),"ordinal"===n?i.rangeBands([+e,0],a.padding,a.outer_pad):i.range([+e,0]).clamp(Boolean(a.y_clamp));var o=a.y.format?a.y.format:a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?"0%":".0f",s=Math.max(2,Math.min(e/80,8)),l=t.svg.axis().scale(i).orient("left").ticks(s).tickFormat("ordinal"===n?null:"time"===n?t.time.format(o):t.format(o)).tickValues(a.y.ticks?a.y.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.y.axis").attr("class","y axis "+n),this.y=i,this.yAxis=l}function O(t,e){var r=this;this.targets.forEach(function(n){r.stringAccessor(n.config,t,e),n.draw()})}function z(e){var r=this,n=t.keys(e[0]);this.config.inputs&&this.config.inputs.forEach(function(t,e){if("subsetter"===t.type&&-1===n.indexOf(t.value_col))throw r.config.inputs=r.config.inputs.splice(controls[e],1),new Error('Error in settings object: the value "'+t.value_col+'" does not match any column in the provided dataset.')})}function S(t){this.data=t,this.config.builder||this.checkRequired(this.data),this.layout()}function D(){this.wrap.selectAll("*").remove(),this.ready=!0,this.controlUpdate()}function C(){var t=this;this.config.inputs&&this.config.inputs.length&&this.config.inputs[0]&&this.config.inputs.forEach(function(e){return t.makeControlItem(e)})}function E(e,r){var n=this,a=e.values?e.values:t.keys(this.data[0]),i=r.append("div").attr("class","btn-group"),o=i.selectAll("button").data(a).enter().append("button").attr("class","btn btn-default btn-sm").text(function(t){return t}).classed("btn-primary",function(t){return n.stringAccessor(n.targets[0].config,e.option)===t});o.on("click",function(r){o.each(function(e){t.select(this).classed("btn-primary",e===r)}),n.changeOption(e.option,r)})}function B(t,e){var r=this,n=e.append("input").attr("type","checkbox").attr("class","changer").datum(t).property("checked",function(e){return r.stringAccessor(r.targets[0].config,t.option)});n.on("change",function(t){var e=n.property("checked");r.changeOption(t.option,e)})}function q(t){var e=this.wrap.append("div").attr("class","control-group").classed("inline",t.inline).datum(t),r=e.append("span").attr("class","control-label").text(t.label);if(t.required&&r.append("span").attr("class","label label-required").text("Required"),e.append("span").attr("class","span-description").text(t.description),"text"===t.type)this.makeTextControl(t,e);else if("number"===t.type)this.makeNumberControl(t,e);else if("list"===t.type)this.makeListControl(t,e);else if("dropdown"===t.type)this.makeDropdownControl(t,e);else if("btngroup"===t.type)this.makeBtnGroupControl(t,e);else if("checkbox"===t.type)this.makeCheckboxControl(t,e);else if("radio"===t.type)this.makeRadioControl(t,e);else{if("subsetter"!==t.type)throw new Error('Each control must have a type! Choose from: "text", "number", "list", "dropdown", "btngroup", "checkbox", "radio", "subsetter"');this.makeSubsetterControl(t,e)}}function j(e,r){var n=this,a=r.append("select").attr("class","changer").attr("multiple",e.multiple?!0:null).datum(e),i=e.values&&e.values instanceof Array?e.values:e.values?t.set(this.data.map(function(t){return t[n.targets[0].config[e.values]]})).values():t.keys(this.data[0]);(!e.require||e.none)&&i.unshift("None");var o=a.selectAll("option").data(i).enter().append("option").text(function(t){return t}).property("selected",function(t){return n.stringAccessor(n.targets[0].config,e.option)===t});return a.on("change",function(r){var i="None"===a.property("value")?null:a.property("value");e.multiple&&(i=o.filter(function(e){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("value")}).filter(function(t){return"None"!==t})),n.changeOption(e.option,i)}),a}function N(t,e){var r=this,n=e.append("input").attr("type","text").attr("class","changer").datum(t).property("value",function(e){return r.stringAccessor(r.targets[0].config,t.option)});n.on("change",function(e){var a=n.property("value")?n.property("value").split(",").map(function(t){return t.trim()}):null;r.changeOption(t.option,a)})}function L(t,e){var r=this,n=e.append("input").attr("type","number").attr("min",void 0!==t.min?t.min:0).attr("max",t.max).attr("step",t.step||1).attr("class","changer").datum(t).property("value",function(e){return r.stringAccessor(r.targets[0].config,t.option)});n.on("change",function(e){var a=+n.property("value");r.changeOption(t.option,a)})}function T(e,r){var n=this,a=r.selectAll("label").data(e.values||t.keys(this.data[0])).enter().append("label").attr("class","radio").text(function(t,r){return e.relabels?e.relabels[r]:t}).append("input").attr("type","radio").attr("class","changer").attr("name",e.option.replace(".","-")+"-"+this.targets[0].id).property("value",function(t){return t}).property("checked",function(t){return n.stringAccessor(n.targets[0].config,e.option)===t});a.on("change",function(r){var i=null;a.each(function(e){t.select(this).property("checked")&&(i="none"===t.select(this).property("value")?null:e)}),n.changeOption(e.option,i)})}function X(e,r){function n(t,e){var r=-1;t.filters.forEach(function(t,n){t.col===e.col&&(r=n)}),r>-1&&(t.filters[r]=e)}var a=this.targets,i=r.append("select").attr("class","changer").attr("multiple",e.multiple?!0:null).datum(e),o=e.values?e.values:t.set(this.data.map(function(t){return t[e.value_col]}).filter(function(t){return t})).values();o.sort(G.dataOps.naturalSorter),e.start=e.start?e.start:e.loose?o[0]:null,e.multiple||e.start||o.unshift("All"),e.loose=!e.loose&&e.start?!0:e.loose;var s=i.selectAll("option").data(o).enter().append("option").text(function(t){return t}).property("selected",function(t){return t===e.start});a.forEach(function(t){var r=t.filters.slice().map(function(t){return t.col===e.value_col}).indexOf(!0);r>-1?t.filters[r]={col:e.value_col,val:e.start?e.start:"All",choices:o,loose:e.loose}:t.filters.push({col:e.value_col,val:e.start?e.start:"All",choices:o,loose:e.loose})}),i.on("change",function(r){var i=this;e.multiple?!function(){var r=s.filter(function(e){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("value")}),i={col:e.value_col,val:r,choices:o,loose:e.loose};a.forEach(function(t){n(t,i),t.draw()})}():!function(){var r=t.select(i).property("value"),s={col:e.value_col,val:r,choices:o,loose:e.loose};a.forEach(function(t){n(t,s),t.draw()})}()})}function Y(t,e){var r=this,n=e.append("input").attr("type","text").attr("class","changer").datum(t).property("value",function(e){return r.stringAccessor(r.targets[0].config,t.option)});n.on("change",function(e){var a=n.property("value");r.changeOption(t.option,a)})}function M(t,e,r){e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,"");for(var n=e.split("."),a=0,i=n.length;i>a;++a){var o=n[a];if(!(o in t))return;a==i-1&&void 0!==r&&(t[o]=r),t=t[o]}return t}function R(e,r){var n=e?e:this.raw_data,a=this.config,i=r||this.transformData(n);this.wrap.datum(i);var o=this.table,s=a.cols.length?a.cols:i.length?t.keys(i[0].values[0].raw):[];a.bootstrap?o.classed("table",!0):o.classed("table",!1);var l=i.length?a.headers&&a.headers.length?a.headers:s:[],c=o.select("thead").select("tr.headers"),u=c.selectAll("th").data(l);u.exit().remove(),u.enter().append("th"),u.text(function(t){return t});var f=o.selectAll("tbody").data(i,function(t){return t.key});if(f.exit().remove(),f.enter().append("tbody"),a.row_per){var d=a.row_per.slice(0).reverse();d.forEach(function(t){f.sort(function(e,r){return e.values[0].raw[t]-r.values[0].raw[t]})})}var p=f.selectAll("tr").data(function(t){return t.values});p.exit().remove(),p.enter().append("tr"),a.sort_rows&&!function(){var t=a.sort_rows.slice(0);t.unshift("0"),p.sort(function(e,r){for(var n=0;n<t.length&&e.raw[t[n]]==r.raw[t[n]];)n++;return e.raw[t[n]]<r.raw[t[n]]?-1:e.raw[t[n]]>r.raw[t[n]]?1:0})}();var h=p.selectAll("td").data(function(t){return t.cells.filter(function(t){return s.indexOf(t.col)>-1})});if(h.exit().remove(),h.enter().append("td"),h.attr("class",function(t){return t.col}),a.as_html?h.html(function(t){return t.text}):h.text(function(t){return t.text}),a.row_per&&p.filter(function(t,e){return e>0}).selectAll("td").filter(function(t){return a.row_per.indexOf(t.col)>-1}).text(""),a.data_tables){if(!jQuery()||!jQuery().dataTable)throw new Error("dataTables jQuery plugin not available");var m=a.data_tables;m.searching=a.searchable?a.searchable:!1,$(o.node()).dataTable(m);var g=$(".print-btn",wrap.node());g.addClass("pull-right"),$(".dataTables_wrapper").prepend(g)}this.events.onDraw(this)}function H(){t.select(this.div).select(".loader").remove();var e=this.wrap.append("table");e.append("thead").append("tr").attr("class","headers"),this.table=e,this.events.onLayout(this)}function I(e){if(e){var r=this.config,n=r.cols||t.keys(e[0]);r.keep&&r.keep.forEach(function(t){-1===n.indexOf(t)&&n.unshift(t)}),this.config.cols=n;var a=e;this.filters.length&&this.filters.forEach(function(t){var e=t.val instanceof Array;a=a.filter(function(r){return e?-1!==t.val.indexOf(r[t.col]):"All"!==t.val?r[t.col]===t.val:r})});var i=t.nest().key(function(t){return r.row_per?r.row_per.map(function(e){return t[e]}).join(" "):t}).rollup(function(t){r.dataManipulate&&(t=r.dataManipulate(t));var e=t.map(function(t){var e=[];for(var n in t)e.push({col:n,text:t[n]});return e.sort(function(t,e){return r.cols.indexOf(t.col)-r.cols.indexOf(e.col)}),{cells:e,raw:t}});return e}).entries(a);return this.current_data=i,this.events.onDatatransform(this),this.current_data}}var G={version:"1.0.1"};G.multiply=function(e,r,n,a){function i(r){var i=t.set(r.map(function(t){return t[n]})).values().filter(function(t){return t});a&&(i=i.sort(function(e,r){return t.ascending(a.indexOf(e),a.indexOf(r))})),i.forEach(function(t){var a=G.createChart(e.wrap.node(),o,e.controls);a.events=e.events,a.legend=l,a.filters.unshift({col:n,val:t,choices:i}),a.wrap.insert("span","svg").attr("class","wc-chart-title").text(t),a.init(r)})}var o=e.config,s=e.wrap.classed("wc-layout wc-small-multiples",!0).classed("wc-chart",!1),l=s.append("ul").attr("class","legend");i(r)},G.dataOps={getValType:e,lengthenRaw:r,naturalSorter:n,summarize:a};var U={raw_data:[],config:{}};Object.defineProperties(U,{checkRequired:{value:i},consolidateData:{value:o},draw:{value:s},drawArea:{value:l},drawBars:{value:c},drawGridlines:{value:u},drawLines:{value:f},drawPoints:{value:d},init:{value:p},layout:{value:h},makeLegend:{value:m},resize:{value:g},setColorScale:{value:y},setDefaults:{value:v},setMargins:{value:x},textSize:{value:b},transformData:{value:w},updateDataMarks:{value:k},xScaleAxis:{value:_},yScaleAxis:{value:A}});var P={changeOption:O,checkRequired:z,controlUpdate:C,init:S,layout:D,makeControlItem:q,makeBtnGroupControl:E,makeCheckboxControl:B,makeDropdownControl:j,makeListControl:N,makeNumberControl:L,makeRadioControl:T,makeSubsetterControl:X,makeTextControl:Y,stringAccessor:M},F=Object.create(U);return Object.defineProperties(F,{layout:{value:H},transformData:{value:I},draw:{value:R}}),G.objects={chart:U,table:F,controls:P},G.chartCount=0,G.createChart=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=Object.create(G.objects.chart);return a.div=e,a.config=Object.create(r),a.controls=n,a.raw_data=[],a.filters=[],a.marks=[],a.wrap=t.select(a.div).append("div"),a.events={onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},a.on=function(t,e){var r=["layout","datatransform","draw","resize"];r.indexOf(t)<0||e&&(a.events["on"+t.charAt(0).toUpperCase()+t.slice(1)]=e)},G.chartCount++,a.id=G.chartCount,a},G.createControls=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=Object.create(G.objects.controls);return n.div=e,n.config=Object.create(r),n.config.inputs=n.config.inputs||[],n.targets=[],"bottom"===r.location?n.wrap=t.select(e).append("div").attr("class","wc-controls"):n.wrap=t.select(e).insert("div",":first-child").attr("class","wc-controls"),n},G.createTable=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=Object.create(G.objects.table);return a.div=e,a.config=Object.create(r),a.controls=n,a.filters=[],a.required_cols=[],a.marks=[],a.wrap=t.select(a.div).append("div"),a.events={onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},a.on=function(t,e){var r=["layout","datatransform","draw","resize"];r.indexOf(t)<0||e&&(a.events["on"+t.charAt(0).toUpperCase()+t.slice(1)]=e)},a},G});