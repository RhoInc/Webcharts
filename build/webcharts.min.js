!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof module&&module.exports?module.exports=e(require("d3")):t.webCharts=e(t.d3)}(this,function(t){"use strict";function e(t,e){var n=[];return t.forEach(function(t){e.forEach(function(e){var r=Object.create(t);r.wc_category=e,r.wc_value=t[e],n.push(r)})}),n}function n(t,e){for(var n={},r=e.length,a=0,i=0,s=0,o=0,l=0,c=0;r>c;c++)a+=t[c],i+=e[c],s+=t[c]*e[c],o+=t[c]*t[c],l+=e[c]*e[c];return n.slope=(r*s-a*i)/(r*o-a*a),n.intercept=(i-n.slope*a)/r,n.r2=Math.pow((r*s-a*i)/Math.sqrt((r*o-a*a)*(r*l-i*i)),2),n}function r(t,e){function n(t){for(var e=[],n=0,r=-1,a=0,i=void 0,s=void 0;i=(s=t.charAt(n++)).charCodeAt(0);){var o=46==i||i>=48&&57>=i;o!==a&&(e[++r]="",a=o),e[r]+=s}return e}for(var r=n(t.toLowerCase()),a=n(e.toLowerCase()),i=0;r[i]&&a[i];i++)if(r[i]!==a[i]){var s=Number(r[i]),o=Number(a[i]);return s==r[i]&&o==a[i]?s-o:r[i]>a[i]?1:-1}return r.length-a.length}function a(e){if(!e)return null;var n=+e.length;if(1>n)return 0/0;if(1===n)return 0;for(var r=t.sum(e)/n,a=-1,i=0;++a<n;){var s=e[a]-r;i+=s*s}return Math.sqrt(i/(n-1))/Math.sqrt(n)}function i(e,n){var r=e.filter(function(t){return+t||0===+t}).map(function(t){return+t});if("cumulative"===n)return null;var a=n||"mean",i="count"===a?e.length:"percent"===a?e.length:t[a](r);return i}function s(e,n){var r=t.set(e.map(function(t){return t[n]})).values(),a=r.filter(function(t){return+t||0===t});return r.length===a.length&&r.length>4?"continuous":"categorical"}function o(){var e=this,n=t.keys(this.raw_data[0]);this.required_cols.forEach(function(r,a){if(n.indexOf(r)<0)throw t.select(e.div).select(".loader").remove(),e.wrap.append("div").attr("class","alert alert-error alert-danger").html('The value "'+r+'" for the <code>'+e.required_vars[a]+"</code> setting does not match any column in the provided dataset."),new Error('Error in settings object: The value "'+r+'" for the '+e.required_vars[a]+" setting does not match any column in the provided dataset.")})}function l(e){var n=this,r=this.config,a=[],i=[],s=[];if(this.setDefaults(),r.marks.forEach(function(t,r){"bar"!==t.type&&(t.arrange=null,t.split=null);var o=t.per?n.transformData(e,t):{data:[],x_dom:[],y_dom:[]};a.push(o.data),i.push(o.x_dom),s.push(o.y_dom),n.marks[r]={type:t.type,per:t.per,data:o.data,split:t.split,arrange:t.arrange,order:t.order,tooltip:t.tooltip,attributes:t.attributes}}),"ordinal"===r.x.type)if(r.x.sort&&"alphabetical-descending"===r.x.sort)this.x_dom=t.set(t.merge(i)).values().sort(W.dataOps.naturalSorter).reverse();else if("time"===r.y.type&&"earliest"===r.x.sort){{t.time.format(r.date_format)}this.x_dom=t.nest().key(function(t){return t[r.x.column]}).rollup(function(t){return t.map(function(t){return t[r.y.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,n){return t.min(n.values)-t.min(e.values)}).map(function(t){return t.key})}else this.x_dom=r.x.order?t.set(t.merge(i)).values().sort(function(e,n){return t.ascending(r.x.order.indexOf(e),r.x.order.indexOf(n))}):r.x.sort&&"alphabetical-descending"!==r.x.sort?t.set(t.merge(i)).values():t.set(t.merge(i)).values().sort(W.dataOps.naturalSorter);else this.x_dom=t.extent(t.merge(i));if("ordinal"===r.y.type)if(r.y.sort&&"alphabetical-ascending"===r.y.sort)this.y_dom=t.set(t.merge(s)).values().sort(W.dataOps.naturalSorter);else if("time"===r.x.type&&"earliest"===r.y.sort){{t.time.format(r.date_format)}this.y_dom=t.nest().key(function(t){return t[r.y.column]}).rollup(function(t){return t.map(function(t){return t[r.x.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,n){return t.min(n.values)-t.min(e.values)}).map(function(t){return t.key})}else this.y_dom=r.y.order?t.set(t.merge(s)).values().sort(function(e,n){return t.ascending(r.y.order.indexOf(e),r.y.order.indexOf(n))}):r.y.sort&&"alphabetical-descending"!==r.y.sort?t.set(t.merge(s)).values():t.set(t.merge(s)).values().sort(W.dataOps.naturalSorter).reverse();else this.y_dom="percent"===r.y.summary?[0,1]:t.extent(t.merge(s))}function c(e,n){var r=this,a=n?n:this.raw_data?this.raw_data:[],i=this.config,s=1/i.aspect,o=this.consolidateData(a);this.wrap.datum(o);var l=parseInt(this.wrap.style("width"));this.setColorScale();var c=i.max_width?i.max_width:l;this.raw_width="ordinal"===i.x.type&&+i.range_band?(+i.range_band+i.range_band*i.padding)*this.x_dom.length:i.resizable?c:i.width?i.width:l,this.raw_height="ordinal"===i.y.type&&+i.range_band?(+i.range_band+i.range_band*i.padding)*this.y_dom.length:i.resizable?c*s:i.height?i.height:l*s;{var u=this.svg.select(".overlay").attr("width")?this.svg.select(".overlay").attr("width"):this.raw_width,f=this.svg.select(".overlay").attr("height")?this.svg.select(".overlay").attr("height"):this.raw_height;this.svg.select(".x.axis").select(".axis-title").text(function(){return"string"==typeof i.x.label?i.x.label:"function"==typeof i.x.label?i.x.label(r):null}),this.svg.select(".y.axis").select(".axis-title").text(function(){return"string"==typeof i.y.label?i.y.label:"function"==typeof i.y.label?i.y.label(r):null})}this.xScaleAxis(i.x.type,u,this.x_dom),this.yScaleAxis(i.y.type,f,this.y_dom),i.resizable?t.select(window).on("resize."+r.element+r.id,function(){r.resize()}):t.select(window).on("resize."+r.element+r.id,null),this.events.onDraw(this),this.resize()}function u(t,e,n,r,a){void 0===r&&(r="chart-area");var i=this,s=arguments.length<=5||void 0===arguments[5]?function(t){return t}:arguments[5],o=this.svg.selectAll("."+r).data(e,a);return o.exit().remove(),o.enter().append("g").attr("class",function(t){return r+" "+t.key}).append("path"),o.select("path").datum(n).attr("fill",function(t){var e=s(t);return e?i.colorScale(e[i.config.color_by]):null}).attr("fill-opacity",this.config.fill_opacity||0===this.config.fill_opacity?this.config.fill_opacity:.3).transition().attr("d",t),o}function f(e){var n=this,r=this.raw_data,a=this.config,i=this.svg.selectAll(".bar-supergroup").data(e,function(t){return t.per.join("-")});i.enter().append("g").attr("class","bar-supergroup"),i.exit().remove();var s=i.selectAll(".bar-group").data(function(t){return t.data},function(t){return t.key}),o=s.exit(),l=void 0,c=void 0;"ordinal"===a.x.type?(o.selectAll(".bar").transition().attr("y",this.y(0)).attr("height",0),o.transition().remove(),l=s.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=s.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("y",this.y(0)).attr("height",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("y",this.y(0)).attr("height",0).append("title"),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill-opacity",a.fill_opacity||.8),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.tooltip=n.tooltip,e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values(),t.select(this).attr(n.attributes)}),c.select("title").text(function(e){var n=e.tooltip||"",r=t.format("percent"===a.x.summary?"0%":a.x.format),i=t.format("percent"===a.y.summary?"0%":a.y.format);return n.replace(/\$x/g,r(e.values.x)).replace(/\$y/g,i(e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values.raw[0][n]})}),c.transition().attr("x",function(t){var e=void 0;if(t.arrange&&"stacked"!==t.arrange){if("nested"===t.arrange){e=t.subcats.indexOf(t.key);var r=e?n.x.rangeBand()/(t.subcats.length*e*.5)/2:n.x.rangeBand()/2;return n.x(t.values.x)+n.x.rangeBand()/2-r}return e=t.subcats.indexOf(t.key),n.x(t.values.x)+n.x.rangeBand()/t.subcats.length*e}return n.x(t.values.x)}).attr("y",function(t){return n.y("stacked"!==t.arrange?t.values.y:t.values.start)}).attr("width",function(t){if("stacked"===t.arrange)return n.x.rangeBand();if("nested"===t.arrange){var e=t.subcats.indexOf(t.key);return e?n.x.rangeBand()/(t.subcats.length*e*.5):n.x.rangeBand()}return n.x.rangeBand()/t.subcats.length}).attr("height",function(t){return n.y(0)-n.y(t.values.y)})):"ordinal"===a.y.type?(o.selectAll(".bar").transition().attr("x",this.x(0)).attr("width",0),o.transition().remove(),l=s.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=s.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("x",this.x(0)).attr("width",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("x",this.x(0)).attr("width",0),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill-opacity",a.fill_opacity||.8),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values()}),c.transition().attr("x",function(t){return n.x("stacked"===t.arrange?t.values.start:0)}).attr("y",function(t){if("grouped"!==t.arrange)return n.y(t.values.y);var e=t.subcats.indexOf(t.key);return n.y(t.values.y)+n.y.rangeBand()/t.subcats.length*e}).attr("width",function(t){return n.x(t.values.x)}).attr("height",function(t){if("quantile"===a.y.type)return 20;if("stacked"===t.arrange)return n.y.rangeBand();if("nested"===t.arrange){var e=t.subcats.indexOf(t.key);return e?n.y.rangeBand()/(sibs.length*e*.75):n.y.rangeBand()}return n.y.rangeBand()/t.subcats.length})):"linear"===a.x.type&&a.x.bin?(o.selectAll(".bar").transition().attr("y",this.y(0)).attr("height",0),o.transition().remove(),l=s.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=s.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("y",this.y(0)).attr("height",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("y",this.y(0)).attr("height",0),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill-opacity",a.fill_opacity||.8),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values(),t.select(this).attr(n.attributes);var a=t.select(this.parentNode).datum(),i=a.key.split(",").map(function(t){return+t});e.rangeLow=t.min(i),e.rangeHigh=t.max(i)}),c.transition().attr("x",function(t){return n.x(t.rangeLow)}).attr("y",function(t){return n.y("stacked"!==t.arrange?t.values.y:t.values.start)}).attr("width",function(t){return n.x(t.rangeHigh)-n.x(t.rangeLow)}).attr("height",function(t){return n.y(0)-n.y(t.values.y)})):"linear"===a.y.type&&a.y.bin?(o.selectAll(".bar").transition().attr("x",this.x(0)).attr("width",0),o.transition().remove(),l=s.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=s.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("x",this.x(0)).attr("width",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("x",this.x(0)).attr("width",0),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill-opacity",a.fill_opacity||.8),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values();var a=t.select(this.parentNode).datum(),i=a.key.split(",").map(function(t){return+t});e.rangeLow=t.min(i),e.rangeHigh=t.max(i)}),c.transition().attr("x",function(t){return n.x("stacked"===t.arrange?t.values.start:0)}).attr("y",function(t){return n.y(t.rangeHigh)}).attr("width",function(t){return n.x(t.values.x)}).attr("height",function(t){return n.y(t.rangeLow)-n.y(t.rangeHigh)})):(o.selectAll(".bar").transition().attr("y",this.y(0)).attr("height",0),o.transition().remove(),i.remove())}function p(){this.wrap.classed("gridlines",this.config.gridlines),this.config.gridlines?(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0),("y"===this.config.gridlines||"xy"===this.config.gridlines)&&this.svg.select(".y.axis").selectAll(".tick line").attr("x1",this.plot_width),("x"===this.config.gridlines||"xy"===this.config.gridlines)&&this.svg.select(".x.axis").selectAll(".tick line").attr("y1",-this.plot_height)):(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0))}function d(e){var n=this,r=this.config,a=t.svg.line().interpolate(r.interpolate).x(function(t){return"linear"===r.x.type?n.x(+t.values.x):"time"===r.x.type?n.x(new Date(t.values.x)):n.x(t.values.x)+n.x.rangeBand()/2}).y(function(t){return"linear"===r.y.type?n.y(+t.values.y):"time"===r.y.type?n.y(new Date(t.values.y)):n.y(t.values.y)+n.y.rangeBand()/2}),i=this.svg.selectAll(".line-supergroup").data(e,function(t){return t.per.join("-")});i.enter().append("g").attr("class","line-supergroup"),i.exit().remove();var s=i.selectAll(".line").data(function(t){return t.data},function(t){return t.key});s.exit().remove();var o=s.enter().append("g").attr("class",function(t){return t.key+" line"});return o.append("path"),o.append("title"),s.select("path").attr("class","wc-data-mark").datum(function(t){return t.values}).attr("stroke",function(t){return n.colorScale(t[0].values.raw[0][r.color_by])}).attr("stroke-width",r.stroke_width?r.stroke_width:r.flex_stroke_width).attr("stroke-linecap","round").attr("fill","none").transition().attr("d",a),s.each(function(e){var n=t.select(this.parentNode).datum();e.tooltip=n.tooltip,t.select(this).select("path").attr(n.attributes)}),s.select("title").text(function(e){var n=e.tooltip||"",a=t.format("percent"===r.x.summary?"0%":r.x.format),i=t.format("percent"===r.y.summary?"0%":r.y.format);return n.replace(/\$x/g,a(e.values.x)).replace(/\$y/g,i(e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values[0].values.raw[0][n]})}),s}function h(e){var n=this,r=this.config,a=this.svg.selectAll(".point-supergroup").data(e,function(t){return t.per.join("-")});a.enter().append("g").attr("class","point-supergroup"),a.exit().remove();var i=a.selectAll(".point").data(function(t){return t.data},function(t){return t.key}),s=i.exit();s.selectAll("circle").transition().attr("r",0),s.transition().remove();var o=i.enter().append("g").attr("class",function(t){return t.key+" point"});return o.append("circle").attr("class","wc-data-mark").attr("r",0),o.append("title"),i.select("circle").attr("fill-opacity",r.fill_opacity||0===r.fill_opacity?r.fill_opacity:.6).attr("fill",function(t){return n.colorScale(t.values.raw[0][r.color_by])}).attr("stroke",function(t){return n.colorScale(t.values.raw[0][r.color_by])}).transition().attr("r",r.point_size?r.point_size:r.flex_point_size).attr("cx",function(t){var e=n.x(t.values.x)||0;return"ordinal"===n.x.type?e+n.x.rangeBand()/2:e}).attr("cy",function(t){var e=n.y(t.values.y)||0;return"ordinal"===r.y.type?e+n.y.rangeBand()/2:e}),i.each(function(e){var n=t.select(this.parentNode).datum();e.tooltip=n.tooltip,t.select(this).select("circle").attr(n.attributes)}),i.select("title").text(function(e){var n=e.tooltip||"",a=t.format("percent"===r.x.summary?"0%":r.x.format),i=t.format("percent"===r.y.summary?"0%":r.y.format);return n.replace(/\$x/g,a(e.values.x)).replace(/\$y/g,i(e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values.raw[0][n]})}),i}function g(e){var n=this,r=arguments.length<=1||void 0===arguments[1]?this.svg:arguments[1],a=arguments.length<=2||void 0===arguments[2]?"reference-region":arguments[2];r=r||this.svg;var i=this.config,s=r.selectAll("."+a).data(e);return s.exit().remove(),s.enter().append("rect").attr("class",a).append("title"),s.attr({stroke:"none","shape-rendering":"crispEdges"}).transition().attr("x",function(t){return"ordinal"===i.x.type?t.xs[0]:n.x(t.xs[0])}).attr("y",function(t){return"ordinal"===i.y.type?t.ys[0]:n.y(t.ys[1])}).attr("width",function(t){return"ordinal"===i.x.type?t.xs[1]-t.xs[0]:n.x(t.xs[1])-n.x(t.xs[0])}).attr("height",function(t){return"ordinal"===i.y.type?Math.abs(t.ys[0]-t.ys[1]):n.y(t.ys[0])-n.y(t.ys[1])}),s.each(function(e){e.attributes=e.attributes||{},e.attributes.fill=e.attributes.fill||"#eee",t.select(this).attr(e.attributes)}),s}function m(e,n,r,a){void 0===n&&(n=this.svg);var i=this;void 0===r&&(r="reference-line"),n=n||this.svg;var s=this.config,o=n.selectAll("."+r).data(e,a);return o.exit().remove(),o.enter().append("line").attr("class",r).append("title"),o.attr("shape-rendering","crispEdges").transition().attr("x1",function(t){var e=t.xs?t.xs[2]:!1,n=t.xs?i.x(t.xs[0]):0;return e?t.xs[0]:"ordinal"===s.x.type?n+i.x.rangeBand()/2:n}).attr("x2",function(t){var e=t.xs?t.xs[2]:!1,n=t.xs?i.x(t.xs[1]):0;return e?t.xs[1]:"ordinal"===s.x.type?n+i.x.rangeBand()/2:n}).attr("y1",function(t){var e=t.ys?t.ys[2]:!1,n=t.ys?i.y(t.ys[0]):0;return e?t.ys[0]:"ordinal"===s.y.type?n+i.y.rangeBand()/2:n}).attr("y2",function(t){var e=t.ys?t.ys[2]:!1,n=t.ys?i.y(t.ys[1]):0;return e?t.ys[1]:"ordinal"===s.y.type?n+i.y.rangeBand()/2:n}),o.each(function(e){e.attributes=e.attributes||{},e.attributes["stroke-opacity"]=e.attributes["stroke-opacity"]||s.stroke_opacity||1,e.attributes["stroke-width"]=e.attributes["stroke-width"]||s.stroke_width||1,e.attributes.stroke=e.attributes.stroke||"black",t.select(this).attr(e.attributes),t.select(this).select("title").datum(e)}),o}function y(e){var n=this,r=this.config;t.select(this.div).select(".loader").empty()&&t.select(this.div).insert("div",":first-child").attr("class","loader").selectAll(".blockG").data(t.range(8)).enter().append("div").attr("class",function(t){return"blockG rotate"+(t+1)}),this.wrap.attr("class","wc-chart"),this.setDefaults();var a=function(e){n.controls&&(n.controls.targets.push(n),n.controls.ready?n.controls.layout():n.controls.init(e));var a=r.meta_map?r.meta_map:e&&e.length?t.keys(e[0]).map(function(t){return{col:t,label:t}}):[];n.metaMap=t.scale.ordinal().domain(a.map(function(t){return t.col})).range(a.map(function(t){return t.label})),n.raw_data=e;var i=window.$?$(n.div).is(":visible"):!0;if(i)n.layout(),n.wrap.datum(n),n.draw();else var s=setInterval(function(t){var r=$(n.div).is(":visible");if(r){n.layout(),n.wrap.datum(n);var a=n.transformData(e);n.draw(a),clearInterval(s)}},500)};return this.filepath&&!e?t.csv(this.filepath,function(t,e){n.raw_data=e,n.onDataError(t),n.checkRequired(e),a(e)}):a(e),this}function v(){this.svg=this.wrap.append("svg").attr({"class":"wc-svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink"}).append("g");var e=this.svg.append("defs");e.append("pattern").attr({id:"diagonal-stripes",x:0,y:0,width:3,height:8,patternUnits:"userSpaceOnUse",patternTransform:"rotate(30)"}).append("rect").attr({x:"0",y:"0",width:"2",height:"8",style:"stroke:none; fill:black"}),e.append("clipPath").attr("id",this.id).append("rect").attr("class","plotting-area"),this.svg.append("g").attr("class","y axis").append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("dy",".75em").attr("text-anchor","middle"),this.svg.append("g").attr("class","x axis").append("text").attr("class","axis-title").attr("dy","-.35em").attr("text-anchor","middle"),this.svg.append("rect").attr("class","overlay").attr("opacity",0),this.wrap.append("ul").attr("class","legend").append("span").attr("class","legend-title"),t.select(this.div).select(".loader").remove(),this.events.onLayout(this)}function x(e,n,r){void 0===e&&(e=this.colorScale);var a=this,i=this,s=this.config;s.legend.mark=s.legend.mark?s.legend.mark:s.marks.length&&"bar"===s.marks[0].type?"square":s.marks.length?s.marks[0].type:"square";var o=n?n:"string"==typeof s.legend.label?s.legend.label:s.meta_map?this.metaMap(s.color_by):"",l=this.legend||this.wrap.select(".legend"),c=r||e.domain().slice(0).filter(function(t){return void 0!==t&&null!==t}).map(function(t){return{label:t,mark:s.legend.mark}});l.select(".legend-title").text(o).style("display",o?"inline":"none");var u=l.selectAll(".legend-item").data(c,function(t){return t.label+t.mark});u.exit().remove();var f=u.enter().append("li").attr("class","legend-item");f.append("span").attr("class","legend-mark-text").style("color",function(t){return e(t.label)}),f.append("svg").attr("class","legend-color-block"),s.legend.order&&u.sort(function(e,n){return t.ascending(s.legend.order.indexOf(e.label),s.legend.order.indexOf(n.label))}),u.selectAll(".legend-color-block").select(".legend-mark").remove(),u.selectAll(".legend-color-block").each(function(e){var n=t.select(this);"circle"===e.mark?n.append("circle").attr({cx:".5em",cy:".45em",r:".45em","class":"legend-mark"}):"line"===e.mark?n.append("line").attr({x1:0,y1:".5em",x2:"1em",y2:".5em","stroke-width":2,"shape-rendering":"crispEdges","class":"legend-mark"}):"square"===e.mark&&n.append("rect").attr({height:"1em",width:"1em","class":"legend-mark"})}),u.selectAll(".legend-color-block").select(".legend-mark").attr("fill",function(t){return t.color||e(t.label)}).attr("stroke",function(t){return t.color||e(t.label)}).each(function(e){t.select(this).attr(e.attributes)}),f.append("span").attr("class","legend-label").text(function(t){return a.metaMap.domain().indexOf(t.label)>-1?a.metaMap(t.label):t.label}),u.on("mouseover",function(e){if(s.legend.highlight_on_hover){var n=t.select(this).select(".legend-mark").attr("fill");i.svg.selectAll(".wc-data-mark").attr("opacity",.1).filter(function(e){return t.select(this).attr("fill")===n||t.select(this).attr("stroke")===n}).attr("opacity",1)}}).on("mouseout",function(t){s.legend.highlight_on_hover&&a.svg.selectAll(".wc-data-mark").attr("opacity",1)}),e.domain().length>1?l.style("display","block"):l.style("display","none"),this.legend=l}function b(e){if(e)throw t.select(this.div).select(".loader").remove(),this.wrap.append("div").attr("class","alert alert-error alert-danger").text("Dataset could not be loaded."),new Error("Dataset could not be loaded. Check provided path ("+this.filepath+").")}function _(){var e=this,n=this.config,r=1/n.aspect,a=parseInt(this.wrap.style("width")),i=n.max_width?n.max_width:a,s=n.resizable?!i||i>a?a:this.raw_width:n.width;this.textSize(s),this.margin=e.setMargins();var o="ordinal"===n.x.type&&+n.range_band?e.raw_width+e.margin.left+e.margin.right:n.resizable?!n.max_width||a<n.max_width?a:this.raw_width:e.raw_width;this.plot_width=o-this.margin.left-this.margin.right;var l="ordinal"===n.y.type&&+n.range_band?this.raw_height+this.margin.top+this.margin.bottom:!n.resizable&&n.height?n.height:n.resizable?this.plot_width*r:o*r;this.plot_height=l-this.margin.top-this.margin.bottom,t.select(this.svg.node().parentNode).attr("width",o).attr("height",l).select("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.select(".overlay").attr("width",this.plot_width).attr("height",this.plot_height).classed("zoomable",n.zoomable),this.svg.select(".plotting-area").attr("width",this.plot_width).attr("height",this.plot_height+1).attr("transform","translate(0, -1)"),this.xScaleAxis(n.x.type,this.plot_width,this.x_dom),this.yScaleAxis(n.y.type,this.plot_height,this.y_dom);var c=this.svg.select(".x.axis"),u=this.svg.select(".y.axis"),f=c.select(".axis-title"),p=u.select(".axis-title");if("top"!==n.x_location&&c.attr("transform","translate(0,"+this.plot_height+")"),c.transition().call(this.xAxis),u.transition().call(this.yAxis),f.attr("transform","translate("+this.plot_width/2+","+(this.margin.bottom-2)+")"),p.attr("x",-1*this.plot_height/2).attr("y",-1*this.margin.left),this.svg.select(".x.axis.ordinal").selectAll(".tick text").text(function(t){return e.metaMap.domain().indexOf(t)>-1?e.metaMap(t):t}),this.svg.select(".y.axis.ordinal").selectAll(".tick text").text(function(t){return e.metaMap.domain().indexOf(t)>-1?e.metaMap(t):t}),this.drawGridlines(),this.makeLegend(),this.updateRefRegions(),this.updateRefLines(),n.regression_line){var d=this.current_data.slice(0).filter(function(t){return(+t.values.x||0===+t.values.x)&&(+t.values.y||0===+t.values.y)}),h=d.map(function(t){return t.values.x}),g=d.map(function(t){return t.values.y}),m=W.dataOps.linearRegression(h,g),y=this.x.domain()[1],v=[{xs:[0,y],ys:[m.intercept,y*m.slope+m.intercept]}],x=this.drawSimpleLines(v,null,"regression-line").style("clip-path","url(#"+this.id+")").style("shape-rendering","auto");x.select("title").text("slope: "+t.format(".2f")(m.slope)+"\nintercept: "+t.format(".2f")(m.intercept)+"\nr2: "+t.format(".2f")(m.r2))}else this.drawSimpleLines([],null,"regression-line");this.updateDataMarks(),this.events.onResize(this)}function w(){var e=this.config,n="flex"===e.legend.behavior?this.filtered_data:this.raw_data,r=e.color_dom||t.set(n.map(function(t){return t[e.color_by]})).values().filter(function(t){return t&&"undefined"!==t});r=r.sort(e.legend.order?function(n,r){return t.ascending(e.legend.order.indexOf(n),e.legend.order.indexOf(r))}:W.dataOps.naturalSorter),this.colorScale=t.scale.ordinal().domain(r).range(e.colors)}function k(){this.raw_data=this.raw_data||[],this.config.x=this.config.x||{},this.config.y=this.config.y||{},this.config.x_type&&(this.config.x.type=this.config.x_type),this.config.x_vals&&this.config.x_vals.col&&(this.config.x.type=this.config.x_vals.col),this.config.x_vals&&this.config.x_vals.stat&&(this.config.x.summary=this.config.x_vals.stat),this.config.x_behavior&&(this.config.x.behavior=this.config.x_behavior),this.config.x_label&&(this.config.x.label=this.config.x_label),this.config.y_type&&(this.config.y.type=this.config.y_type),this.config.y_vals&&this.config.y_vals.col&&(this.config.y.type=this.config.y_vals.col),this.config.y_vals&&this.config.y_vals.stat&&(this.config.y.summary=this.config.y_vals.stat),this.config.y_behavior&&(this.config.y.behavior=this.config.y_behavior),this.config.y_label&&(this.config.y.label=this.config.y_label),this.config.x.label=void 0!==this.config.x.label?this.config.x.label:this.config.x.column,this.config.y.label=void 0!==this.config.y.label?this.config.y.label:this.config.y.column,this.config.x.sort=this.config.x.sort||"alphabetical-ascending",this.config.y.sort=this.config.y.sort||"alphabetical-descending",this.config.x.type=this.config.x.type||"linear",this.config.y.type=this.config.y.type||"linear",this.config.margin=this.config.margin||{},this.config.legend=this.config.legend||{},this.config.legend.label=void 0!==this.config.legend.label?this.config.legend.label:this.config.color_by,this.config.marks=this.config.marks&&this.config.marks.length?this.config.marks:[{}],this.config.reference_regions=this.config.reference_regions||[],this.config.date_format=this.config.date_format||"%x",this.config.padding=void 0!==this.config.padding?this.config.padding:.3,this.config.outer_pad=void 0!==this.config.outer_pad?this.config.outer_pad:.1,this.config.resizable=void 0!==this.config.resizable?this.config.resizable:!0,this.config.aspect=this.config.aspect||1.33,this.config.colors=this.config.colors||["rgb(102,194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],this.config.no_text_size=void 0===this.config.no_text_size?!1:this.config.no_text_size}function A(){var e=this,n=(this.xAxis.tickFormat()?this.x.domain().map(function(t){return e.xAxis.tickFormat()(t)}):this.x.domain(),this.yAxis.tickFormat()?this.y.domain().map(function(t){return e.yAxis.tickFormat()(t)}):this.y.domain()),r=t.max(n.map(function(t){return String(t).length}));this.config.y_format&&this.config.y_format.indexOf("%")>-1&&(r+=1),r=Math.max(2,r);var a=this.config.x.label?1.5:0,i=this.config.y.label?1.5:.25,s=parseInt(this.wrap.style("font-size")),o=this.config.x2_interval?1:0,l=r*s*.5+s*i*1.5||8,c=s+s/1.5+s*a+s*o||8;return l+=6,c+=3,{top:this.config.margin&&this.config.margin.top?this.config.margin.top:8,right:this.config.margin&&this.config.margin.right?this.config.margin.right:16,bottom:this.config.margin&&this.config.margin.bottom?this.config.margin.bottom:c,left:this.config.margin&&this.config.margin.left?this.config.margin.left:l}}function O(t,e){var n="14px",r=4,a=2;this.config.no_text_size?(n=this.config.font_size,r=this.config.point_size||4,a=this.config.stroke_width||2):t>=600?(n="14px",r=4,a=2):t>450&&600>t?(n="12px",r=3,a=2):t>300&&450>t?(n="10px",r=2,a=2):300>=t&&(n="10px",r=2,a=1),this.wrap.style("font-size",n),this.config.flex_point_size=r,this.config.flex_stroke_width=a}function z(e,n){function r(e,r){var i=[],o=[],l=t.nest();"linear"===s.x.type&&s.x.bin||"linear"===s.y.type&&s.y.bin?!function(){var n="linear"===s.x.type&&s.x.bin?"x":"y",r=t.scale.quantile().domain(t.extent(e.map(function(t){return+t[s[n].column]}))).range(t.range(+s[n].bin));e.forEach(function(t){return t.wc_bin=r(t[s[n].column])}),l.key(function(t){return r.invertExtent(t.wc_bin)})}():l.key(function(t){return n.per.map(function(e){return t[e]}).join(" ")}),r&&(l.key(function(t){return t[r]}),l.sortKeys(function(e,n){return"time"===s.x.type?t.ascending(new Date(e),new Date(n)):s.x_dom?t.ascending(s.x_dom.indexOf(e),s.x_dom.indexOf(n)):r===s.color_by&&s.legend.order?t.ascending(s.legend.order.indexOf(e),s.legend.order.indexOf(n)):"ordinal"===s.x.type||"ordinal"===s.y.type?W.dataOps.naturalSorter(e,n):t.ascending(+e,+n)})),l.rollup(function(r){var a={raw:r},l=r.map(function(t){return t[s.y.column]}).sort(t.ascending),c=r.map(function(t){return t[s.x.column]}).sort(t.ascending);if(a.x="ordinal"===s.x.type?r[0][s.x.column]:W.dataOps.summarize(c,s.x.summary),a.y="ordinal"===s.y.type?r[0][s.y.column]:W.dataOps.summarize(l,s.y.summary),a.x_q25=s.error_bars&&"ordinal"===s.y.type?t.quantile(c,.25):a.x,a.x_q75=s.error_bars&&"ordinal"===s.y.type?t.quantile(c,.75):a.x,a.y_q25=s.error_bars?t.quantile(l,.25):a.y,a.y_q75=s.error_bars?t.quantile(l,.75):a.y,i.push([a.x_q25,a.x_q75,a.x]),o.push([a.y_q25,a.y_q75,a.y]),"cumulative"===s.y.summary){var u=e.filter(function(t){return"time"===s.x.type?new Date(t[s.x.column])<=new Date(r[0][s.x.column]):+t[s.x.column]<=+r[0][s.x.column]});n.per.length&&(u=u.filter(function(t){return t[n.per[0]]===r[0][n.per[0]]}));var f="time"===s.x.type?u.length:t.sum(u.map(function(t){return+t[s.y.column]||0===+t[s.y.column]?+t[s.y.column]:1}));o.push([f]),a.y=f}if("cumulative"===s.x.summary){var u=e.filter(function(t){return"time"===s.y.type?new Date(t[s.y.column])<=new Date(r[0][s.y.column]):+t[s.y.column]<=+r[0][s.y.column]});n.per.length&&(u=u.filter(function(t){return t[n.per[0]]===r[0][n.per[0]]})),i.push([u.length]),a.x=u.length}return a});var c=l.entries(e),u=t.extent(t.merge(i)),p=t.extent(t.merge(o));return r&&"bar"===n.type&&"stacked"===n.arrange&&(c.forEach(a),("ordinal"===s.x.type||"linear"===s.x.type&&s.x.bin)&&(p=t.extent(c.map(function(t){return t.total}))),("ordinal"===s.y.type||"linear"===s.y.type&&s.y.bin)&&(u=t.extent(c.map(function(t){return t.total})))),"total-ascending"===s.x.sort||"total-ascending"===s.y.sort?f=c.sort(function(e,n){return t.ascending(e.total,n.total)}).map(function(t){return t.key}):("total-descending"===s.x.sort||"total-descending"===s.y.sort)&&(f=c.sort(function(e,n){return t.ascending(e.total,n.total)}).map(function(t){return t.key}).reverse()),{nested:c,dom_x:u,dom_y:p}}function a(e){var n="ordinal"===s.x.type||"linear"===s.x.type&&s.x.bin?"y":"x";e.total=t.sum(e.values.map(function(t){return+t.values[n];

}));var r=0;e.values.forEach(function(t,n){"ordinal"===s.x.type||"linear"===s.x.type&&s.x.bin?(t.values.y="percent"===s.y.summary?t.values.y/e.total:t.values.y||0,r+=+t.values.y,t.values.start=e.values[n-1]?r:t.values.y):(t.values.x="percent"===s.x.summary?t.values.x/e.total:t.values.x||0,t.values.start=r,r+=+t.values.x)})}var i=this,s=this.config,o=s.x.behavior||"raw",l=s.y.behavior||"raw",c="line"===n.type?s.x.column:"bar"===n.type&&n.split?n.split:null,u=t.time.format(s.date_format),f=void 0;s.lengthen_columns&&(e=W.dataOps.lengthenRaw(e,s.lengthen_columns)),e=n.per&&n.per.length?e.filter(function(t){return t[n.per[0]]}):e,s.initial_filter&&(e=e.filter(function(t){return-1!==s.initial_filter.vals.indexOf(t[s.initial_filter.col])})),s.x.column&&(e=e.filter(function(t){return t[s.x.column]})),s.y.column&&(e=e.filter(function(t){return t[s.y.column]})),"time"===s.x.type&&(e=e.filter(function(t){return t[s.x.column]instanceof Date?t[s.x.column]:u.parse(t[s.x.column])}),e.forEach(function(t){return t[s.x.column]=t[s.x.column]instanceof Date?t[s.x.column]:u.parse(t[s.x.column])})),"time"===s.y.type&&(e=e.filter(function(t){return t[s.y.column]instanceof Date?t[s.y.column]:u.parse(t[s.y.column])}),e.forEach(function(t){return t[s.y.column]=t[s.y.column]instanceof Date?t[s.y.column]:u.parse(t[s.y.column])})),"linear"!==s.x.type&&"log"!==s.x.type||!s.x.column||(e=e.filter(function(t){return"count"!==s.x.summary&&"percent"!==s.x.summary?+t[s.x.column]||0===+t[s.x.column]:t})),"linear"!==s.y.type&&"log"!==s.y.type||!s.y.column||(e=e.filter(function(t){return"count"!==s.y.summary&&"percent"!==s.y.summary?+t[s.y.column]||0===+t[s.y.column]:t}));var p=void 0;"bar"===n.type?p="stacked"!==n.arrange?r(e,c):r(e):("count"===s.x.summary||"count"===s.y.summary)&&(p=r(e));var d="cumulative"===s.x.summary?[0,e.length]:"ordinal"===s.x.type?t.set(e.map(function(t){return t[s.x.column]})).values().filter(function(t){return t}):t.extent(n.split&&"stacked"!==n.arrange?t.merge(p.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})})):"count"===s.x.summary?p.nested.map(function(t){return t.values.raw.length}):e.map(function(t){return+t[s.x.column]}).filter(function(t){return+t})),h="cumulative"===s.y.summary?[0,e.length]:"ordinal"===s.y.type?t.set(e.map(function(t){return t[s.y.column]})).values().filter(function(t){return t}):t.extent(n.split&&"stacked"!==n.arrange?t.merge(p.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})})):"count"===s.y.summary?p.nested.map(function(t){return t.values.raw.length}):e.map(function(t){return+t[s.y.column]}).filter(function(t){return+t||0===+t})),g=e,m=[],y=[];this.filters.length&&(this.filters.forEach(function(t){g=g.filter(function(e){return"All"===t.val?e:t.val instanceof Array?t.val.indexOf(e[t.col])>-1:e[t.col]===t.val})}),("firstfilter"===s.x.behavior||"firstfilter"===s.y.behavior)&&this.filters[0].choices.filter(function(t){return"All"!==t}).forEach(function(t){var n=e.filter(function(e){return e[i.filters[0].col]===t}),a=r(n,c);m.push(a.dom_x),y.push(a.dom_y)}));var v=t.extent(t.merge(m)),x=t.extent(t.merge(y));this.filtered_data=g;var b=r(g,c),_=b.dom_x,w=b.dom_y;"bar"===n.type&&("ordinal"===s.y.type&&"count"===s.x.summary?s.x.domain=s.x.domain?[0,s.x.domain[1]]:[0,null]:"ordinal"===s.x.type&&"count"===s.y.summary&&(s.y.domain=s.y.domain?[0,s.y.domain[1]]:[0,null]));var k=Boolean(this.filters.length&&"All"!==this.filters[0].val&&this.filters.slice(1).filter(function(t){return"All"===t.val}).length===this.filters.length-1),A=this.filters.length?"raw"===o?d:k&&"firstfilter"===o?v:_:_,O=this.filters.length?"raw"===l?h:k&&"firstfilter"===l?x:w:w,z=s.x_dom?s.x_dom:"ordinal"===s.x.type&&"flex"===s.x.behavior?t.set(g.map(function(t){return t[s.x.column]})).values():"ordinal"===s.x.type?t.set(e.map(function(t){return t[s.x.column]})).values():s.x_from0?[0,t.max(A)]:A,S=s.y_dom?s.y_dom:"ordinal"===s.y.type&&"flex"===s.y.behavior?t.set(g.map(function(t){return t[s.y.column]})).values():"ordinal"===s.y.type?t.set(e.map(function(t){return t[s.y.column]})).values():s.y_from0?[0,t.max(O)]:O;return s.x.domain&&(s.x.domain[0]||0===s.x.domain[0])&&(z[0]=s.x.domain[0]),s.x.domain&&(s.x.domain[1]||0===s.x.domain[1])&&(z[1]=s.x.domain[1]),s.y.domain&&(s.y.domain[0]||0===s.y.domain[0])&&(S[0]=s.y.domain[0]),s.y.domain&&(s.y.domain[1]||0===s.y.domain[1])&&(S[1]=s.y.domain[1]),"ordinal"===s.x.type&&(s.x.order=f),"ordinal"===s.y.type&&(s.y.order=f),this.current_data=b.nested,{data:b.nested,x_dom:z,y_dom:S}}function S(){this.drawPoints(this.marks.filter(function(t){return"circle"===t.type})),this.drawLines(this.marks.filter(function(t){return"line"===t.type})),this.drawBars(this.marks.filter(function(t){return"bar"===t.type}))}function D(){var e=this,n=this.config,r=n.reference_lines?n.reference_lines.map(function(r){var a=r.x,i=r.y;return"time"===n.x.type&&r.x&&(a=t.time.format(n.date_format).parse(r.x)),"time"===n.y.type&&r.y&&(i=t.time.format(n.date_format).parse(r.y)),{xs:r.x||0===+r.x?[a,a]:[0,e.plot_width,!0],ys:r.y||0===+r.y?[i,i]:[0,e.plot_height,!0],attributes:r.attributes}}):[];this.drawSimpleLines(r).style("clip-path","url(#"+this.id+")")}function E(){var e=this,n=this.config,r=this.config.reference_regions.slice(0).map(function(r){var a=r.x,i=r.y;return"time"===n.x.type&&(a=r.x?r.x.map(function(e){return t.time.format(n.date_format).parse(e)}):e.x_dom),"time"===n.y.type&&(i=r.y?r.y.map(function(e){return t.time.format(n.date_format).parse(e)}):e.y_dom),{xs:a?a:[1,e.plot_width],ys:r.y?i:[0,e.plot_height-1],attributes:r.attributes}});this.drawRects(r).style("clip-path","url(#"+this.id+")")}function q(e,n,r){var a=this.config,i=void 0;i="log"===e?t.scale.log():"ordinal"===e?t.scale.ordinal():"time"===e?t.time.scale():t.scale.linear(),i.domain(r),"ordinal"===e?i.rangeBands([0,+n],a.padding,a.outer_pad):i.range([0,+n]).clamp(Boolean(a.x_clamp));var s=a.x.format?a.x.format:"percent"===e?"0%":"time"===e?"%x":".0f",o=Math.max(2,Math.min(n/80,8)),l=t.svg.axis().scale(i).orient(a.x.location).ticks(o).tickFormat("ordinal"===e?null:"time"===e?t.time.format(s):t.format(s)).tickValues(a.x.ticks?a.x.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.x.axis").attr("class","x axis "+e),this.x=i,this.xAxis=l}function C(e,n,r){var a=this.config,i=void 0;i="log"===e?t.scale.log():"ordinal"===e?t.scale.ordinal():"time"===e?t.time.scale():t.scale.linear(),i.domain(r),"ordinal"===e?i.rangeBands([+n,0],a.padding,a.outer_pad):i.range([+n,0]).clamp(Boolean(a.y_clamp));var s=a.y.format?a.y.format:"percent"===a.y.summary?"0%":".0f",o=Math.max(2,Math.min(n/80,8)),l=t.svg.axis().scale(i).orient("left").ticks(o).tickFormat("ordinal"===e?null:"time"===e?t.time.format(s):t.format(s)).tickValues(a.y.ticks?a.y.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.y.axis").attr("class","y axis "+e),this.y=i,this.yAxis=l}function B(t,e){var n=this,r=e.append("input").attr("type","checkbox").attr("class","changer").datum(t).property("checked",function(e){return-1!==t.option.indexOf(".")?n.targets[0].config[t.option.split(".")[0]][t.option.split(".")[1]]:n.targets[0].config[t.option]});r.on("change",function(t){var e=r.property("checked");n.changeOption(t.option,e)})}function M(t){this.data=t,this.config.builder||this.checkRequired(this.data),this.layout(),this.ready=!0}function L(e){var n=this,r=t.keys(e[0]);console.log("line 5??"),this.config.inputs&&this.config.inputs.forEach(function(t,e){if("subsetter"===t.type&&-1===r.indexOf(t.value_col))throw n.config.inputs=n.config.inputs.splice(controls[e],1),new Error('Error in settings object: the value "'+t.value_col+'" does not match any column in the provided dataset.')})}function R(t){var e=this.wrap.append("div").attr("class","control-group").classed("inline",t.inline).datum(t),n=e.append("span").attr("class","control-label").text(t.label);if(t.required&&n.append("span").attr("class","label label-required").text("Required"),e.append("span").attr("class","span-description").text(t.description),"text"===t.type)this.makeTextControl(t,e);else if("number"===t.type)this.makeNumberControl(t,e);else if("list"===t.type)this.makeListControl(t,e);else if("dropdown"===t.type)this.makeDropdownControl(t,e);else if("btngroup"===t.type)this.makeBtnGroupControl(t,e);else if("checkbox"===t.type)this.makeCheckboxControl(t,e);else if("radio"===t.type)this.makeRadioControl(t,e);else{if("subsetter"!==t.type)throw new Error('Each control must have a type! Choose from: "text", "number", "list", "dropdown", "btngroup", "checkbox", "radio", "subsetter"');this.makeSubsetterControl(t,e)}}function N(t,e){var n=this,r=e.append("input").attr("type","text").attr("class","changer").datum(t).property("value",function(e){return-1!==t.option.indexOf(".")?n.targets[0].config[t.option.split(".")[0]][t.option.split(".")[1]]:n.targets[0].config[t.option]});r.on("change",function(e){var a=r.property("value");n.changeOption(t.option,a)})}function j(t,e){var n=this,r=e.append("input").attr("type","text").attr("class","changer").datum(t).property("value",function(e){return-1!==t.option.indexOf(".")?n.targets[0].config[t.option.split(".")[0]][t.option.split(".")[1]]:n.targets[0].config[t.option]});r.on("change",function(e){var a=r.property("value")?r.property("value").split(",").map(function(t){return t.trim()}):null;n.changeOption(t.option,a)})}function T(t,e){var n=this,r=e.append("input").attr("type","number").attr("min",void 0!==t.min?t.min:0).attr("max",t.max).attr("step",t.step||1).attr("class","changer").datum(t).property("value",function(e){return-1!==t.option.indexOf(".")?n.targets[0].config[t.option.split(".")[0]][t.option.split(".")[1]]:n.targets[0].config[t.option]});r.on("change",function(e){var a=+r.property("value");n.changeOption(t.option,a)})}function I(e,n){var r=this,a=n.append("select").attr("class","changer").attr("multiple",e.multiple?!0:null).datum(e),i=e.values&&e.values instanceof Array?e.values:e.values?t.set(this.data.map(function(t){return t[r.targets[0].config[e.values]]})).values():t.keys(this.data[0]);(!e.require||e.none)&&i.unshift("None");var s=a.selectAll("option").data(i).enter().append("option").text(function(t){return t}).property("selected",function(t){return-1!==e.option.indexOf(".")?r.targets[0].config[e.option.split(".")[0]][e.option.split(".")[1]]===t:r.targets[0].config[e.option]===t});return a.on("change",function(n){var i="None"===a.property("value")?null:a.property("value");e.multiple&&(i=s.filter(function(e){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("value")}).filter(function(t){return"None"!==t})),r.changeOption(e.option,i)}),a}function F(e,n){var r=this,a=e.values?e.values:t.keys(this.data[0]),i=n.append("div").attr("class","btn-group"),s=i.selectAll("button").data(a).enter().append("button").attr("class","btn btn-default btn-sm").text(function(t){return t}).classed("btn-primary",function(t){return-1!==e.option.indexOf(".")?r.targets[0].config[e.option.split(".")[0]][e.option.split(".")[1]]===t:r.targets[0].config[e.option]===t});s.on("click",function(n){s.each(function(e){t.select(this).classed("btn-primary",e===n)}),r.changeOption(e.option,n)})}function G(t,e){this.targets.forEach(function(n){-1!==t.indexOf(".")?n.config[t.split(".")[0]][t.split(".")[1]]=e:n.config[t]=e,n.draw()})}function U(e,n){var r=this,a=n.selectAll("label").data(e.values).enter().append("label").attr("class","radio").text(function(t,n){return e.relabels?e.relabels[n]:t}).append("input").attr("type","radio").attr("class","changer").attr("name",e.option.replace(".","-")+"-"+this.targets[0].id).property("value",function(t){return t}).property("checked",function(t){return-1!==e.option.indexOf(".")?r.targets[0].config[e.option.split(".")[0]][e.option.split(".")[1]]===t:r.targets[0].config[e.option]===t});a.on("change",function(n){var i=null;a.each(function(e){t.select(this).property("checked")&&(i="none"===t.select(this).property("value")?null:e)}),r.changeOption(e.option,i)})}function H(e,n){function r(t,e){var n=-1;t.filters.forEach(function(t,r){t.col===e.col&&(n=r)}),n>-1&&(t.filters[n]=e)}var a=this.targets,i=n.append("select").attr("class","changer").attr("multiple",e.multiple?!0:null).datum(e),s=e.values?e.values:t.set(this.data.map(function(t){return t[e.value_col]}).filter(function(t){return t})).values();s.sort(t.ascending),e.start=e.start?e.start:e.loose?s[0]:null,e.multiple||e.start||s.unshift("All"),e.loose=!e.loose&&e.start?!0:e.loose;var o=i.selectAll("option").data(s).enter().append("option").text(function(t){return t}).property("selected",function(t){return t===e.start});a.forEach(function(t){var n=t.filters.slice().map(function(t){return t.col===e.value_col}).indexOf(!0);n>-1?t.filters[n]={col:e.value_col,val:e.start?e.start:"All",choices:s,loose:e.loose}:t.filters.push({col:e.value_col,val:e.start?e.start:"All",choices:s,loose:e.loose})}),i.on("change",function(n){var i=this;e.multiple?!function(){var n=o.filter(function(e){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("value")}),i={col:e.value_col,val:n,choices:s,loose:e.loose};a.forEach(function(t){r(t,i),t.draw()})}():!function(){var n=t.select(i).property("value"),o={col:e.value_col,val:n,choices:s,loose:e.loose};a.forEach(function(t){r(t,o),t.draw()})}()})}function P(){var t=this;this.config.inputs&&this.config.inputs.length&&this.config.inputs[0]&&this.config.inputs.forEach(function(e){return t.makeControlItem(e)})}function Q(){this.wrap.selectAll("*").remove(),this.controlUpdate()}function V(e,n){var r=n?n:this.raw_data,a=this.config,i=e||this.transformData(r);this.wrap.datum(i);var s=this.table,o=a.cols.length?a.cols:i.length?t.keys(i[0].values[0].raw):[];a.bootstrap?s.classed("table",!0):s.classed("table",!1);var l=i.length?a.headers&&a.headers.length?a.headers:o:[],c=s.select("thead").select("tr.headers"),u=c.selectAll("th").data(l);u.exit().remove(),u.enter().append("th"),u.text(function(t){return t});var f=s.selectAll("tbody").data(i,function(t){return t.key});if(f.exit().remove(),f.enter().append("tbody"),a.row_per){var p=a.row_per.slice(0).reverse();p.forEach(function(t){f.sort(function(e,n){return e.values[0].raw[t]-n.values[0].raw[t]})})}var d=f.selectAll("tr").data(function(t){return t.values});d.exit().remove(),d.enter().append("tr"),a.sort_rows&&!function(){var t=a.sort_rows.slice(0);t.unshift("0"),d.sort(function(e,n){for(var r=0;r<t.length&&e.raw[t[r]]==n.raw[t[r]];)r++;return e.raw[t[r]]<n.raw[t[r]]?-1:e.raw[t[r]]>n.raw[t[r]]?1:0})}();var h=d.selectAll("td").data(function(t){return t.cells.filter(function(t){return o.indexOf(t.col)>-1})});if(h.exit().remove(),h.enter().append("td"),h.attr("class",function(t){return t.col}),a.as_html?h.html(function(t){return t.text}):h.text(function(t){return t.text}),a.row_per&&d.filter(function(t,e){return e>0}).selectAll("td").filter(function(t){return a.row_per.indexOf(t.col)>-1}).text(""),a.data_tables){if(!jQuery()||!jQuery().dataTable)throw new Error("dataTables jQuery plugin not available");var g=a.data_tables;g.searching=a.searchable?a.searchable:!1,$(s.node()).dataTable(g);var m=$(".print-btn",wrap.node());m.addClass("pull-right"),$(".dataTables_wrapper").prepend(m)}this.events.onDraw(this)}function K(e){if(e){var n=this.config,r=n.cols||t.keys(e[0]);n.keep&&n.keep.forEach(function(t){-1===r.indexOf(t)&&r.unshift(t)}),this.config.cols=r;var a=e;this.filters.length&&this.filters.forEach(function(t){var e=t.val instanceof Array;a=a.filter(function(n){return e?-1!==t.val.indexOf(n[t.col]):"All"!==t.val?n[t.col]===t.val:n})});var i=t.nest().key(function(t){return n.row_per?n.row_per.map(function(e){return t[e]}).join(" "):t}).rollup(function(t){n.dataManipulate&&(t=n.dataManipulate(t));var e=t.map(function(t){var e=[];for(var r in t)e.push({col:r,text:t[r]});return e.sort(function(t,e){return n.cols.indexOf(t.col)-n.cols.indexOf(e.col)}),{cells:e,raw:t}});return e}).entries(a);return this.current_data=i,this.events.onDatatransform(this),this.current_data}}function J(){t.select(this.div).select(".loader").remove();var e=this.wrap.append("table");e.append("thead").append("tr").attr("class","headers"),this.table=e,this.events.onLayout(this)}var W={version:"0.2"};W.multiply=function(e,n,r,a){function i(r){var i=t.set(r.map(function(t){return t[n]})).values().filter(function(t){return t});a&&(i=i.sort(function(e,n){return t.ascending(a.indexOf(e),a.indexOf(n))})),i.forEach(function(t){var a=(r.filter(function(e){return e[n]===t}),W.chart(e.wrap.node(),null,s,e.controls));a.events=e.events,a.legend=l,a.filters.unshift({col:n,val:t,choices:i}),a.wrap.insert("span","svg").attr("class","wc-chart-title").text(t),a.init(r)})}var s=e.config,o=e.wrap.classed("wc-layout wc-small-multiples",!0).classed("wc-chart",!1),l=o.append("ul").attr("class","legend");t.csv(e.filepath,function(t,n){e.raw_data=n,e.onDataError(t),e.checkRequired(n),i(n)})},W.dataOps={getValType:s,lengthenRaw:e,linearRegression:n,naturalSorter:r,standardError:a,summarize:i};var X={checkRequired:o,consolidateData:l,draw:c,drawArea:u,drawBars:f,drawGridlines:p,drawLines:d,drawPoints:h,drawRects:g,drawSimpleLines:m,init:y,layout:v,makeLegend:x,onDataError:b,resize:_,setColorScale:w,setDefaults:k,setMargins:A,textSize:O,transformData:z,updateDataMarks:S,updateRefLines:D,updateRefRegions:E,xScaleAxis:q,yScaleAxis:C};W.chartCount=0,W.chart=function(e,n,r,a){void 0===e&&(e="body"),void 0===r&&(r={});var i=Object.create(X);return i.div=e,i.filepath=n,i.config=Object.create(r),i.controls=a,i.filters=[],i.required_cols=[],i.marks=[],i.wrap=t.select(i.div).append("div"),i.events={onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},i.on=function(t,e){var n=["layout","datatransform","draw","resize"];n.indexOf(t)<0||e&&(i.events["on"+t.charAt(0).toUpperCase()+t.slice(1)]=e)},W.chartCount++,i.id=W.chartCount,i};var Y={changeOption:G,checkRequired:L,controlUpdate:P,init:M,layout:Q,makeControlItem:R,makeBtnGroupControl:F,makeCheckboxControl:B,makeDropdownControl:I,makeListControl:j,makeNumberControl:T,makeRadioControl:U,makeSubsetterControl:H,makeTextControl:N};W.controls=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=(arguments.length<=3||void 0===arguments[3]?{resizable:!0,max_width:800}:arguments[3],Object.create(Y));return a.div=e,a.data=n,a.config=Object.create(r),a.config.inputs=a.config.inputs||[],a.targets=[],a.wrap="top"===r.location?t.select(e).insert("div",":first-child").attr("class","wc-controls top"):t.select(e).append("div").attr("class","wc-controls "+a.config.location),a};var Z=Object.create(X);return Z.layout=J,Z.transformData=K,Z.draw=V,W.table=function(e,n,r,a){void 0===e&&(e="body"),void 0===r&&(r={});var i=Object.create(W.prototypes.table);return i.div=e,i.filepath=n,i.config=Object.create(r),i.controls=a,i.filters=[],i.required_cols=[],i.marks=[],i.wrap=t.select(i.div).append("div"),i.events={onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},i.on=function(t,e){var n=["layout","datatransform","draw","resize"];n.indexOf(t)<0||e&&(i.events["on"+t.charAt(0).toUpperCase()+t.slice(1)]=e)},i},W.prototypes={chart:X,table:Z,controls:Y},W});