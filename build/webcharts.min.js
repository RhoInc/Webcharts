!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof module&&module.exports?module.exports=e(require("d3")):t.webCharts=e(t.d3)}(this,function(t){"use strict";function e(t,e){var n=[];return t.forEach(function(t){e.forEach(function(e){var r=Object.create(t);r.wc_category=e,r.wc_value=t[e],n.push(r)})}),n}function n(t,e){function n(t){for(var e=[],n=0,r=-1,a=0,i=void 0,o=void 0;i=(o=t.charAt(n++)).charCodeAt(0);){var s=46==i||i>=48&&57>=i;s!==a&&(e[++r]="",a=s),e[r]+=o}return e}for(var r=n(t.toLowerCase()),a=n(e.toLowerCase()),i=0;r[i]&&a[i];i++)if(r[i]!==a[i]){var o=Number(r[i]),s=Number(a[i]);return o==r[i]&&s==a[i]?o-s:r[i]>a[i]?1:-1}return r.length-a.length}function r(e,n){var r=e.filter(function(t){return+t||0===+t}).map(function(t){return+t});if("cumulative"===n)return null;var a=n||"mean",i="count"===a?e.length:"percent"===a?e.length:t[a](r);return i}function a(e,n){var r=t.set(e.map(function(t){return t[n]})).values(),a=r.filter(function(t){return+t||0===t});return r.length===a.length&&r.length>4?"continuous":"categorical"}function i(){var e=this,n=t.keys(this.raw_data[0]),r=[],a=[];this.config.x.column&&(r.push("this.config.x.column"),a.push(this.config.x.column)),this.config.y.column&&(r.push("this.config.y.column"),a.push(this.config.y.column)),this.config.color_by&&(r.push("this.config.color_by"),a.push(this.config.color_by)),this.config.marks.forEach(function(t,e){t.per&&t.per.length&&t.per.forEach(function(t,n){r.push("this.config.marks["+e+"].per["+n+"]"),a.push(t)}),t.split&&(r.push("this.config.marks["+e+"].split"),a.push(t.split))}),a.forEach(function(a,i){if(n.indexOf(a)<0)throw t.select(e.div).select(".loader").remove(),e.wrap.append("div").style("color","red").html('The value "'+a+'" for the <code>'+r[i]+"</code> setting does not match any column in the provided dataset."),new Error('Error in settings object: The value "'+a+'" for the '+r[i]+" setting does not match any column in the provided dataset.")})}function o(e){var n=this,r=this.config,a=[],i=[],o=[];if(this.setDefaults(),r.marks.forEach(function(t,r){"bar"!==t.type&&(t.arrange=null,t.split=null);var s=t.per?n.transformData(e,t):{data:[],x_dom:[],y_dom:[]};a.push(s.data),i.push(s.x_dom),o.push(s.y_dom),n.marks[r]={type:t.type,per:t.per,data:s.data,split:t.split,arrange:t.arrange,order:t.order,tooltip:t.tooltip,attributes:t.attributes}}),"ordinal"===r.x.type)if(r.x.sort&&"alphabetical-descending"===r.x.sort)this.x_dom=t.set(t.merge(i)).values().sort(Q.dataOps.naturalSorter).reverse();else if("time"===r.y.type&&"earliest"===r.x.sort){{t.time.format(r.date_format)}this.x_dom=t.nest().key(function(t){return t[r.x.column]}).rollup(function(t){return t.map(function(t){return t[r.y.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,n){return t.min(n.values)-t.min(e.values)}).map(function(t){return t.key})}else this.x_dom=r.x.order?t.set(t.merge(i)).values().sort(function(e,n){return t.ascending(r.x.order.indexOf(e),r.x.order.indexOf(n))}):r.x.sort&&"alphabetical-descending"!==r.x.sort?t.set(t.merge(i)).values():t.set(t.merge(i)).values().sort(Q.dataOps.naturalSorter);else this.x_dom=t.extent(t.merge(i));if("ordinal"===r.y.type)if(r.y.sort&&"alphabetical-ascending"===r.y.sort)this.y_dom=t.set(t.merge(o)).values().sort(Q.dataOps.naturalSorter);else if("time"===r.x.type&&"earliest"===r.y.sort){{t.time.format(r.date_format)}this.y_dom=t.nest().key(function(t){return t[r.y.column]}).rollup(function(t){return t.map(function(t){return t[r.x.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,n){return t.min(n.values)-t.min(e.values)}).map(function(t){return t.key})}else this.y_dom=r.y.order?t.set(t.merge(o)).values().sort(function(e,n){return t.ascending(r.y.order.indexOf(e),r.y.order.indexOf(n))}):r.y.sort&&"alphabetical-descending"!==r.y.sort?t.set(t.merge(o)).values():t.set(t.merge(o)).values().sort(Q.dataOps.naturalSorter).reverse();else this.y_dom="percent"===r.y.summary?[0,1]:t.extent(t.merge(o))}function s(e,n){var r=this,a=e?e:this.raw_data?this.raw_data:[],i=this.config,o=1/i.aspect,s=this.consolidateData(a);this.wrap.datum(s);var l=parseInt(this.wrap.style("width"));this.setColorScale();var c=i.max_width?i.max_width:l;this.raw_width="ordinal"===i.x.type&&+i.range_band?(+i.range_band+i.range_band*i.padding)*this.x_dom.length:i.resizable?c:i.width?i.width:l,this.raw_height="ordinal"===i.y.type&&+i.range_band?(+i.range_band+i.range_band*i.padding)*this.y_dom.length:i.resizable?c*o:i.height?i.height:l*o;var u=this.svg.select(".overlay").attr("width")?this.svg.select(".overlay").attr("width"):this.raw_width,d=this.svg.select(".overlay").attr("height")?this.svg.select(".overlay").attr("height"):this.raw_height;this.svg.select(".x.axis").select(".axis-title").text(function(){return"string"==typeof i.x.label?i.x.label:"function"==typeof i.x.label?i.x.label(r):null}),this.svg.select(".y.axis").select(".axis-title").text(function(){return"string"==typeof i.y.label?i.y.label:"function"==typeof i.y.label?i.y.label(r):null}),this.xScaleAxis(u),this.yScaleAxis(d),i.resizable?t.select(window).on("resize."+r.element+r.id,function(){r.resize()}):t.select(window).on("resize."+r.element+r.id,null),this.events.onDraw.call(this),this.resize()}function l(t,e,n,r,a){void 0===r&&(r="chart-area");var i=this,o=arguments.length<=5||void 0===arguments[5]?function(t){return t}:arguments[5],s=this.svg.selectAll("."+r).data(e,a);return s.exit().remove(),s.enter().append("g").attr("class",function(t){return r+" "+t.key}).append("path"),s.select("path").datum(n).attr("fill",function(t){var e=o(t);return e?i.colorScale(e[i.config.color_by]):null}).attr("fill-opacity",this.config.fill_opacity||0===this.config.fill_opacity?this.config.fill_opacity:.3).transition().attr("d",t),s}function c(e){var n=this,r=this.raw_data,a=this.config,i=this.svg.selectAll(".bar-supergroup").data(e,function(t){return t.per.join("-")});i.enter().append("g").attr("class","bar-supergroup"),i.exit().remove();var o=i.selectAll(".bar-group").data(function(t){return t.data},function(t){return t.key}),s=o.exit(),l=void 0,c=void 0;"ordinal"===a.x.type?(s.selectAll(".bar").transition().attr("y",this.y(0)).attr("height",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("y",this.y(0)).attr("height",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("y",this.y(0)).attr("height",0).append("title"),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill-opacity",a.fill_opacity||.8),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.tooltip=n.tooltip,e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values(),t.select(this).attr(n.attributes)}),c.select("title").text(function(e){var n=e.tooltip||"",r=t.format("percent"===a.x.summary?"0%":a.x.format),i=t.format("percent"===a.y.summary?"0%":a.y.format);return n.replace(/\$x/g,r(e.values.x)).replace(/\$y/g,i(e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values.raw[0][n]})}),c.transition().attr("x",function(t){var e=void 0;if(t.arrange&&"stacked"!==t.arrange){if("nested"===t.arrange){e=t.subcats.indexOf(t.key);var r=e?n.x.rangeBand()/(t.subcats.length*e*.5)/2:n.x.rangeBand()/2;return n.x(t.values.x)+n.x.rangeBand()/2-r}return e=t.subcats.indexOf(t.key),n.x(t.values.x)+n.x.rangeBand()/t.subcats.length*e}return n.x(t.values.x)}).attr("y",function(t){return n.y("stacked"!==t.arrange?t.values.y:t.values.start)}).attr("width",function(t){if("stacked"===t.arrange)return n.x.rangeBand();if("nested"===t.arrange){var e=t.subcats.indexOf(t.key);return e?n.x.rangeBand()/(t.subcats.length*e*.5):n.x.rangeBand()}return n.x.rangeBand()/t.subcats.length}).attr("height",function(t){return n.y(0)-n.y(t.values.y)})):"ordinal"===a.y.type?(s.selectAll(".bar").transition().attr("x",this.x(0)).attr("width",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("x",this.x(0)).attr("width",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("x",this.x(0)).attr("width",0),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill-opacity",a.fill_opacity||.8),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values()}),c.transition().attr("x",function(t){return n.x("stacked"===t.arrange?t.values.start:0)}).attr("y",function(t){if("grouped"!==t.arrange)return n.y(t.values.y);var e=t.subcats.indexOf(t.key);return n.y(t.values.y)+n.y.rangeBand()/t.subcats.length*e}).attr("width",function(t){return n.x(t.values.x)}).attr("height",function(t){if("quantile"===a.y.type)return 20;if("stacked"===t.arrange)return n.y.rangeBand();if("nested"===t.arrange){var e=t.subcats.indexOf(t.key);return e?n.y.rangeBand()/(sibs.length*e*.75):n.y.rangeBand()}return n.y.rangeBand()/t.subcats.length})):"linear"===a.x.type&&a.x.bin?(s.selectAll(".bar").transition().attr("y",this.y(0)).attr("height",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("y",this.y(0)).attr("height",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("y",this.y(0)).attr("height",0),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill-opacity",a.fill_opacity||.8),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values(),t.select(this).attr(n.attributes);var a=t.select(this.parentNode).datum(),i=a.key.split(",").map(function(t){return+t});e.rangeLow=t.min(i),e.rangeHigh=t.max(i)}),c.transition().attr("x",function(t){return n.x(t.rangeLow)}).attr("y",function(t){return n.y("stacked"!==t.arrange?t.values.y:t.values.start)}).attr("width",function(t){return n.x(t.rangeHigh)-n.x(t.rangeLow)}).attr("height",function(t){return n.y(0)-n.y(t.values.y)})):"linear"===a.y.type&&a.y.bin?(s.selectAll(".bar").transition().attr("x",this.x(0)).attr("width",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("x",this.x(0)).attr("width",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+this.id+")").attr("x",this.x(0)).attr("width",0),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill-opacity",a.fill_opacity||.8),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values();var a=t.select(this.parentNode).datum(),i=a.key.split(",").map(function(t){return+t});e.rangeLow=t.min(i),e.rangeHigh=t.max(i)}),c.transition().attr("x",function(t){return n.x("stacked"===t.arrange?t.values.start:0)}).attr("y",function(t){return n.y(t.rangeHigh)}).attr("width",function(t){return n.x(t.values.x)}).attr("height",function(t){return n.y(t.rangeLow)-n.y(t.rangeHigh)})):(s.selectAll(".bar").transition().attr("y",this.y(0)).attr("height",0),s.transition().remove(),i.remove())}function u(){this.wrap.classed("gridlines",this.config.gridlines),this.config.gridlines?(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0),("y"===this.config.gridlines||"xy"===this.config.gridlines)&&this.svg.select(".y.axis").selectAll(".tick line").attr("x1",this.plot_width),("x"===this.config.gridlines||"xy"===this.config.gridlines)&&this.svg.select(".x.axis").selectAll(".tick line").attr("y1",-this.plot_height)):(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0))}function d(e){var n=this,r=this.config,a=t.svg.line().interpolate(r.interpolate).x(function(t){return"linear"===r.x.type?n.x(+t.values.x):"time"===r.x.type?n.x(new Date(t.values.x)):n.x(t.values.x)+n.x.rangeBand()/2}).y(function(t){return"linear"===r.y.type?n.y(+t.values.y):"time"===r.y.type?n.y(new Date(t.values.y)):n.y(t.values.y)+n.y.rangeBand()/2}),i=this.svg.selectAll(".line-supergroup").data(e,function(t){return t.per.join("-")});i.enter().append("g").attr("class","line-supergroup"),i.exit().remove();var o=i.selectAll(".line").data(function(t){return t.data},function(t){return t.key});o.exit().remove();var s=o.enter().append("g").attr("class",function(t){return t.key+" line"});return s.append("path"),s.append("title"),o.select("path").attr("class","wc-data-mark").datum(function(t){return t.values}).attr("stroke",function(t){return n.colorScale(t[0].values.raw[0][r.color_by])}).attr("stroke-width",r.stroke_width?r.stroke_width:r.flex_stroke_width).attr("stroke-linecap","round").attr("fill","none").transition().attr("d",a),o.each(function(e){var n=t.select(this.parentNode).datum();e.tooltip=n.tooltip,t.select(this).select("path").attr(n.attributes)}),o.select("title").text(function(e){var n=e.tooltip||"",a=t.format("percent"===r.x.summary?"0%":r.x.format),i=t.format("percent"===r.y.summary?"0%":r.y.format);return n.replace(/\$x/g,a(e.values.x)).replace(/\$y/g,i(e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values[0].values.raw[0][n]})}),o}function f(e){var n=this,r=this.config,a=this.svg.selectAll(".point-supergroup").data(e,function(t){return t.per.join("-")});a.enter().append("g").attr("class","point-supergroup"),a.exit().remove();var i=a.selectAll(".point").data(function(t){return t.data},function(t){return t.key}),o=i.exit();o.selectAll("circle").transition().attr("r",0),o.transition().remove();var s=i.enter().append("g").attr("class",function(t){return t.key+" point"});return s.append("circle").attr("class","wc-data-mark").attr("r",0),s.append("title"),i.select("circle").attr("fill-opacity",r.fill_opacity||0===r.fill_opacity?r.fill_opacity:.6).attr("fill",function(t){return n.colorScale(t.values.raw[0][r.color_by])}).attr("stroke",function(t){return n.colorScale(t.values.raw[0][r.color_by])}).transition().attr("r",r.point_size?r.point_size:r.flex_point_size).attr("cx",function(t){var e=n.x(t.values.x)||0;return"ordinal"===n.x.type?e+n.x.rangeBand()/2:e}).attr("cy",function(t){var e=n.y(t.values.y)||0;return"ordinal"===r.y.type?e+n.y.rangeBand()/2:e}),i.each(function(e){var n=t.select(this.parentNode).datum();e.tooltip=n.tooltip,t.select(this).select("circle").attr(n.attributes)}),i.select("title").text(function(e){var n=e.tooltip||"",a=t.format("percent"===r.x.summary?"0%":r.x.format),i=t.format("percent"===r.y.summary?"0%":r.y.format);return n.replace(/\$x/g,a(e.values.x)).replace(/\$y/g,i(e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values.raw[0][n]})}),i}function p(e){{var n=this;this.config}t.select(this.div).select(".loader").empty()&&t.select(this.div).insert("div",":first-child").attr("class","loader").selectAll(".blockG").data(t.range(8)).enter().append("div").attr("class",function(t){return"blockG rotate"+(t+1)}),this.wrap.attr("class","wc-chart"),this.setDefaults();var r=function(t){n.controls&&(n.controls.targets.push(n),n.controls.ready?n.controls.layout():n.controls.init(t)),n.raw_data=t;var e=window.$?$(n.div).is(":visible"):!0;if(e)n.layout(),n.wrap.datum(n),n.draw();else var r=setInterval(function(e){var a=$(n.div).is(":visible");if(a){n.layout(),n.wrap.datum(n);var i=n.transformData(t);n.draw(i),clearInterval(r)}},500)};return this.filepath&&!e?t.csv(this.filepath,function(t,e){n.raw_data=e,n.onDataError(t),n.checkRequired(e),r(e)}):r(e),this}function h(){this.svg=this.wrap.append("svg").attr({"class":"wc-svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink"}).append("g");var e=this.svg.append("defs");e.append("pattern").attr({id:"diagonal-stripes",x:0,y:0,width:3,height:8,patternUnits:"userSpaceOnUse",patternTransform:"rotate(30)"}).append("rect").attr({x:"0",y:"0",width:"2",height:"8",style:"stroke:none; fill:black"}),e.append("clipPath").attr("id",this.id).append("rect").attr("class","plotting-area"),this.svg.append("g").attr("class","y axis").append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("dy",".75em").attr("text-anchor","middle"),this.svg.append("g").attr("class","x axis").append("text").attr("class","axis-title").attr("dy","-.35em").attr("text-anchor","middle"),this.svg.append("rect").attr("class","overlay").attr("opacity",0).attr("fill","none").style("pointer-events","all"),this.wrap.append("ul").attr("class","legend").append("span").attr("class","legend-title"),t.select(this.div).select(".loader").remove(),this.events.onLayout.call(this)}function g(){var e=arguments.length<=0||void 0===arguments[0]?this.colorScale:arguments[0],n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=this.config;a.legend.mark=a.legend.mark?a.legend.mark:a.marks.length&&"bar"===a.marks[0].type?"square":a.marks.length?a.marks[0].type:"square";var i=n?n:"string"==typeof a.legend.label?a.legend.label:"",o=this.legend||this.wrap.select(".legend"),s=r||e.domain().slice(0).filter(function(t){return void 0!==t&&null!==t}).map(function(t){return{label:t,mark:a.legend.mark}});o.select(".legend-title").text(i).style("display",i?"inline":"none");var l=o.selectAll(".legend-item").data(s,function(t){return t.label+t.mark});l.exit().remove();var c=l.enter().append("li").attr("class","legend-item");c.append("span").attr("class","legend-mark-text").style("color",function(t){return e(t.label)}),c.append("svg").attr("class","legend-color-block").attr("width","1.1em").attr("height","1.1em"),a.legend.order&&l.sort(function(e,n){return t.ascending(a.legend.order.indexOf(e.label),a.legend.order.indexOf(n.label))}),l.selectAll(".legend-color-block").select(".legend-mark").remove(),l.selectAll(".legend-color-block").each(function(e){var n=t.select(this);"circle"===e.mark?n.append("circle").attr({cx:".5em",cy:".45em",r:".45em","class":"legend-mark"}):"line"===e.mark?n.append("line").attr({x1:0,y1:".5em",x2:"1em",y2:".5em","stroke-width":2,"shape-rendering":"crispEdges","class":"legend-mark"}):"square"===e.mark&&n.append("rect").attr({height:"1em",width:"1em","class":"legend-mark"})}),l.selectAll(".legend-color-block").select(".legend-mark").attr("fill",function(t){return t.color||e(t.label)}).attr("stroke",function(t){return t.color||e(t.label)}).each(function(e){t.select(this).attr(e.attributes)}),c.append("span").attr("class","legend-label").text(function(t){return t.label}),e.domain().length>1?o.style("display","block"):o.style("display","none"),this.legend=o}function m(t,e,n,r,a){t&&this.svg.selectAll("."+t+".axis .tick text").attr({transform:"rotate("+r+")",dx:e,dy:n}).style("text-anchor",a||"start")}function y(e){if(e)throw t.select(this.div).select(".loader").remove(),this.wrap.append("div").style("color","red").text("Dataset could not be loaded."),new Error("Dataset could not be loaded. Check provided path ("+this.filepath+").")}function v(){var e=this.config,n=1/e.aspect,r=parseInt(this.wrap.style("width")),a=e.max_width?e.max_width:r,i=e.resizable?!a||a>r?r:this.raw_width:e.width;this.textSize(i),this.margin=this.setMargins();var o="ordinal"===e.x.type&&+e.range_band?this.raw_width+this.margin.left+this.margin.right:e.resizable&&(!e.max_width||r<e.max_width)?r:this.raw_width;this.plot_width=o-this.margin.left-this.margin.right;var s="ordinal"===e.y.type&&+e.range_band?this.raw_height+this.margin.top+this.margin.bottom:!e.resizable&&e.height?e.height:e.resizable?this.plot_width*n:o*n;this.plot_height=s-this.margin.top-this.margin.bottom,t.select(this.svg.node().parentNode).attr("width",o).attr("height",s).select("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.select(".overlay").attr("width",this.plot_width).attr("height",this.plot_height).classed("zoomable",e.zoomable),this.svg.select(".plotting-area").attr("width",this.plot_width).attr("height",this.plot_height+1).attr("transform","translate(0, -1)"),this.xScaleAxis(),this.yScaleAxis();var l=this.svg.select(".x.axis"),c=this.svg.select(".y.axis"),u=l.select(".axis-title"),d=c.select(".axis-title");"top"!==e.x_location&&l.attr("transform","translate(0,"+this.plot_height+")"),l.transition().call(this.xAxis),c.transition().call(this.yAxis),u.attr("transform","translate("+this.plot_width/2+","+(this.margin.bottom-2)+")"),d.attr("x",-1*this.plot_height/2).attr("y",-1*this.margin.left),this.drawGridlines(),this.makeLegend(),this.updateDataMarks(),this.events.onResize.call(this)}function x(){var e=this.config,n="flex"===e.legend.behavior?this.filtered_data:this.raw_data,r=e.color_dom||t.set(n.map(function(t){return t[e.color_by]})).values().filter(function(t){return t&&"undefined"!==t});r=r.sort(e.legend.order?function(n,r){return t.ascending(e.legend.order.indexOf(n),e.legend.order.indexOf(r))}:Q.dataOps.naturalSorter),this.colorScale=t.scale.ordinal().domain(r).range(e.colors)}function b(){this.config.x=this.config.x||{},this.config.y=this.config.y||{},this.config.x.label=void 0!==this.config.x.label?this.config.x.label:this.config.x.column,this.config.y.label=void 0!==this.config.y.label?this.config.y.label:this.config.y.column,this.config.x.sort=this.config.x.sort||"alphabetical-ascending",this.config.y.sort=this.config.y.sort||"alphabetical-descending",this.config.x.type=this.config.x.type||"linear",this.config.y.type=this.config.y.type||"linear",this.config.margin=this.config.margin||{},this.config.legend=this.config.legend||{},this.config.legend.label=void 0!==this.config.legend.label?this.config.legend.label:this.config.color_by,this.config.marks=this.config.marks&&this.config.marks.length?this.config.marks:[{}],this.config.date_format=this.config.date_format||"%x",this.config.padding=void 0!==this.config.padding?this.config.padding:.3,this.config.outer_pad=void 0!==this.config.outer_pad?this.config.outer_pad:.1,this.config.resizable=void 0!==this.config.resizable?this.config.resizable:!0,this.config.aspect=this.config.aspect||1.33,this.config.colors=this.config.colors||["rgb(102,194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],this.config.scale_text=void 0===this.config.scale_text?!0:this.config.scale_text}function w(){var e=this,n=(this.xAxis.tickFormat()?this.x.domain().map(function(t){return e.xAxis.tickFormat()(t)}):this.x.domain(),this.yAxis.tickFormat()?this.y.domain().map(function(t){return e.yAxis.tickFormat()(t)}):this.y.domain()),r=t.max(n.map(function(t){return String(t).length}));this.config.y_format&&this.config.y_format.indexOf("%")>-1&&(r+=1),r=Math.max(2,r);var a=this.config.x.label?1.5:0,i=this.config.y.label?1.5:.25,o=parseInt(this.wrap.style("font-size")),s=this.config.x2_interval?1:0,l=r*o*.5+o*i*1.5||8,c=o+o/1.5+o*a+o*s||8;return l+=6,c+=3,{top:this.config.margin&&this.config.margin.top?this.config.margin.top:8,right:this.config.margin&&this.config.margin.right?this.config.margin.right:16,bottom:this.config.margin&&this.config.margin.bottom?this.config.margin.bottom:c,left:this.config.margin&&this.config.margin.left?this.config.margin.left:l}}function _(t){var e="14px",n=4,r=2;this.config.scale_text?t>=600?(e="14px",n=4,r=2):t>450&&600>t?(e="12px",n=3,r=2):t>300&&450>t?(e="10px",n=2,r=2):300>=t&&(e="10px",n=2,r=1):(e=this.config.font_size,n=this.config.point_size||4,r=this.config.stroke_width||2),this.wrap.style("font-size",e),this.config.flex_point_size=n,this.config.flex_stroke_width=r}function k(e,n){function r(e,r){var i=[],s=[],l=t.nest();"linear"===o.x.type&&o.x.bin||"linear"===o.y.type&&o.y.bin?!function(){var n="linear"===o.x.type&&o.x.bin?"x":"y",r=t.scale.quantile().domain(t.extent(e.map(function(t){return+t[o[n].column]}))).range(t.range(+o[n].bin));e.forEach(function(t){return t.wc_bin=r(t[o[n].column])}),l.key(function(t){return r.invertExtent(t.wc_bin)})}():l.key(function(t){return n.per.map(function(e){return t[e]}).join(" ")}),r&&(l.key(function(t){return t[r]}),l.sortKeys(function(e,n){return"time"===o.x.type?t.ascending(new Date(e),new Date(n)):o.x_dom?t.ascending(o.x_dom.indexOf(e),o.x_dom.indexOf(n)):r===o.color_by&&o.legend.order?t.ascending(o.legend.order.indexOf(e),o.legend.order.indexOf(n)):"ordinal"===o.x.type||"ordinal"===o.y.type?Q.dataOps.naturalSorter(e,n):t.ascending(+e,+n)})),l.rollup(function(r){var a={raw:r},l=r.map(function(t){return t[o.y.column]}).sort(t.ascending),c=r.map(function(t){return t[o.x.column]}).sort(t.ascending);if(a.x="ordinal"===o.x.type?r[0][o.x.column]:Q.dataOps.summarize(c,o.x.summary),a.y="ordinal"===o.y.type?r[0][o.y.column]:Q.dataOps.summarize(l,o.y.summary),a.x_q25=o.error_bars&&"ordinal"===o.y.type?t.quantile(c,.25):a.x,a.x_q75=o.error_bars&&"ordinal"===o.y.type?t.quantile(c,.75):a.x,a.y_q25=o.error_bars?t.quantile(l,.25):a.y,a.y_q75=o.error_bars?t.quantile(l,.75):a.y,i.push([a.x_q25,a.x_q75,a.x]),s.push([a.y_q25,a.y_q75,a.y]),"cumulative"===o.y.summary){var u=e.filter(function(t){return"time"===o.x.type?new Date(t[o.x.column])<=new Date(r[0][o.x.column]):+t[o.x.column]<=+r[0][o.x.column]});n.per.length&&(u=u.filter(function(t){return t[n.per[0]]===r[0][n.per[0]]}));var d="time"===o.x.type?u.length:t.sum(u.map(function(t){return+t[o.y.column]||0===+t[o.y.column]?+t[o.y.column]:1}));s.push([d]),a.y=d}if("cumulative"===o.x.summary){var u=e.filter(function(t){return"time"===o.y.type?new Date(t[o.y.column])<=new Date(r[0][o.y.column]):+t[o.y.column]<=+r[0][o.y.column]});n.per.length&&(u=u.filter(function(t){return t[n.per[0]]===r[0][n.per[0]]})),i.push([u.length]),a.x=u.length}return a});var c=l.entries(e),u=t.extent(t.merge(i)),f=t.extent(t.merge(s));return r&&"bar"===n.type&&"stacked"===n.arrange&&(c.forEach(a),("ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin)&&(f=t.extent(c.map(function(t){return t.total}))),("ordinal"===o.y.type||"linear"===o.y.type&&o.y.bin)&&(u=t.extent(c.map(function(t){return t.total})))),"total-ascending"===o.x.sort||"total-ascending"===o.y.sort?d=c.sort(function(e,n){return t.ascending(e.total,n.total)}).map(function(t){return t.key}):("total-descending"===o.x.sort||"total-descending"===o.y.sort)&&(d=c.sort(function(e,n){return t.ascending(e.total,n.total)}).map(function(t){return t.key}).reverse()),{nested:c,dom_x:u,dom_y:f}}function a(e){var n="ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin?"y":"x";e.total=t.sum(e.values.map(function(t){return+t.values[n]}));var r=0;e.values.forEach(function(t,n){"ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin?(t.values.y="percent"===o.y.summary?t.values.y/e.total:t.values.y||0,r+=+t.values.y,t.values.start=e.values[n-1]?r:t.values.y):(t.values.x="percent"===o.x.summary?t.values.x/e.total:t.values.x||0,t.values.start=r,r+=+t.values.x)})}var i=this,o=this.config,s=o.x.behavior||"raw",l=o.y.behavior||"raw",c="line"===n.type?o.x.column:"bar"===n.type&&n.split?n.split:null,u=t.time.format(o.date_format),d=void 0;e=n.per&&n.per.length?e.filter(function(t){return t[n.per[0]]}):e,o.initial_filter&&(e=e.filter(function(t){return-1!==o.initial_filter.vals.indexOf(t[o.initial_filter.col])})),o.x.column&&(e=e.filter(function(t){return t[o.x.column]})),o.y.column&&(e=e.filter(function(t){return t[o.y.column]})),"time"===o.x.type&&(e=e.filter(function(t){return t[o.x.column]instanceof Date?t[o.x.column]:u.parse(t[o.x.column])}),e.forEach(function(t){return t[o.x.column]=t[o.x.column]instanceof Date?t[o.x.column]:u.parse(t[o.x.column])})),"time"===o.y.type&&(e=e.filter(function(t){return t[o.y.column]instanceof Date?t[o.y.column]:u.parse(t[o.y.column])}),e.forEach(function(t){return t[o.y.column]=t[o.y.column]instanceof Date?t[o.y.column]:u.parse(t[o.y.column])})),"linear"!==o.x.type&&"log"!==o.x.type||!o.x.column||(e=e.filter(function(t){return"count"!==o.x.summary&&"percent"!==o.x.summary?+t[o.x.column]||0===+t[o.x.column]:t})),"linear"!==o.y.type&&"log"!==o.y.type||!o.y.column||(e=e.filter(function(t){return"count"!==o.y.summary&&"percent"!==o.y.summary?+t[o.y.column]||0===+t[o.y.column]:t}));var f=void 0;"bar"===n.type?f="stacked"!==n.arrange?r(e,c):r(e):("count"===o.x.summary||"count"===o.y.summary)&&(f=r(e));var p="cumulative"===o.x.summary?[0,e.length]:"ordinal"===o.x.type?t.set(e.map(function(t){return t[o.x.column]})).values().filter(function(t){return t}):t.extent(n.split&&"stacked"!==n.arrange?t.merge(f.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})})):"count"===o.x.summary?f.nested.map(function(t){return t.values.raw.length}):e.map(function(t){return+t[o.x.column]}).filter(function(t){return+t})),h="cumulative"===o.y.summary?[0,e.length]:"ordinal"===o.y.type?t.set(e.map(function(t){return t[o.y.column]})).values().filter(function(t){return t}):t.extent(n.split&&"stacked"!==n.arrange?t.merge(f.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})})):"count"===o.y.summary?f.nested.map(function(t){return t.values.raw.length}):e.map(function(t){return+t[o.y.column]}).filter(function(t){return+t||0===+t})),g=e,m=[],y=[];this.filters.length&&(this.filters.forEach(function(t){g=g.filter(function(e){return"All"===t.val?e:t.val instanceof Array?t.val.indexOf(e[t.col])>-1:e[t.col]===t.val})}),("firstfilter"===o.x.behavior||"firstfilter"===o.y.behavior)&&this.filters[0].choices.filter(function(t){return"All"!==t}).forEach(function(t){var n=e.filter(function(e){return e[i.filters[0].col]===t}),a=r(n,c);m.push(a.dom_x),y.push(a.dom_y)}));var v=t.extent(t.merge(m)),x=t.extent(t.merge(y));this.filtered_data=g;var b=r(g,c),w=b.dom_x,_=b.dom_y;"bar"===n.type&&("ordinal"===o.y.type&&"count"===o.x.summary?o.x.domain=o.x.domain?[0,o.x.domain[1]]:[0,null]:"ordinal"===o.x.type&&"count"===o.y.summary&&(o.y.domain=o.y.domain?[0,o.y.domain[1]]:[0,null]));var k=Boolean(this.filters.length&&"All"!==this.filters[0].val&&this.filters.slice(1).filter(function(t){return"All"===t.val}).length===this.filters.length-1),A=this.filters.length?"raw"===s?p:k&&"firstfilter"===s?v:w:w,O=this.filters.length?"raw"===l?h:k&&"firstfilter"===l?x:_:_,D=o.x_dom?o.x_dom:"ordinal"===o.x.type&&"flex"===o.x.behavior?t.set(g.map(function(t){return t[o.x.column]})).values():"ordinal"===o.x.type?t.set(e.map(function(t){return t[o.x.column]})).values():o.x_from0?[0,t.max(A)]:A,z=o.y_dom?o.y_dom:"ordinal"===o.y.type&&"flex"===o.y.behavior?t.set(g.map(function(t){return t[o.y.column]})).values():"ordinal"===o.y.type?t.set(e.map(function(t){return t[o.y.column]})).values():o.y_from0?[0,t.max(O)]:O;return o.x.domain&&(o.x.domain[0]||0===o.x.domain[0])&&(D[0]=o.x.domain[0]),o.x.domain&&(o.x.domain[1]||0===o.x.domain[1])&&(D[1]=o.x.domain[1]),o.y.domain&&(o.y.domain[0]||0===o.y.domain[0])&&(z[0]=o.y.domain[0]),
o.y.domain&&(o.y.domain[1]||0===o.y.domain[1])&&(z[1]=o.y.domain[1]),"ordinal"===o.x.type&&(o.x.order=d),"ordinal"===o.y.type&&(o.y.order=d),this.current_data=b.nested,this.events.onDatatransform.call(this),{data:b.nested,x_dom:D,y_dom:z}}function A(){this.drawPoints(this.marks.filter(function(t){return"circle"===t.type})),this.drawLines(this.marks.filter(function(t){return"line"===t.type})),this.drawBars(this.marks.filter(function(t){return"bar"===t.type}))}function O(e,n,r){void 0===e&&(e=this.plot_width),void 0===n&&(n=this.x_dom),void 0===r&&(r=this.config.x.type);var a=this.config,i=void 0;i="log"===r?t.scale.log():"ordinal"===r?t.scale.ordinal():"time"===r?t.time.scale():t.scale.linear(),i.domain(n),"ordinal"===r?i.rangeBands([0,+e],a.padding,a.outer_pad):i.range([0,+e]).clamp(Boolean(a.x.clamp));var o=a.x.format?a.x.format:"percent"===r?"0%":"time"===r?"%x":".0f",s=Math.max(2,Math.min(e/80,8)),l=t.svg.axis().scale(i).orient(a.x.location).ticks(s).tickFormat("ordinal"===r?null:"time"===r?t.time.format(o):t.format(o)).tickValues(a.x.ticks?a.x.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.x.axis").attr("class","x axis "+r),this.x=i,this.xAxis=l}function D(e,n,r){void 0===e&&(e=this.plot_height),void 0===n&&(n=this.y_dom),void 0===r&&(r=this.config.y.type);var a=this.config,i=void 0;i="log"===r?t.scale.log():"ordinal"===r?t.scale.ordinal():"time"===r?t.time.scale():t.scale.linear(),i.domain(n),"ordinal"===r?i.rangeBands([+e,0],a.padding,a.outer_pad):i.range([+e,0]).clamp(Boolean(a.y_clamp));var o=a.y.format?a.y.format:"percent"===a.y.summary?"0%":".0f",s=Math.max(2,Math.min(e/80,8)),l=t.svg.axis().scale(i).orient("left").ticks(s).tickFormat("ordinal"===r?null:"time"===r?t.time.format(o):t.format(o)).tickValues(a.y.ticks?a.y.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.y.axis").attr("class","y axis "+r),this.y=i,this.yAxis=l}function z(){var e=this,n=this,r=this.legend.selectAll(".legend-item");r.on("mouseover",function(e){var r=t.select(this).select(".legend-mark").attr("fill");n.svg.selectAll(".wc-data-mark").attr("opacity",.1).filter(function(e){return t.select(this).attr("fill")===r||t.select(this).attr("stroke")===r}).attr("opacity",1)}).on("mouseout",function(t){e.svg.selectAll(".wc-data-mark").attr("opacity",1)})}function S(t,e){var n=this,r=e.append("input").attr("type","checkbox").attr("class","changer").datum(t).property("checked",function(e){return-1!==t.option.indexOf(".")?n.targets[0].config[t.option.split(".")[0]][t.option.split(".")[1]]:n.targets[0].config[t.option]});r.on("change",function(t){var e=r.property("checked");n.changeOption(t.option,e)})}function E(t){this.data=t,this.config.builder||this.checkRequired(this.data),this.layout()}function C(e){var n=this,r=t.keys(e[0]);console.log("line 5??"),this.config.inputs&&this.config.inputs.forEach(function(t,e){if("subsetter"===t.type&&-1===r.indexOf(t.value_col))throw n.config.inputs=n.config.inputs.splice(controls[e],1),new Error('Error in settings object: the value "'+t.value_col+'" does not match any column in the provided dataset.')})}function q(t){var e=this.wrap.append("div").attr("class","control-group").classed("inline",t.inline).datum(t),n=e.append("span").attr("class","control-label").text(t.label);if(t.required&&n.append("span").attr("class","label label-required").text("Required"),e.append("span").attr("class","span-description").text(t.description),"text"===t.type)this.makeTextControl(t,e);else if("number"===t.type)this.makeNumberControl(t,e);else if("list"===t.type)this.makeListControl(t,e);else if("dropdown"===t.type)this.makeDropdownControl(t,e);else if("btngroup"===t.type)this.makeBtnGroupControl(t,e);else if("checkbox"===t.type)this.makeCheckboxControl(t,e);else if("radio"===t.type)this.makeRadioControl(t,e);else{if("subsetter"!==t.type)throw new Error('Each control must have a type! Choose from: "text", "number", "list", "dropdown", "btngroup", "checkbox", "radio", "subsetter"');this.makeSubsetterControl(t,e)}}function B(t,e){var n=this,r=e.append("input").attr("type","text").attr("class","changer").datum(t).property("value",function(e){return-1!==t.option.indexOf(".")?n.targets[0].config[t.option.split(".")[0]][t.option.split(".")[1]]:n.targets[0].config[t.option]});r.on("change",function(e){var a=r.property("value");n.changeOption(t.option,a)})}function j(t,e){var n=this,r=e.append("input").attr("type","text").attr("class","changer").datum(t).property("value",function(e){return-1!==t.option.indexOf(".")?n.targets[0].config[t.option.split(".")[0]][t.option.split(".")[1]]:n.targets[0].config[t.option]});r.on("change",function(e){var a=r.property("value")?r.property("value").split(",").map(function(t){return t.trim()}):null;n.changeOption(t.option,a)})}function N(t,e){var n=this,r=e.append("input").attr("type","number").attr("min",void 0!==t.min?t.min:0).attr("max",t.max).attr("step",t.step||1).attr("class","changer").datum(t).property("value",function(e){return-1!==t.option.indexOf(".")?n.targets[0].config[t.option.split(".")[0]][t.option.split(".")[1]]:n.targets[0].config[t.option]});r.on("change",function(e){var a=+r.property("value");n.changeOption(t.option,a)})}function L(e,n){var r=this,a=n.append("select").attr("class","changer").attr("multiple",e.multiple?!0:null).datum(e),i=e.values&&e.values instanceof Array?e.values:e.values?t.set(this.data.map(function(t){return t[r.targets[0].config[e.values]]})).values():t.keys(this.data[0]);(!e.require||e.none)&&i.unshift("None");var o=a.selectAll("option").data(i).enter().append("option").text(function(t){return t}).property("selected",function(t){return-1!==e.option.indexOf(".")?r.targets[0].config[e.option.split(".")[0]][e.option.split(".")[1]]===t:r.targets[0].config[e.option]===t});return a.on("change",function(n){var i="None"===a.property("value")?null:a.property("value");e.multiple&&(i=o.filter(function(e){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("value")}).filter(function(t){return"None"!==t})),r.changeOption(e.option,i)}),a}function T(e,n){var r=this,a=e.values?e.values:t.keys(this.data[0]),i=n.append("div").attr("class","btn-group"),o=i.selectAll("button").data(a).enter().append("button").attr("class","btn btn-default btn-sm").text(function(t){return t}).classed("btn-primary",function(t){return-1!==e.option.indexOf(".")?r.targets[0].config[e.option.split(".")[0]][e.option.split(".")[1]]===t:r.targets[0].config[e.option]===t});o.on("click",function(n){o.each(function(e){t.select(this).classed("btn-primary",e===n)}),r.changeOption(e.option,n)})}function M(t,e){this.targets.forEach(function(n){-1!==t.indexOf(".")?n.config[t.split(".")[0]][t.split(".")[1]]=e:n.config[t]=e,n.draw()})}function R(e,n){var r=this,a=n.selectAll("label").data(e.values).enter().append("label").attr("class","radio").text(function(t,n){return e.relabels?e.relabels[n]:t}).append("input").attr("type","radio").attr("class","changer").attr("name",e.option.replace(".","-")+"-"+this.targets[0].id).property("value",function(t){return t}).property("checked",function(t){return-1!==e.option.indexOf(".")?r.targets[0].config[e.option.split(".")[0]][e.option.split(".")[1]]===t:r.targets[0].config[e.option]===t});a.on("change",function(n){var i=null;a.each(function(e){t.select(this).property("checked")&&(i="none"===t.select(this).property("value")?null:e)}),r.changeOption(e.option,i)})}function I(e,n){function r(t,e){var n=-1;t.filters.forEach(function(t,r){t.col===e.col&&(n=r)}),n>-1&&(t.filters[n]=e)}var a=this.targets,i=n.append("select").attr("class","changer").attr("multiple",e.multiple?!0:null).datum(e),o=e.values?e.values:t.set(this.data.map(function(t){return t[e.value_col]}).filter(function(t){return t})).values();o.sort(t.ascending),e.start=e.start?e.start:e.loose?o[0]:null,e.multiple||e.start||o.unshift("All"),e.loose=!e.loose&&e.start?!0:e.loose;var s=i.selectAll("option").data(o).enter().append("option").text(function(t){return t}).property("selected",function(t){return t===e.start});a.forEach(function(t){var n=t.filters.slice().map(function(t){return t.col===e.value_col}).indexOf(!0);n>-1?t.filters[n]={col:e.value_col,val:e.start?e.start:"All",choices:o,loose:e.loose}:t.filters.push({col:e.value_col,val:e.start?e.start:"All",choices:o,loose:e.loose})}),i.on("change",function(n){var i=this;e.multiple?!function(){var n=s.filter(function(e){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("value")}),i={col:e.value_col,val:n,choices:o,loose:e.loose};a.forEach(function(t){r(t,i),t.draw()})}():!function(){var n=t.select(i).property("value"),s={col:e.value_col,val:n,choices:o,loose:e.loose};a.forEach(function(t){r(t,s),t.draw()})}()})}function F(){var t=this;this.config.inputs&&this.config.inputs.length&&this.config.inputs[0]&&this.config.inputs.forEach(function(e){return t.makeControlItem(e)})}function G(){this.wrap.selectAll("*").remove(),this.ready=!0,this.controlUpdate()}function U(e,n){var r=n?n:this.raw_data,a=this.config,i=e||this.transformData(r);this.wrap.datum(i);var o=this.table,s=a.cols.length?a.cols:i.length?t.keys(i[0].values[0].raw):[];a.bootstrap?o.classed("table",!0):o.classed("table",!1);var l=i.length?a.headers&&a.headers.length?a.headers:s:[],c=o.select("thead").select("tr.headers"),u=c.selectAll("th").data(l);u.exit().remove(),u.enter().append("th"),u.text(function(t){return t});var d=o.selectAll("tbody").data(i,function(t){return t.key});if(d.exit().remove(),d.enter().append("tbody"),a.row_per){var f=a.row_per.slice(0).reverse();f.forEach(function(t){d.sort(function(e,n){return e.values[0].raw[t]-n.values[0].raw[t]})})}var p=d.selectAll("tr").data(function(t){return t.values});p.exit().remove(),p.enter().append("tr"),a.sort_rows&&!function(){var t=a.sort_rows.slice(0);t.unshift("0"),p.sort(function(e,n){for(var r=0;r<t.length&&e.raw[t[r]]==n.raw[t[r]];)r++;return e.raw[t[r]]<n.raw[t[r]]?-1:e.raw[t[r]]>n.raw[t[r]]?1:0})}();var h=p.selectAll("td").data(function(t){return t.cells.filter(function(t){return s.indexOf(t.col)>-1})});if(h.exit().remove(),h.enter().append("td"),h.attr("class",function(t){return t.col}),a.as_html?h.html(function(t){return t.text}):h.text(function(t){return t.text}),a.row_per&&p.filter(function(t,e){return e>0}).selectAll("td").filter(function(t){return a.row_per.indexOf(t.col)>-1}).text(""),a.data_tables){if(!jQuery()||!jQuery().dataTable)throw new Error("dataTables jQuery plugin not available");var g=a.data_tables;g.searching=a.searchable?a.searchable:!1,$(o.node()).dataTable(g);var m=$(".print-btn",wrap.node());m.addClass("pull-right"),$(".dataTables_wrapper").prepend(m)}this.events.onDraw(this)}function H(e){if(e){var n=this.config,r=n.cols||t.keys(e[0]);n.keep&&n.keep.forEach(function(t){-1===r.indexOf(t)&&r.unshift(t)}),this.config.cols=r;var a=e;this.filters.length&&this.filters.forEach(function(t){var e=t.val instanceof Array;a=a.filter(function(n){return e?-1!==t.val.indexOf(n[t.col]):"All"!==t.val?n[t.col]===t.val:n})});var i=t.nest().key(function(t){return n.row_per?n.row_per.map(function(e){return t[e]}).join(" "):t}).rollup(function(t){n.dataManipulate&&(t=n.dataManipulate(t));var e=t.map(function(t){var e=[];for(var r in t)e.push({col:r,text:t[r]});return e.sort(function(t,e){return n.cols.indexOf(t.col)-n.cols.indexOf(e.col)}),{cells:e,raw:t}});return e}).entries(a);return this.current_data=i,this.events.onDatatransform(this),this.current_data}}function P(){t.select(this.div).select(".loader").remove();var e=this.wrap.append("table");e.append("thead").append("tr").attr("class","headers"),this.table=e,this.events.onLayout(this)}var Q={version:"0.2"};Q.multiply=function(e,n,r){function a(a){var o=t.set(a.map(function(t){return t[n]})).values().filter(function(t){return t});r&&(o=o.sort(function(e,n){return t.ascending(r.indexOf(e),r.indexOf(n))})),o.forEach(function(t){var r=(a.filter(function(e){return e[n]===t}),Q.chart(e.wrap.node(),null,i,e.controls));r.events=e.events,r.legend=s,r.filters.unshift({col:n,val:t,choices:o}),r.wrap.insert("span","svg").attr("class","wc-chart-title").text(t),r.init(a)})}var i=e.config,o=e.wrap.classed("wc-layout wc-small-multiples",!0).classed("wc-chart",!1),s=o.append("ul").attr("class","legend");t.csv(e.filepath,function(t,n){e.raw_data=n,e.onDataError(t),e.checkRequired(n),a(n)})},Q.dataOps={getValType:a,lengthenRaw:e,naturalSorter:n,summarize:r};var V={raw_data:[],config:{}};Object.defineProperties(V,{adjustTicks:{value:m},checkRequired:{value:i},consolidateData:{value:o},draw:{value:s},drawArea:{value:l},drawBars:{value:c},drawGridlines:{value:u},drawLines:{value:d},drawPoints:{value:f},highlightMarks:{value:z},init:{value:p},layout:{value:h},makeLegend:{value:g},onDataError:{value:y},resize:{value:v},setColorScale:{value:x},setDefaults:{value:b},setMargins:{value:w},textSize:{value:_},transformData:{value:k},updateDataMarks:{value:A},xScaleAxis:{value:O},yScaleAxis:{value:D}}),Q.chartCount=0,Q.chart=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=arguments.length<=3||void 0===arguments[3]?null:arguments[3],i=Object.create(V);return i.div=e,i.filepath=n,i.config=Object.create(r),i.controls=a,i.raw_data=[],i.filters=[],i.marks=[],i.wrap=t.select(i.div).append("div"),i.events={onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},i.on=function(t,e){var n=["layout","datatransform","draw","resize"];n.indexOf(t)<0||e&&(i.events["on"+t.charAt(0).toUpperCase()+t.slice(1)]=e)},Q.chartCount++,i.id=Q.chartCount,i};var K={changeOption:M,checkRequired:C,controlUpdate:F,init:E,layout:G,makeControlItem:q,makeBtnGroupControl:T,makeCheckboxControl:S,makeDropdownControl:L,makeListControl:j,makeNumberControl:N,makeRadioControl:R,makeSubsetterControl:I,makeTextControl:B};Q.controls=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=(arguments.length<=3||void 0===arguments[3]?{resizable:!0,max_width:800}:arguments[3],Object.create(K));return a.div=e,a.data=n,a.config=Object.create(r),a.config.inputs=a.config.inputs||[],a.targets=[],a.wrap="bottom"===r.location?t.select(e).append("div").attr("class","wc-controls"):t.select(e).insert("div",":first-child").attr("class","wc-controls"),a};var J=Object.create(V);return Object.defineProperties(J,{layout:{value:P},transformData:{value:H},draw:{value:U}}),Q.table=function(e,n,r,a){void 0===e&&(e="body"),void 0===r&&(r={});var i=Object.create(J);return i.div=e,i.filepath=n,i.config=Object.create(r),i.controls=a,i.filters=[],i.required_cols=[],i.marks=[],i.wrap=t.select(i.div).append("div"),i.events={onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},i.on=function(t,e){var n=["layout","datatransform","draw","resize"];n.indexOf(t)<0||e&&(i.events["on"+t.charAt(0).toUpperCase()+t.slice(1)]=e)},i},Q.objects={chart:V,table:J,controls:K},Q});