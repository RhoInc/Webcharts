!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof module&&module.exports?module.exports=e(require("d3")):t.webCharts=e(t.d3)}(this,function(t){function e(e,n){var r=t.set(e.map(function(t){return t[n]})).values(),a=r.filter(function(t){return+t||0===+t});return r.length===a.length&&r.length>4?"continuous":"categorical"}function n(t,e){var n=[];return t.forEach(function(t){e.forEach(function(e){var r=Object.create(t);r.wc_category=e,r.wc_value=t[e],n.push(r)})}),n}function r(t,e){function n(t){for(var e=[],n=0,r=-1,a=0,i=void 0,o=void 0;i=(o=t.charAt(n++)).charCodeAt(0);){var s=46==i||i>=48&&57>=i;s!==a&&(e[++r]="",a=s),e[r]+=o}return e}for(var r=n(t.toLowerCase()),a=n(e.toLowerCase()),i=0;r[i]&&a[i];i++)if(r[i]!==a[i]){var o=Number(r[i]),s=Number(a[i]);return o==r[i]&&s==a[i]?o-s:r[i]>a[i]?1:-1}return r.length-a.length}function a(e,n){var r=e.filter(function(t){return+t||0===+t}).map(function(t){return+t});if("cumulative"===n)return null;var a=n||"mean",i="count"===a?e.length:"percent"===a?e.length:t[a](r);return i}function i(e){var n=this,r=t.keys(e[0]),a=[],i=[];this.config.x.column&&(a.push("this.config.x.column"),i.push(this.config.x.column)),this.config.y.column&&(a.push("this.config.y.column"),i.push(this.config.y.column)),this.config.color_by&&(a.push("this.config.color_by"),i.push(this.config.color_by)),this.config.marks.forEach(function(t,e){t.per&&t.per.length&&t.per.forEach(function(t,n){a.push("this.config.marks["+e+"].per["+n+"]"),i.push(t)}),t.split&&(a.push("this.config.marks["+e+"].split"),i.push(t.split))}),i.forEach(function(e,i){if(r.indexOf(e)<0)throw t.select(n.div).select(".loader").remove(),n.wrap.append("div").style("color","red").html('The value "'+e+'" for the <code>'+a[i]+"</code> setting does not match any column in the provided dataset."),new Error('Error in settings object: The value "'+e+'" for the '+a[i]+" setting does not match any column in the provided dataset.")})}function o(e){var n=this,r=this.config,a=[],i=[],o=[];this.setDefaults(),r.marks.forEach(function(t,r){"bar"!==t.type&&(t.arrange=null,t.split=null);var s=t.per?n.transformData(e,t):{data:[],x_dom:[],y_dom:[]};a.push(s.data),i.push(s.x_dom),o.push(s.y_dom),n.marks[r]=Object.create(t),n.marks[r].data=s.data}),this.x_dom="ordinal"===r.x.type?r.x.sort&&"alphabetical-ascending"===r.x.sort?t.set(t.merge(i)).values().sort(G.dataOps.naturalSorter):"time"===r.y.type&&"earliest"===r.x.sort?t.nest().key(function(t){return t[r.x.column]}).rollup(function(t){return t.map(function(t){return t[r.y.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,n){return t.min(n.values)-t.min(e.values)}).map(function(t){return t.key}):r.x.order?t.set(t.merge(i)).values().sort(function(e,n){return t.ascending(r.x.order.indexOf(e),r.x.order.indexOf(n))}):r.x.sort&&"alphabetical-descending"!==r.x.sort?t.set(t.merge(i)).values():t.set(t.merge(i)).values().sort(G.dataOps.naturalSorter):r.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?[0,1]:t.extent(t.merge(i)),this.y_dom="ordinal"===r.y.type?r.y.sort&&"alphabetical-ascending"===r.y.sort?t.set(t.merge(o)).values().sort(G.dataOps.naturalSorter):"time"===r.x.type&&"earliest"===r.y.sort?t.nest().key(function(t){return t[r.y.column]}).rollup(function(t){return t.map(function(t){return t[r.x.column]}).filter(function(t){return t instanceof Date})}).entries(this.raw_data).sort(function(e,n){return t.min(n.values)-t.min(e.values)}).map(function(t){return t.key}):r.y.order?t.set(t.merge(o)).values().sort(function(e,n){return t.ascending(r.y.order.indexOf(e),r.y.order.indexOf(n))}):r.y.sort&&"alphabetical-descending"!==r.y.sort?t.set(t.merge(o)).values():t.set(t.merge(o)).values().sort(G.dataOps.naturalSorter).reverse():r.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?[0,1]:t.extent(t.merge(o))}function s(e,n){var r=this,a=this,i=e?e:this.raw_data?this.raw_data:[],o=this.config,s=1/o.aspect,l=n||this.consolidateData(i);this.wrap.datum(l);var c=parseInt(this.wrap.style("width"));this.setColorScale();var u=o.max_width?o.max_width:c;this.raw_width="ordinal"===o.x.type&&+o.range_band?(+o.range_band+o.range_band*o.padding)*this.x_dom.length:o.resizable?u:o.width?o.width:c,this.raw_height="ordinal"===o.y.type&&+o.range_band?(+o.range_band+o.range_band*o.padding)*this.y_dom.length:o.resizable?u*s:o.height?o.height:c*s;var f=this.svg.select(".overlay").attr("width")?this.svg.select(".overlay").attr("width"):this.raw_width,d=this.svg.select(".overlay").attr("height")?this.svg.select(".overlay").attr("height"):this.raw_height;this.svg.select(".x.axis").select(".axis-title").text(function(t){return"string"==typeof o.x.label?o.x.label:"function"==typeof o.x.label?o.x.label.call(r):null}),this.svg.select(".y.axis").select(".axis-title").text(function(t){return"string"==typeof o.y.label?o.y.label:"function"==typeof o.y.label?o.y.label.call(r):null}),this.xScaleAxis(f),this.yScaleAxis(d),o.resizable?t.select(window).on("resize."+a.element+a.id,function(){a.resize()}):t.select(window).on("resize."+a.element+a.id,null),this.events.onDraw.call(this),this.resize()}function l(t,e,n,r,a){void 0===r&&(r="chart-area");var i=this,o=arguments.length<=5||void 0===arguments[5]?function(t){return t}:arguments[5],s=this.svg.selectAll("."+r).data(e,a);return s.exit().remove(),s.enter().append("g").attr("class",function(t){return r+" "+t.key}).append("path"),s.select("path").datum(n).attr("fill",function(t){var e=o(t);return e?i.colorScale(e[i.config.color_by]):null}).attr("fill-opacity",this.config.fill_opacity||0===this.config.fill_opacity?this.config.fill_opacity:.3).transition().attr("d",t),s}function c(e){var n=this,r=this.raw_data,a=this.config,i=this.svg.selectAll(".bar-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});i.enter().append("g").attr("class","bar-supergroup"),i.exit().remove();var o=i.selectAll(".bar-group").data(function(t){return t.data},function(t){return t.key}),s=o.exit(),l=void 0,c=void 0;"ordinal"===a.x.type?!function(){s.selectAll(".bar").transition().attr("y",n.y(0)).attr("height",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("y",n.y(0)).attr("height",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+n.id+")").attr("y",n.y(0)).attr("height",0).append("title"),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.tooltip=n.tooltip,e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values(),t.select(this).attr(n.attributes)});var e=t.format(a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?"0%":a.x.format),i=t.format(a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?"0%":a.y.format);c.select("title").text(function(t){var n=t.tooltip||"";return n.replace(/\$x/g,e(t.values.x)).replace(/\$y/g,i(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})}),c.transition().attr("x",function(t){var e=void 0;if(t.arrange&&"stacked"!==t.arrange){if("nested"===t.arrange){e=t.subcats.indexOf(t.key);var r=e?n.x.rangeBand()/(t.subcats.length*e*.5)/2:n.x.rangeBand()/2;return n.x(t.values.x)+n.x.rangeBand()/2-r}return e=t.subcats.indexOf(t.key),n.x(t.values.x)+n.x.rangeBand()/t.subcats.length*e}return n.x(t.values.x)}).attr("y",function(t){return n.y("stacked"!==t.arrange?t.values.y:t.values.start)}).attr("width",function(t){if("stacked"===t.arrange)return n.x.rangeBand();if("nested"===t.arrange){var e=t.subcats.indexOf(t.key);return e?n.x.rangeBand()/(t.subcats.length*e*.5):n.x.rangeBand()}return n.x.rangeBand()/t.subcats.length}).attr("height",function(t){return n.y(0)-n.y(t.values.y)})}():"ordinal"===a.y.type?!function(){s.selectAll(".bar").transition().attr("x",n.x(0)).attr("width",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("x",n.x(0)).attr("width",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+n.id+")").attr("x",n.x(0)).attr("width",0).append("title"),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split&&n.arrange?n.arrange:n.split?"grouped":null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values(),e.tooltip=n.tooltip});var e=t.format(a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?"0%":a.x.format),i=t.format(a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?"0%":a.y.format);c.select("title").text(function(t){var n=t.tooltip||"";return n.replace(/\$x/g,e(t.values.x)).replace(/\$y/g,i(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})}),c.transition().attr("x",function(t){return n.x("stacked"!==t.arrange&&t.arrange?0:void 0!==t.values.start?t.values.start:0)}).attr("y",function(t){if("nested"===t.arrange){var e=t.subcats.indexOf(t.key),r=e?n.y.rangeBand()/(.75*t.subcats.length)/e:n.y.rangeBand();return n.y(t.values.y)+(n.y.rangeBand()-r)/2}if("grouped"===t.arrange){var e=t.subcats.indexOf(t.key);return n.y(t.values.y)+n.y.rangeBand()/t.subcats.length*e}return n.y(t.values.y)}).attr("width",function(t){return n.x(t.values.x)-n.x(0)}).attr("height",function(t){if("quantile"===a.y.type)return 20;if("nested"===t.arrange){var e=t.subcats.indexOf(t.key);return e?n.y.rangeBand()/(.75*t.subcats.length)/e:n.y.rangeBand()}return"grouped"===t.arrange?n.y.rangeBand()/t.subcats.length:n.y.rangeBand()})}():"linear"===a.x.type&&a.x.bin?!function(){s.selectAll(".bar").transition().attr("y",n.y(0)).attr("height",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("y",n.y(0)).attr("height",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+n.id+")").attr("y",n.y(0)).attr("height",0).append("title"),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values(),t.select(this).attr(n.attributes);var a=t.select(this.parentNode).datum(),i=a.key.split(",").map(function(t){return+t});e.rangeLow=t.min(i),e.rangeHigh=t.max(i),e.tooltip=n.tooltip});var e=t.format(a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?"0%":a.x.format),i=t.format(a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?"0%":a.y.format);c.select("title").text(function(t){var n=t.tooltip||"";return n.replace(/\$x/g,e(t.values.x)).replace(/\$y/g,i(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})}),c.transition().attr("x",function(t){return n.x(t.rangeLow)}).attr("y",function(t){return n.y("stacked"!==t.arrange?t.values.y:t.values.start)}).attr("width",function(t){return n.x(t.rangeHigh)-n.x(t.rangeLow)}).attr("height",function(t){return n.y(0)-n.y(t.values.y)})}():"linear"===a.y.type&&a.y.bin?!function(){s.selectAll(".bar").transition().attr("x",n.x(0)).attr("width",0),s.transition().remove(),l=o.enter().append("g").attr("class",function(t){return"bar-group "+t.key}),l.append("title"),c=o.selectAll("rect").data(function(t){return t.values instanceof Array?t.values:[t]},function(t){return t.key}),c.exit().transition().attr("x",n.x(0)).attr("width",0).remove(),c.enter().append("rect").attr("class",function(t){return"wc-data-mark bar "+t.key}).style("clip-path","url(#"+n.id+")").attr("x",n.x(0)).attr("width",0).append("title"),c.attr("stroke",function(t){return n.colorScale(t.values.raw[0][a.color_by])}).attr("fill",function(t){return n.colorScale(t.values.raw[0][a.color_by])}),c.each(function(e){var n=t.select(this.parentNode.parentNode).datum();e.arrange=n.split?n.arrange:null,e.subcats=t.set(r.map(function(t){return t[n.split]})).values();var a=t.select(this.parentNode).datum(),i=a.key.split(",").map(function(t){return+t});e.rangeLow=t.min(i),e.rangeHigh=t.max(i),e.tooltip=n.tooltip});var e=t.format(a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?"0%":a.x.format),i=t.format(a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?"0%":a.y.format);c.select("title").text(function(t){var n=t.tooltip||"";return n.replace(/\$x/g,e(t.values.x)).replace(/\$y/g,i(t.values.y)).replace(/\[(.+?)\]/g,function(e,n){return t.values.raw[0][n]})}),c.transition().attr("x",function(t){return n.x("stacked"===t.arrange?t.values.start:0)}).attr("y",function(t){return n.y(t.rangeHigh)}).attr("width",function(t){return n.x(t.values.x)}).attr("height",function(t){return n.y(t.rangeLow)-n.y(t.rangeHigh)})}():(s.selectAll(".bar").transition().attr("y",this.y(0)).attr("height",0),s.transition().remove(),i.remove())}function u(){this.wrap.classed("gridlines",this.config.gridlines),this.config.gridlines?(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0),("y"===this.config.gridlines||"xy"===this.config.gridlines)&&this.svg.select(".y.axis").selectAll(".tick line").attr("x1",this.plot_width),("x"===this.config.gridlines||"xy"===this.config.gridlines)&&this.svg.select(".x.axis").selectAll(".tick line").attr("y1",-this.plot_height)):(this.svg.select(".y.axis").selectAll(".tick line").attr("x1",0),this.svg.select(".x.axis").selectAll(".tick line").attr("y1",0))}function f(e){var n=this,r=this.config,a=t.svg.line().interpolate(r.interpolate).x(function(t){return"linear"===r.x.type?n.x(+t.values.x):"time"===r.x.type?n.x(new Date(t.values.x)):n.x(t.values.x)+n.x.rangeBand()/2}).y(function(t){return"linear"===r.y.type?n.y(+t.values.y):"time"===r.y.type?n.y(new Date(t.values.y)):n.y(t.values.y)+n.y.rangeBand()/2}),i=this.svg.selectAll(".line-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});i.enter().append("g").attr("class","line-supergroup"),i.exit().remove();var o=i.selectAll(".line").data(function(t){return t.data},function(t){return t.key});o.exit().remove();var s=o.enter().append("g").attr("class",function(t){return t.key+" line"});return s.append("path"),s.append("title"),o.select("path").attr("class","wc-data-mark").datum(function(t){return t.values}).attr("stroke",function(t){return n.colorScale(t[0].values.raw[0][r.color_by])}).attr("stroke-width",r.stroke_width?r.stroke_width:r.flex_stroke_width).attr("stroke-linecap","round").attr("fill","none").transition().attr("d",a),o.each(function(e){var n=t.select(this.parentNode).datum();e.tooltip=n.tooltip,t.select(this).select("path").attr(n.attributes)}),o.select("title").text(function(e){var n=e.tooltip||"",a=t.format("percent"===r.x.summary?"0%":r.x.format),i=t.format("percent"===r.y.summary?"0%":r.y.format);return n.replace(/\$x/g,a(e.values.x)).replace(/\$y/g,i(e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values[0].values.raw[0][n]})}),o}function d(e){var n=this,r=this.config,a=this.svg.selectAll(".point-supergroup").data(e,function(t,e){return e+"-"+t.per.join("-")});a.enter().append("g").attr("class","point-supergroup"),a.exit().remove();var i=a.selectAll(".point").data(function(t){return t.data},function(t){return t.key}),o=i.exit();o.selectAll("circle").transition().attr("r",0),o.transition().remove();var s=i.enter().append("g").attr("class",function(t){return t.key+" point"});return s.append("circle").attr("class","wc-data-mark").attr("r",0),s.append("title"),i.select("circle").attr("fill-opacity",r.fill_opacity||0===r.fill_opacity?r.fill_opacity:.6).attr("fill",function(t){return n.colorScale(t.values.raw[0][r.color_by])}).attr("stroke",function(t){return n.colorScale(t.values.raw[0][r.color_by])}),i.each(function(e){var n=t.select(this.parentNode).datum();e.mark=n,t.select(this).select("circle").attr(n.attributes)}),i.select("circle").transition().attr("r",function(t){return t.mark.radius||r.flex_point_size}).attr("cx",function(t){var e=n.x(t.values.x)||0;return"ordinal"===r.x.type?e+n.x.rangeBand()/2:e}).attr("cy",function(t){var e=n.y(t.values.y)||0;return"ordinal"===r.y.type?e+n.y.rangeBand()/2:e}),i.select("title").text(function(e){var n=e.mark.tooltip||"",a="percent"===r.x.summary?t.format("0%"):"time"===r.x.type?t.time.format(r.x.format):t.format(r.x.format),i="percent"===r.y.summary?t.format("0%"):"time"===r.y.type?t.time.format(r.y.format):t.format(r.y.format);return n.replace(/\$x/g,a("time"===r.x.type?new Date(e.values.x):e.values.x)).replace(/\$y/g,i("time"===r.y.type?new Date(e.values.y):e.values.y)).replace(/\[(.+?)\]/g,function(t,n){return e.values.raw[0][n]})}),i}function p(e){var n=this;t.select(this.div).select(".loader").empty()&&t.select(this.div).insert("div",":first-child").attr("class","loader").selectAll(".blockG").data(t.range(8)).enter().append("div").attr("class",function(t){return"blockG rotate"+(t+1)}),this.wrap.attr("class","wc-chart"),this.setDefaults(),this.raw_data=e;var r=function(e){n.controls&&(n.controls.targets.push(n),n.controls.ready?n.controls.layout():n.controls.init(n.raw_data));var r=t.select(n.div).property("offsetWidth")>0&&t.select(n.div).property("offsetHeight")>0;if(r)n.layout(),n.wrap.datum(n),n.draw();else var a=setInterval(function(e){var r=t.select(n.div).property("offsetWidth")>0&&t.select(n.div).property("offsetHeight")>0;r&&(n.layout(),n.wrap.datum(n),n.draw(),clearInterval(a))},500)};return this.events.onInit.call(this),this.raw_data.length&&this.checkRequired(this.raw_data),r(e),this}function h(){this.svg=this.wrap.append("svg").attr({"class":"wc-svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink"}).append("g");var e=this.svg.append("defs");e.append("pattern").attr({id:"diagonal-stripes",x:0,y:0,width:3,height:8,patternUnits:"userSpaceOnUse",patternTransform:"rotate(30)"}).append("rect").attr({x:"0",y:"0",width:"2",height:"8",style:"stroke:none; fill:black"}),e.append("clipPath").attr("id",this.id).append("rect").attr("class","plotting-area"),this.svg.append("g").attr("class","y axis").append("text").attr("class","axis-title").attr("transform","rotate(-90)").attr("dy",".75em").attr("text-anchor","middle"),this.svg.append("g").attr("class","x axis").append("text").attr("class","axis-title").attr("dy","-.35em").attr("text-anchor","middle"),this.svg.append("rect").attr("class","overlay").attr("opacity",0).attr("fill","none").style("pointer-events","all"),this.wrap.append("ul").attr("class","legend").append("span").attr("class","legend-title"),t.select(this.div).select(".loader").remove(),this.events.onLayout.call(this)}function g(){var e=arguments.length<=0||void 0===arguments[0]?this.colorScale:arguments[0],n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=this.config;a.legend.mark=a.legend.mark?a.legend.mark:a.marks.length&&"bar"===a.marks[0].type?"square":a.marks.length?a.marks[0].type:"square";var i=n?n:"string"==typeof a.legend.label?a.legend.label:"",o=this.legend||this.wrap.select(".legend");o.style("padding",0);var s=r||e.domain().slice(0).filter(function(t){return void 0!==t&&null!==t}).map(function(t){return{label:t,mark:a.legend.mark}});o.select(".legend-title").text(i).style("display",i?"inline":"none").style("margin-right","1em");var l=o.selectAll(".legend-item").data(s,function(t){return t.label+t.mark});l.exit().remove();var c=l.enter().append("li").attr("class","legend-item").style({"list-style-type":"none",display:"inline-block","margin-right":"1em"});c.append("span").attr("class","legend-mark-text").style("color",function(t){return e(t.label)}),c.append("svg").attr("class","legend-color-block").attr("width","1.1em").attr("height","1.1em").style({position:"relative",top:"0.2em",right:"0.25em"}),a.legend.order&&l.sort(function(e,n){return t.ascending(a.legend.order.indexOf(e.label),a.legend.order.indexOf(n.label))}),l.selectAll(".legend-color-block").select(".legend-mark").remove(),l.selectAll(".legend-color-block").each(function(e){var n=t.select(this);"circle"===e.mark?n.append("circle").attr({cx:".5em",cy:".45em",r:".45em","class":"legend-mark"}):"line"===e.mark?n.append("line").attr({x1:0,y1:".5em",x2:"1em",y2:".5em","stroke-width":2,"shape-rendering":"crispEdges","class":"legend-mark"}):"square"===e.mark&&n.append("rect").attr({height:"1em",width:"1em","class":"legend-mark"})}),l.selectAll(".legend-color-block").select(".legend-mark").attr("fill",function(t){return t.color||e(t.label)}).attr("stroke",function(t){return t.color||e(t.label)}).each(function(e){t.select(this).attr(e.attributes)}),c.append("span").attr("class","legend-label").text(function(t){return t.label}),e.domain().length>1?o.style("display","block"):o.style("display","none"),this.legend=o}function m(){var e=this.config,n=1/e.aspect,r=parseInt(this.wrap.style("width")),a=e.max_width?e.max_width:r,i=e.resizable?!a||a>r?r:this.raw_width:e.width;this.textSize(i),this.margin=this.setMargins();var o="ordinal"===e.x.type&&+e.range_band?this.raw_width+this.margin.left+this.margin.right:e.resizable&&(!e.max_width||r<e.max_width)?r:this.raw_width;this.plot_width=o-this.margin.left-this.margin.right;var s="ordinal"===e.y.type&&+e.range_band?this.raw_height+this.margin.top+this.margin.bottom:!e.resizable&&e.height?e.height:e.resizable?this.plot_width*n:o*n;this.plot_height=s-this.margin.top-this.margin.bottom,t.select(this.svg.node().parentNode).attr("width",o).attr("height",s).select("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.select(".overlay").attr("width",this.plot_width).attr("height",this.plot_height).classed("zoomable",e.zoomable),this.svg.select(".plotting-area").attr("width",this.plot_width).attr("height",this.plot_height+1).attr("transform","translate(0, -1)"),this.xScaleAxis(),this.yScaleAxis();var l=this.svg.select(".x.axis"),c=this.svg.select(".y.axis"),u=l.select(".axis-title"),f=c.select(".axis-title");"top"!==e.x_location&&l.attr("transform","translate(0,"+this.plot_height+")"),l.transition().call(this.xAxis),c.transition().call(this.yAxis),u.attr("transform","translate("+this.plot_width/2+","+(this.margin.bottom-2)+")"),f.attr("x",-1*this.plot_height/2).attr("y",-1*this.margin.left),this.svg.selectAll(".axis .domain").attr({fill:"none",stroke:"#ccc","stroke-width":1,"shape-rendering":"crispEdges"}),this.svg.selectAll(".axis .tick line").attr({stroke:"#eee","stroke-width":1,"shape-rendering":"crispEdges"}),this.drawGridlines(),this.makeLegend(),this.updateDataMarks(),this.events.onResize.call(this)}function y(){var e=this.config,n="flex"===e.legend.behavior?this.filtered_data:this.raw_data,r=e.color_dom||t.set(n.map(function(t){return t[e.color_by]})).values().filter(function(t){return t&&"undefined"!==t});r=r.sort(e.legend.order?function(n,r){return t.ascending(e.legend.order.indexOf(n),e.legend.order.indexOf(r))}:G.dataOps.naturalSorter),this.colorScale=t.scale.ordinal().domain(r).range(e.colors)}function v(){this.config.x=this.config.x||{},this.config.y=this.config.y||{},this.config.x.label=void 0!==this.config.x.label?this.config.x.label:this.config.x.column,this.config.y.label=void 0!==this.config.y.label?this.config.y.label:this.config.y.column,this.config.x.sort=this.config.x.sort||"alphabetical-ascending",this.config.y.sort=this.config.y.sort||"alphabetical-descending",this.config.x.type=this.config.x.type||"linear",this.config.y.type=this.config.y.type||"linear",this.config.margin=this.config.margin||{},this.config.legend=this.config.legend||{},this.config.legend.label=void 0!==this.config.legend.label?this.config.legend.label:this.config.color_by,this.config.marks=this.config.marks&&this.config.marks.length?this.config.marks:[{}],this.config.date_format=this.config.date_format||"%x",this.config.padding=void 0!==this.config.padding?this.config.padding:.3,this.config.outer_pad=void 0!==this.config.outer_pad?this.config.outer_pad:.1,this.config.resizable=void 0!==this.config.resizable?this.config.resizable:!0,this.config.aspect=this.config.aspect||1.33,this.config.colors=this.config.colors||["rgb(102,194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],this.config.scale_text=void 0===this.config.scale_text?!0:this.config.scale_text}function x(){var e=this,n=this.yAxis.tickFormat()?this.y.domain().map(function(t){return e.yAxis.tickFormat()(t)}):this.y.domain(),r=t.max(n.map(function(t){return String(t).length}));this.config.y_format&&this.config.y_format.indexOf("%")>-1&&(r+=1),r=Math.max(2,r);var a=this.config.x.label?1.5:0,i=this.config.y.label?1.5:.25,o=parseInt(this.wrap.style("font-size")),s=this.config.x2_interval?1:0,l=r*o*.5+o*i*1.5||8,c=o+o/1.5+o*a+o*s||8;return l+=6,c+=3,{top:this.config.margin&&this.config.margin.top?this.config.margin.top:8,right:this.config.margin&&this.config.margin.right?this.config.margin.right:16,bottom:this.config.margin&&this.config.margin.bottom?this.config.margin.bottom:c,left:this.config.margin&&this.config.margin.left?this.config.margin.left:l}}function b(t){var e="14px",n=4,r=2;this.config.scale_text?t>=600?(e="14px",n=4,r=2):t>450&&600>t?(e="12px",n=3,r=2):t>300&&450>t?(e="10px",n=2,r=2):300>=t&&(e="10px",n=2,r=1):(e=this.config.font_size,n=this.config.point_size||4,r=this.config.stroke_width||2),this.wrap.style("font-size",e),this.config.flex_point_size=n,this.config.flex_stroke_width=r}function w(e,n){function r(e){var r="ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin?"y":"x";e.total=t.sum(e.values.map(function(t){return+t.values[r]}));var a=0;e.values.forEach(function(t,r){"ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin?(t.values.y="percent"===n.summarizeY?t.values.y/e.total:t.values.y||0,a+=+t.values.y,t.values.start=e.values[r-1]?a:t.values.y):(t.values.x="percent"===n.summarizeX?t.values.x/e.total:t.values.x||0,t.values.start=a,a+=+t.values.x)})}function a(e,a){var i=[],s=[],l=t.nest();"linear"===o.x.type&&o.x.bin||"linear"===o.y.type&&o.y.bin?!function(){var n="linear"===o.x.type&&o.x.bin?"x":"y",r=t.scale.quantile().domain(t.extent(e.map(function(t){return+t[o[n].column]}))).range(t.range(+o[n].bin));e.forEach(function(t){return t.wc_bin=r(t[o[n].column])}),l.key(function(t){return r.invertExtent(t.wc_bin)})}():l.key(function(t){return n.per.map(function(e){return t[e]}).join(" ")}),a&&(l.key(function(t){return t[a]}),l.sortKeys(function(e,n){return"time"===o.x.type?t.ascending(new Date(e),new Date(n)):o.x_dom?t.ascending(o.x_dom.indexOf(e),o.x_dom.indexOf(n)):a===o.color_by&&o.legend.order?t.ascending(o.legend.order.indexOf(e),o.legend.order.indexOf(n)):"ordinal"===o.x.type||"ordinal"===o.y.type?G.dataOps.naturalSorter(e,n):t.ascending(+e,+n)})),l.rollup(function(r){var a={raw:r},l=r.map(function(t){return t[o.y.column]}).sort(t.ascending),c=r.map(function(t){return t[o.x.column]}).sort(t.ascending);if(a.x="ordinal"===o.x.type?r[0][o.x.column]:G.dataOps.summarize(c,n.summarizeX),a.y="ordinal"===o.y.type?r[0][o.y.column]:G.dataOps.summarize(l,n.summarizeY),a.x_q25=o.error_bars&&"ordinal"===o.y.type?t.quantile(c,.25):a.x,a.x_q75=o.error_bars&&"ordinal"===o.y.type?t.quantile(c,.75):a.x,a.y_q25=o.error_bars?t.quantile(l,.25):a.y,a.y_q75=o.error_bars?t.quantile(l,.75):a.y,i.push([a.x_q25,a.x_q75,a.x]),s.push([a.y_q25,a.y_q75,a.y]),"cumulative"===n.summarizeY){var u=e.filter(function(t){return"time"===o.x.type?new Date(t[o.x.column])<=new Date(r[0][o.x.column]):+t[o.x.column]<=+r[0][o.x.column]});n.per.length&&(u=u.filter(function(t){return t[n.per[0]]===r[0][n.per[0]]}));var f="time"===o.x.type?u.length:t.sum(u.map(function(t){return+t[o.y.column]||0===+t[o.y.column]?+t[o.y.column]:1}));s.push([f]),a.y=f}if("cumulative"===n.summarizeX){var u=e.filter(function(t){return"time"===o.y.type?new Date(t[o.y.column])<=new Date(r[0][o.y.column]):+t[o.y.column]<=+r[0][o.y.column]});n.per.length&&(u=u.filter(function(t){return t[n.per[0]]===r[0][n.per[0]]})),i.push([u.length]),a.x=u.length}return a});var c=l.entries(e),u=t.extent(t.merge(i)),d=t.extent(t.merge(s));return a&&"bar"===n.type&&"stacked"===n.arrange?(c.forEach(r),("ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin)&&(d=t.extent(c.map(function(t){return t.total}))),("ordinal"===o.y.type||"linear"===o.y.type&&o.y.bin)&&(u=t.extent(c.map(function(t){return t.total})))):a&&"bar"===n.type&&n.split?c.forEach(r):!function(){var t="ordinal"===o.x.type||"linear"===o.x.type&&o.x.bin?"y":"x";c.forEach(function(e){return e.total=e.values[t]})}(),"total-ascending"===o.x.sort&&"ordinal"==o.x.type||"total-descending"===o.y.sort&&"ordinal"==o.y.type?f=c.sort(function(e,n){return t.ascending(e.total,n.total)}).map(function(t){return t.key}):("total-descending"===o.x.sort&&"ordinal"==o.x.type||"total-ascending"===o.y.sort&&"ordinal"==o.y.type)&&(f=c.sort(function(e,n){return t.descending(+e.total,+n.total)}).map(function(t){return t.key})),{nested:c,dom_x:u,dom_y:d}}var i=this,o=this.config,s=o.x.behavior||"raw",l=o.y.behavior||"raw",c="line"===n.type?o.x.column:"bar"===n.type&&n.split?n.split:null,u=t.time.format(o.date_format),f=void 0;e=n.per&&n.per.length?e.filter(function(t){return t[n.per[0]]}):e,o.x.column&&(e=e.filter(function(t){return void 0!==t[o.x.column]})),o.y.column&&(e=e.filter(function(t){return void 0!==t[o.y.column]})),"time"===o.x.type&&(e=e.filter(function(t){return t[o.x.column]instanceof Date?t[o.x.column]:u.parse(t[o.x.column])}),e.forEach(function(t){return t[o.x.column]=t[o.x.column]instanceof Date?t[o.x.column]:u.parse(t[o.x.column])})),"time"===o.y.type&&(e=e.filter(function(t){return t[o.y.column]instanceof Date?t[o.y.column]:u.parse(t[o.y.column])}),e.forEach(function(t){return t[o.y.column]=t[o.y.column]instanceof Date?t[o.y.column]:u.parse(t[o.y.column])})),"linear"!==o.x.type&&"log"!==o.x.type||!o.x.column||(e=e.filter(function(t){return"count"!==n.summarizeX&&"percent"!==n.summarizeX?+t[o.x.column]||0===+t[o.x.column]:t})),"linear"!==o.y.type&&"log"!==o.y.type||!o.y.column||(e=e.filter(function(t){return"count"!==n.summarizeY&&"percent"!==n.summarizeY?+t[o.y.column]||0===+t[o.y.column]:t}));var d=void 0;"bar"===n.type?d="stacked"!==n.arrange?a(e,c):a(e):("count"===n.summarizeX||"count"===n.summarizeY)&&(d=a(e));var p="cumulative"===n.summarizeX?[0,e.length]:"ordinal"===o.x.type?t.set(e.map(function(t){return t[o.x.column]})).values().filter(function(t){return t}):t.extent(n.split&&"stacked"!==n.arrange?t.merge(d.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})})):"count"===n.summarizeX?d.nested.map(function(t){return t.values.raw.length}):e.map(function(t){return+t[o.x.column]}).filter(function(t){return+t||0===+t})),h="cumulative"===n.summarizeY?[0,e.length]:"ordinal"===o.y.type?t.set(e.map(function(t){return t[o.y.column]})).values().filter(function(t){return t}):t.extent(n.split&&"stacked"!==n.arrange?t.merge(d.nested.map(function(t){return t.values.map(function(t){return t.values.raw.length})})):"count"===n.summarizeY?d.nested.map(function(t){return t.values.raw.length}):e.map(function(t){return+t[o.y.column];

}).filter(function(t){return+t||0===+t})),g=e,m=[],y=[];if(this.filters.length&&(this.filters.forEach(function(t){g=g.filter(function(e){return"All"===t.val?e:t.val instanceof Array?t.val.indexOf(e[t.col])>-1:e[t.col]===t.val})}),("firstfilter"===o.x.behavior||"firstfilter"===o.y.behavior)&&this.filters[0].choices.filter(function(t){return"All"!==t}).forEach(function(t){var n=e.filter(function(e){return e[i.filters[0].col]===t}),r=a(n,c);m.push(r.dom_x),y.push(r.dom_y)})),n.values){var v=function(t){g=g.filter(function(e){return n.values[t].indexOf(e[t])>-1})};for(var x in n.values)v(x)}var b=t.extent(t.merge(m)),w=t.extent(t.merge(y));this.filtered_data=g;var k=a(g,c),_=k.dom_x,A=k.dom_y;"bar"===n.type&&("ordinal"===o.y.type&&"count"===n.summarizeX?o.x.domain=o.x.domain?[0,o.x.domain[1]]:[0,null]:"ordinal"===o.x.type&&"count"===n.summarizeY&&(o.y.domain=o.y.domain?[0,o.y.domain[1]]:[0,null]));var O=Boolean(this.filters.length&&"All"!==this.filters[0].val&&this.filters.slice(1).filter(function(t){return"All"===t.val}).length===this.filters.length-1),z=this.filters.length?"raw"===s?p:O&&"firstfilter"===s?b:_:_,S=this.filters.length?"raw"===l?h:O&&"firstfilter"===l?w:A:A,E=o.x_dom?o.x_dom:"ordinal"===o.x.type&&"flex"===o.x.behavior?t.set(g.map(function(t){return t[o.x.column]})).values():"ordinal"===o.x.type?t.set(e.map(function(t){return t[o.x.column]})).values():o.x_from0?[0,t.max(z)]:z,D=o.y_dom?o.y_dom:"ordinal"===o.y.type&&"flex"===o.y.behavior?t.set(g.map(function(t){return t[o.y.column]})).values():"ordinal"===o.y.type?t.set(e.map(function(t){return t[o.y.column]})).values():o.y_from0?[0,t.max(S)]:S;return o.x.domain&&(o.x.domain[0]||0===o.x.domain[0])&&(E[0]=o.x.domain[0]),o.x.domain&&(o.x.domain[1]||0===o.x.domain[1])&&(E[1]=o.x.domain[1]),o.y.domain&&(o.y.domain[0]||0===o.y.domain[0])&&(D[0]=o.y.domain[0]),o.y.domain&&(o.y.domain[1]||0===o.y.domain[1])&&(D[1]=o.y.domain[1]),"ordinal"!==o.x.type||o.x.order||(o.x.order=f),"ordinal"!==o.y.type||o.y.order||(o.y.order=f),this.current_data=k.nested,this.events.onDatatransform.call(this),{data:k.nested,x_dom:E,y_dom:D}}function k(){this.drawBars(this.marks.filter(function(t){return"bar"===t.type})),this.drawLines(this.marks.filter(function(t){return"line"===t.type})),this.drawPoints(this.marks.filter(function(t){return"circle"===t.type}))}function _(e,n,r){void 0===e&&(e=this.plot_width),void 0===n&&(n=this.x_dom),void 0===r&&(r=this.config.x.type);var a=this.config,i=void 0;i="log"===r?t.scale.log():"ordinal"===r?t.scale.ordinal():"time"===r?t.time.scale():t.scale.linear(),i.domain(n),"ordinal"===r?i.rangeBands([0,+e],a.padding,a.outer_pad):i.range([0,+e]).clamp(Boolean(a.x.clamp));var o=a.x.format?a.x.format:a.marks.map(function(t){return"percent"===t.summarizeX}).indexOf(!0)>-1?"0%":"time"===r?"%x":".0f",s=Math.max(2,Math.min(e/80,8)),l=t.svg.axis().scale(i).orient(a.x.location).ticks(s).tickFormat("ordinal"===r?null:"time"===r?t.time.format(o):t.format(o)).tickValues(a.x.ticks?a.x.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.x.axis").attr("class","x axis "+r),this.x=i,this.xAxis=l}function A(e,n,r){void 0===e&&(e=this.plot_height),void 0===n&&(n=this.y_dom),void 0===r&&(r=this.config.y.type);var a=this.config,i=void 0;i="log"===r?t.scale.log():"ordinal"===r?t.scale.ordinal():"time"===r?t.time.scale():t.scale.linear(),i.domain(n),"ordinal"===r?i.rangeBands([+e,0],a.padding,a.outer_pad):i.range([+e,0]).clamp(Boolean(a.y_clamp));var o=a.y.format?a.y.format:a.marks.map(function(t){return"percent"===t.summarizeY}).indexOf(!0)>-1?"0%":".0f",s=Math.max(2,Math.min(e/80,8)),l=t.svg.axis().scale(i).orient("left").ticks(s).tickFormat("ordinal"===r?null:"time"===r?t.time.format(o):t.format(o)).tickValues(a.y.ticks?a.y.ticks:null).innerTickSize(6).outerTickSize(3);this.svg.select("g.y.axis").attr("class","y axis "+r),this.y=i,this.yAxis=l}function O(t,e){var n=this;this.targets.forEach(function(r){t instanceof Array?t.forEach(function(t){return n.stringAccessor(r.config,t,e)}):n.stringAccessor(r.config,t,e),r.draw()})}function z(e){var n=this,r=t.keys(e[0]);this.config.inputs&&this.config.inputs.forEach(function(t,e){if("subsetter"===t.type&&-1===r.indexOf(t.value_col))throw n.config.inputs=n.config.inputs.splice(controls[e],1),new Error('Error in settings object: the value "'+t.value_col+'" does not match any column in the provided dataset.')})}function S(t){this.data=t,this.config.builder||this.checkRequired(this.data),this.layout()}function E(){this.wrap.selectAll("*").remove(),this.ready=!0,this.controlUpdate()}function D(){var t=this;this.config.inputs&&this.config.inputs.length&&this.config.inputs[0]&&this.config.inputs.forEach(function(e){return t.makeControlItem(e)})}function C(e,n){var r=this,a=e.values?e.values:t.keys(this.data[0]),i=n.append("div").attr("class","btn-group"),o=i.selectAll("button").data(a).enter().append("button").attr("class","btn btn-default btn-sm").text(function(t){return t}).classed("btn-primary",function(t){return r.stringAccessor(r.targets[0].config,e.option)===t});o.on("click",function(n){o.each(function(e){t.select(this).classed("btn-primary",e===n)}),r.changeOption(e.option,n)})}function B(t,e){var n=this,r=e.append("input").attr("type","checkbox").attr("class","changer").datum(t).property("checked",function(e){return n.stringAccessor(n.targets[0].config,t.option)});r.on("change",function(t){var e=r.property("checked");n.changeOption(t.option,e)})}function q(t){var e=this.wrap.append("div").attr("class","control-group").classed("inline",t.inline).datum(t),n=e.append("span").attr("class","control-label").text(t.label);if(t.required&&n.append("span").attr("class","label label-required").text("Required"),e.append("span").attr("class","span-description").text(t.description),"text"===t.type)this.makeTextControl(t,e);else if("number"===t.type)this.makeNumberControl(t,e);else if("list"===t.type)this.makeListControl(t,e);else if("dropdown"===t.type)this.makeDropdownControl(t,e);else if("btngroup"===t.type)this.makeBtnGroupControl(t,e);else if("checkbox"===t.type)this.makeCheckboxControl(t,e);else if("radio"===t.type)this.makeRadioControl(t,e);else{if("subsetter"!==t.type)throw new Error('Each control must have a type! Choose from: "text", "number", "list", "dropdown", "btngroup", "checkbox", "radio", "subsetter"');this.makeSubsetterControl(t,e)}}function j(e,n){var r=this,a=e.option||e.options[0],i=n.append("select").attr("class","changer").attr("multiple",e.multiple?!0:null).datum(e),o=e.values&&e.values instanceof Array?e.values:e.values?t.set(this.data.map(function(t){return t[r.targets[0].config[e.values]]})).values():t.keys(this.data[0]);(!e.require||e.none)&&o.unshift("None");var s=i.selectAll("option").data(o).enter().append("option").text(function(t){return t}).property("selected",function(t){return r.stringAccessor(r.targets[0].config,a)===t});return i.on("change",function(n){var a="None"===i.property("value")?null:i.property("value");e.multiple&&(a=s.filter(function(e){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("value")}).filter(function(t){return"None"!==t})),e.options?r.changeOption(e.options,a):r.changeOption(e.option,a)}),i}function N(t,e){var n=this,r=e.append("input").attr("type","text").attr("class","changer").datum(t).property("value",function(e){return n.stringAccessor(n.targets[0].config,t.option)});r.on("change",function(e){var a=r.property("value")?r.property("value").split(",").map(function(t){return t.trim()}):null;n.changeOption(t.option,a)})}function L(t,e){var n=this,r=e.append("input").attr("type","number").attr("min",void 0!==t.min?t.min:0).attr("max",t.max).attr("step",t.step||1).attr("class","changer").datum(t).property("value",function(e){return n.stringAccessor(n.targets[0].config,t.option)});r.on("change",function(e){var a=+r.property("value");n.changeOption(t.option,a)})}function T(e,n){var r=this,a=n.selectAll("label").data(e.values||t.keys(this.data[0])).enter().append("label").attr("class","radio").text(function(t,n){return e.relabels?e.relabels[n]:t}).append("input").attr("type","radio").attr("class","changer").attr("name",e.option.replace(".","-")+"-"+this.targets[0].id).property("value",function(t){return t}).property("checked",function(t){return r.stringAccessor(r.targets[0].config,e.option)===t});a.on("change",function(n){var i=null;a.each(function(e){t.select(this).property("checked")&&(i="none"===t.select(this).property("value")?null:e)}),r.changeOption(e.option,i)})}function X(e,n){function r(t,e){var n=-1;t.filters.forEach(function(t,r){t.col===e.col&&(n=r)}),n>-1&&(t.filters[n]=e)}var a=this.targets,i=n.append("select").attr("class","changer").attr("multiple",e.multiple?!0:null).datum(e),o=e.values?e.values:t.set(this.data.map(function(t){return t[e.value_col]}).filter(function(t){return t})).values();o.sort(G.dataOps.naturalSorter),e.start=e.start?e.start:e.loose?o[0]:null,e.multiple||e.start||o.unshift("All"),e.loose=!e.loose&&e.start?!0:e.loose;var s=i.selectAll("option").data(o).enter().append("option").text(function(t){return t}).property("selected",function(t){return t===e.start});a.forEach(function(t){var n=t.filters.slice().map(function(t){return t.col===e.value_col}).indexOf(!0);n>-1?t.filters[n]={col:e.value_col,val:e.start?e.start:"All",choices:o,loose:e.loose}:t.filters.push({col:e.value_col,val:e.start?e.start:"All",choices:o,loose:e.loose})}),i.on("change",function(n){var i=this;e.multiple?!function(){var n=s.filter(function(e){return t.select(this).property("selected")})[0].map(function(e){return t.select(e).property("text")}),i={col:e.value_col,val:n,choices:o,loose:e.loose};a.forEach(function(t){r(t,i),t.draw()})}():!function(){var n=t.select(i).select("option:checked").property("text"),s={col:e.value_col,val:n,choices:o,loose:e.loose};a.forEach(function(t){r(t,s),t.draw()})}()})}function Y(t,e){var n=this,r=e.append("input").attr("type","text").attr("class","changer").datum(t).property("value",function(e){return n.stringAccessor(n.targets[0].config,t.option)});r.on("change",function(e){var a=r.property("value");n.changeOption(t.option,a)})}function M(t,e,n){e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,"");for(var r=e.split("."),a=0,i=r.length;i>a;++a){var o=r[a];if(!(o in t))return;a==i-1&&void 0!==n&&(t[o]=n),t=t[o]}return t}function R(e,n){var r=e?e:this.raw_data,a=this.config,i=n||this.transformData(r);this.wrap.datum(i);var o=this.table,s=a.cols.length?a.cols:i.length?t.keys(i[0].values[0].raw):[];a.bootstrap?o.classed("table",!0):o.classed("table",!1);var l=i.length?a.headers&&a.headers.length?a.headers:s:[],c=o.select("thead").select("tr.headers"),u=c.selectAll("th").data(l);u.exit().remove(),u.enter().append("th"),u.text(function(t){return t});var f=o.selectAll("tbody").data(i,function(t){return t.key});if(f.exit().remove(),f.enter().append("tbody"),a.row_per){var d=a.row_per.slice(0).reverse();d.forEach(function(t){f.sort(function(e,n){return e.values[0].raw[t]-n.values[0].raw[t]})})}var p=f.selectAll("tr").data(function(t){return t.values});p.exit().remove(),p.enter().append("tr"),a.sort_rows&&!function(){var t=a.sort_rows.slice(0);t.unshift("0"),p.sort(function(e,n){for(var r=0;r<t.length&&e.raw[t[r]]==n.raw[t[r]];)r++;return e.raw[t[r]]<n.raw[t[r]]?-1:e.raw[t[r]]>n.raw[t[r]]?1:0})}();var h=p.selectAll("td").data(function(t){return t.cells.filter(function(t){return s.indexOf(t.col)>-1})});if(h.exit().remove(),h.enter().append("td"),h.attr("class",function(t){return t.col}),a.as_html?h.html(function(t){return t.text}):h.text(function(t){return t.text}),a.row_per&&p.filter(function(t,e){return e>0}).selectAll("td").filter(function(t){return a.row_per.indexOf(t.col)>-1}).text(""),a.data_tables){if(!jQuery()||!jQuery().dataTable)throw new Error("dataTables jQuery plugin not available");var g=a.data_tables;g.searching=a.searchable?a.searchable:!1,$(o.node()).dataTable(g);var m=$(".print-btn",wrap.node());m.addClass("pull-right"),$(".dataTables_wrapper").prepend(m)}this.events.onDraw.call(this)}function I(){t.select(this.div).select(".loader").remove();var e=this.wrap.append("table");e.append("thead").append("tr").attr("class","headers"),this.table=e,this.events.onLayout.call(this)}function H(e){if(e){var n=this.config,r=n.cols||t.keys(e[0]);n.keep&&n.keep.forEach(function(t){-1===r.indexOf(t)&&r.unshift(t)}),this.config.cols=r;var a=e;this.filters.length&&this.filters.forEach(function(t){var e=t.val instanceof Array;a=a.filter(function(n){return e?-1!==t.val.indexOf(n[t.col]):"All"!==t.val?n[t.col]===t.val:n})});var i=t.nest().key(function(t){return n.row_per?n.row_per.map(function(e){return t[e]}).join(" "):t}).rollup(function(t){n.dataManipulate&&(t=n.dataManipulate(t));var e=t.map(function(t){var e=[];for(var r in t)e.push({col:r,text:t[r]});return e.sort(function(t,e){return n.cols.indexOf(t.col)-n.cols.indexOf(e.col)}),{cells:e,raw:t}});return e}).entries(a);return this.current_data=i,this.events.onDatatransform.call(this),this.current_data}}var G={version:"1.2.0"};G.multiply=function(e,n,r,a){function i(n){var i=t.set(n.map(function(t){return t[r]})).values().filter(function(t){return t});a&&(i=i.sort(function(e,n){return t.ascending(a.indexOf(e),a.indexOf(n))})),i.forEach(function(t){var a=G.createChart(e.wrap.node(),o,e.controls);a.events=e.events,a.legend=l,a.filters.unshift({col:r,val:t,choices:i}),a.wrap.insert("span","svg").attr("class","wc-chart-title").text(t),a.init(n)})}var o=e.config,s=e.wrap.classed("wc-layout wc-small-multiples",!0).classed("wc-chart",!1),l=s.append("ul").attr("class","legend");i(n)},G.dataOps={getValType:e,lengthenRaw:n,naturalSorter:r,summarize:a};var U={raw_data:[],config:{}};Object.defineProperties(U,{checkRequired:{value:i},consolidateData:{value:o},draw:{value:s},drawArea:{value:l},drawBars:{value:c},drawGridlines:{value:u},drawLines:{value:f},drawPoints:{value:d},init:{value:p},layout:{value:h},makeLegend:{value:g},resize:{value:m},setColorScale:{value:y},setDefaults:{value:v},setMargins:{value:x},textSize:{value:b},transformData:{value:w},updateDataMarks:{value:k},xScaleAxis:{value:_},yScaleAxis:{value:A}});var P={changeOption:O,checkRequired:z,controlUpdate:D,init:S,layout:E,makeControlItem:q,makeBtnGroupControl:C,makeCheckboxControl:B,makeDropdownControl:j,makeListControl:N,makeNumberControl:L,makeRadioControl:T,makeSubsetterControl:X,makeTextControl:Y,stringAccessor:M},F=Object.create(U);return Object.defineProperties(F,{layout:{value:I},transformData:{value:H},draw:{value:R}}),G.objects={chart:U,table:F,controls:P},G.chartCount=0,G.createChart=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=Object.create(G.objects.chart);return a.div=e,a.config=Object.create(n),a.controls=r,a.raw_data=[],a.filters=[],a.marks=[],a.wrap=t.select(a.div).append("div"),a.events={onInit:function(){},onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},a.on=function(t,e){var n=["init","layout","datatransform","draw","resize"];n.indexOf(t)<0||e&&(a.events["on"+t.charAt(0).toUpperCase()+t.slice(1)]=e)},G.chartCount++,a.id=G.chartCount,a},G.createControls=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=Object.create(G.objects.controls);return r.div=e,r.config=Object.create(n),r.config.inputs=r.config.inputs||[],r.targets=[],r.wrap="bottom"===n.location?t.select(e).append("div").attr("class","wc-controls"):t.select(e).insert("div",":first-child").attr("class","wc-controls"),r},G.createTable=function(){var e=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=Object.create(G.objects.table);return a.div=e,a.config=Object.create(n),a.controls=r,a.filters=[],a.required_cols=[],a.marks=[],a.wrap=t.select(a.div).append("div"),a.events={onInit:function(){},onLayout:function(){},onDatatransform:function(){},onDraw:function(){},onResize:function(){}},a.on=function(t,e){var n=["init","layout","datatransform","draw","resize"];n.indexOf(t)<0||e&&(a.events["on"+t.charAt(0).toUpperCase()+t.slice(1)]=e)},a},G});